import{u as X}from"./spaces-Bq9USoTJ.js";import{_ as Z,r as h,x as b,y as ee,A as te,v as ae,c as f,w as o,B as ne,o as i,b as s,V as se,E as g,C as y,aa as oe,p as w,h as d,s as F,t as m,d as re,e as le,D as ie,f as C,g as L,ab as ce,M as de,F as j,G as I,N as ue,$ as S,l as k,J as D,I as pe,O as me,P as fe,i as N}from"./index-DPaTiaMt.js";const ge={class:"d-flex align-center mb-4"},_e={class:"d-flex align-center flex-wrap ga-2 mb-1"},ye={class:"d-inline-flex align-center text-caption"},De={key:0,class:"d-inline-flex align-center text-caption"},ve={key:2,class:"week-grid"},xe={class:"text-caption text-truncate"},he={key:0,class:"text-caption text-medium-emphasis"},we={key:1,class:"text-caption text-medium-emphasis"},Se={class:"d-flex align-center"},ke={class:"d-flex align-center opacity-60"},be={__name:"CalendarView",setup(Te){const M=X(),T=h(!1),O=h([]),v=h("week"),u=h(new Date().toISOString().split("T")[0]),p=h($(new Date));function $(t){const a=new Date(t),e=a.getDay(),n=a.getDate()-e+(e===0?-6:1);return a.setDate(n),a.toISOString().split("T")[0]}function P(){if(v.value==="day"){const t=new Date(u.value);t.setDate(t.getDate()-1),u.value=t.toISOString().split("T")[0]}else{const t=new Date(p.value);t.setDate(t.getDate()-7),p.value=t.toISOString().split("T")[0]}}function B(){if(v.value==="day"){const t=new Date(u.value);t.setDate(t.getDate()+1),u.value=t.toISOString().split("T")[0]}else{const t=new Date(p.value);t.setDate(t.getDate()+7),p.value=t.toISOString().split("T")[0]}}function E(){const t=new Date().toISOString().split("T")[0];u.value=t,p.value=$(new Date)}function A(t){u.value=t,v.value="day"}const W=b(()=>{if(v.value==="day")return new Date(u.value).toLocaleDateString("de-DE",{day:"numeric",month:"short",year:"numeric"});{const t=new Date(p.value),a=new Date(p.value);a.setDate(a.getDate()+6);const e=t.toLocaleDateString("de-DE",{day:"numeric",month:"short"}),n=a.toLocaleDateString("de-DE",{day:"numeric",month:"short",year:"numeric"});return`${e} - ${n}`}}),J=b(()=>{const t=[],a=["Mo","Di","Mi","Do","Fr","Sa","So"];for(let e=0;e<7;e++){const n=new Date(p.value);n.setDate(n.getDate()+e),t.push({date:n.toISOString().split("T")[0],dayName:a[e],dayNumber:n.getDate()})}return t});function V(t){return t===new Date().toISOString().split("T")[0]}function Y(t){const a=new Date(t);return`${["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"][a.getDay()]}, ${a.toLocaleDateString("de-DE",{day:"numeric",month:"long",year:"numeric"})}`}function G(t,a,e){const n=[];if(t.task_type!=="recurring"||!t.next_due_date)return n;let r=new Date(t.next_due_date);const l=new Date(e);let c=0;for(;r<=l&&c<50;){const _=r.toISOString().split("T")[0];if(_>t.next_due_date&&_>=a&&n.push({...t,projected_date:_,is_projection:!0}),r=H(t,r),!r)break;c++}return n}function H(t,a){if(t.recurrence_type==="interval"){const e=new Date(a);if(e.setDate(e.getDate()+(t.interval_days||1)),t.interval_exclude_weekends){const n=e.getDay();n===0?e.setDate(e.getDate()+1):n===6&&e.setDate(e.getDate()+2)}return e}if(t.recurrence_type==="schedule")try{const e=JSON.parse(t.schedule_pattern);if(e.type==="weekly")return K(e.weekdays,a);if(e.type==="monthly")return R(e.days,a)}catch(e){console.error("Failed to parse schedule pattern:",e)}return null}function K(t,a){const e=[...t].sort((r,l)=>r-l),n=new Date(a);n.setDate(n.getDate()+1);for(let r=0;r<14;r++){const l=n.getDay();if(e.includes(l))return n;n.setDate(n.getDate()+1)}return null}function R(t,a){const e=[...t].sort((c,_)=>c-_),n=new Date(a),r=n.getDate(),l=e.find(c=>c>r);if(l){const c=new Date(n.getFullYear(),n.getMonth(),l);if(c.getDate()===l)return c}n.setMonth(n.getMonth()+1);for(const c of e){const _=new Date(n.getFullYear(),n.getMonth(),c);if(_.getDate()===c)return _}return null}const U=b(()=>{const t=new Date(p.value);t.setDate(t.getDate()-7);const a=new Date(p.value);a.setDate(a.getDate()+35);const e=t.toISOString().split("T")[0],n=a.toISOString().split("T")[0],r=[];for(const l of O.value){if(l.status!=="active")continue;l.next_due_date&&l.next_due_date>=e&&l.next_due_date<=n&&r.push({...l,is_projection:!1});const c=G(l,e,n);r.push(...c)}return r});function x(t){return U.value.filter(a=>(a.projected_date||a.next_due_date)===t).sort((a,e)=>a.is_projection!==e.is_projection?a.is_projection?1:-1:a.has_specific_time&&e.has_specific_time?a.time_of_day.localeCompare(e.time_of_day):a.has_specific_time?-1:e.has_specific_time?1:0)}const z=b(()=>x(u.value));function q(t){return x(t).length}ee(async()=>{await Q()});async function Q(){T.value=!0;try{await M.fetchSpaces();const t=M.spaces.map(async e=>{try{return(await te.get(`/spaces/${e.id}/tasks`)).tasks.map(r=>({...r,space_id:e.id,space_name:e.personal_name||e.name,space_color:e.personal_color}))}catch(n){return console.error(`Failed to fetch tasks for space ${e.id}:`,n),[]}}),a=await Promise.all(t);O.value=a.flat()}finally{T.value=!1}}return ae(p,()=>{}),(t,a)=>(i(),f(ne,{class:"bg-background"},{default:o(()=>[s(se,{fluid:"",class:"pa-4"},{default:o(()=>[g("div",ge,[s(oe,{modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=e=>v.value=e),mandatory:"",density:"compact",color:"primary"},{default:o(()=>[s(w,{value:"day",size:"small"},{default:o(()=>[...a[1]||(a[1]=[d("Tag",-1)])]),_:1}),s(w,{value:"week",size:"small"},{default:o(()=>[...a[2]||(a[2]=[d("Woche",-1)])]),_:1})]),_:1},8,["modelValue"]),s(F),s(w,{icon:"mdi-chevron-left",variant:"text",density:"compact",onClick:P}),s(w,{variant:"text",density:"compact",onClick:E,class:"mx-1"},{default:o(()=>[d(m(W.value),1)]),_:1}),s(w,{icon:"mdi-chevron-right",variant:"text",density:"compact",onClick:B})]),T.value?(i(),f(re,{key:0},{default:o(()=>[s(le,{cols:"12",class:"text-center py-8"},{default:o(()=>[s(ie,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):v.value==="day"?(i(),f(C,{key:1,elevation:"0"},{default:o(()=>[s(L,{class:"text-h6 pb-0"},{default:o(()=>[d(m(Y(u.value)),1)]),_:1}),s(ce,{class:"text-caption"},{default:o(()=>[d(m(q(u.value))+" Aufgaben ",1)]),_:1}),z.value.length>0?(i(),f(de,{key:0,class:"pa-0",lines:"two"},{default:o(()=>[(i(!0),y(j,null,I(z.value,e=>(i(),f(ue,{key:`${e.space_id}-${e.id}-${e.projected_date||e.next_due_date}`,class:S(["px-4 py-3",{"opacity-60":e.is_projection}])},{prepend:o(()=>[s(D,{icon:e.is_projection?"mdi-calendar-clock":"mdi-checkbox-blank-circle-outline",color:e.is_projection?"grey":"primary",class:"mr-3"},null,8,["icon","color"])]),default:o(()=>[g("div",_e,[g("span",ye,[s(D,{icon:"mdi-folder",size:"small",class:"mr-1",color:e.space_color||"grey"},null,8,["color"]),d(" "+m(e.space_name),1)]),e.category?(i(),y("span",De,[s(D,{icon:e.category.icon||"mdi-tag",color:e.category.color,size:"small",class:"mr-1"},null,8,["icon","color"]),d(" "+m(e.category.name),1)])):k("",!0),e.is_projection?(i(),f(pe,{key:1,size:"x-small",color:"grey",variant:"outlined"},{default:o(()=>[...a[3]||(a[3]=[d(" Projektion ",-1)])]),_:1})):k("",!0)]),s(me,{class:"text-body-1 font-weight-medium"},{default:o(()=>[d(m(e.title),1)]),_:2},1024),e.has_specific_time?(i(),f(fe,{key:0,class:"text-caption mt-1"},{default:o(()=>[s(D,{icon:"mdi-clock-outline",size:"small",class:"mr-1"}),d(" "+m(e.time_of_day),1)]),_:2},1024)):k("",!0)]),_:2},1032,["class"]))),128))]),_:1})):(i(),f(N,{key:1,class:"text-center py-8"},{default:o(()=>[s(D,{size:"48",color:"grey-lighten-1"},{default:o(()=>[...a[4]||(a[4]=[d("mdi-calendar-blank",-1)])]),_:1}),a[5]||(a[5]=g("div",{class:"text-body-2 text-medium-emphasis mt-2"}," Keine Aufgaben an diesem Tag ",-1))]),_:1}))]),_:1})):(i(),y("div",ve,[(i(!0),y(j,null,I(J.value,e=>(i(),f(C,{key:e.date,elevation:"0",class:S(["week-day-card",{"today-card":V(e.date),"selected-card":e.date===u.value}]),onClick:n=>A(e.date)},{default:o(()=>[s(L,{class:"text-caption pa-2 pb-1 d-flex align-center"},{default:o(()=>[g("span",{class:S({"text-primary font-weight-bold":V(e.date)})},m(e.dayName),3),s(F),g("span",{class:S(["text-body-2",{"text-primary font-weight-bold":V(e.date)}])},m(e.dayNumber),3)]),_:2},1024),s(N,{class:"pa-2 pt-0"},{default:o(()=>[(i(!0),y(j,null,I(x(e.date).slice(0,4),n=>{var r,l;return i(),y("div",{key:`${n.space_id}-${n.id}-${n.projected_date||n.next_due_date}`,class:S(["week-task-item mb-1",{"opacity-60":n.is_projection}])},[s(D,{icon:((r=n.category)==null?void 0:r.icon)||"mdi-checkbox-blank-circle",color:((l=n.category)==null?void 0:l.color)||"grey",size:"x-small",class:"mr-1"},null,8,["icon","color"]),g("span",xe,m(n.title),1)],2)}),128)),x(e.date).length>4?(i(),y("div",he," +"+m(x(e.date).length-4)+" weitere ",1)):k("",!0),x(e.date).length===0?(i(),y("div",we," - ")):k("",!0)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])),s(C,{elevation:"0",class:"mt-4"},{default:o(()=>[s(N,{class:"d-flex align-center ga-4 text-caption"},{default:o(()=>[g("span",Se,[s(D,{icon:"mdi-checkbox-blank-circle-outline",size:"small",color:"primary",class:"mr-1"}),a[6]||(a[6]=d(" FÃ¤llig ",-1))]),g("span",ke,[s(D,{icon:"mdi-calendar-clock",size:"small",color:"grey",class:"mr-1"}),a[7]||(a[7]=d(" Projektion (basierend auf Wiederholungsmuster) ",-1))])]),_:1})]),_:1})]),_:1})]),_:1}))}},je=Z(be,[["__scopeId","data-v-6ab3c24b"]]);export{je as default};
