import{r as k,v as A,x as we,c as V,o as u,w as n,b as l,f as j,i as be,j as ul,k as ae,y as _,m as fe,z as cl,A as h,h as s,B as m,t as d,C as ne,D as _e,E as ce,F as p,G as N,H as W,I as ge,l as g,J as Q,K as dl,q as ze,p as M,s as q,L as Le,_ as vl,M as ml,N as pl,O as J,P as fl,a as _l,V as gl,d as yl,e as xl,Q as hl,R as Z,S as kl,T as Ce,U as de,W as bl,X as ve,Y as ke,Z as Be,g as We,$ as wl,a0 as me,a1 as pe,a2 as Vl,a3 as Sl,a4 as Dl,a5 as $l}from"./index-D2XvMCja.js";import{u as Cl}from"./spaces-Dr5yf0Q9.js";const zl={class:"d-flex flex-wrap ga-2 mt-3"},Fl={class:"mt-3"},Tl={class:"mt-3"},Il={class:"mt-3"},Ml={key:1,class:"mt-2"},Nl={key:2,class:"mt-2"},Ol={key:0,class:"mt-2"},Al={key:1,class:"mt-2"},Ul={key:3,class:"mt-3"},El={class:"mt-3"},Je={__name:"TaskDialogNew",props:{modelValue:{type:Boolean,required:!0},task:{type:Object,default:null},categories:{type:Array,default:()=>[]},spaces:{type:Array,default:()=>[]},defaultSpaceId:{type:Number,default:null},spaceMembers:{type:Array,default:()=>[]}},emits:["update:modelValue","save"],setup(ye,{emit:Fe}){const x=ye,Ve=Fe,ie=k(null),$=k(!1),z=k(!1),F=k(!1),Y=k(!1),U=k("weekly"),B=k([]),O=k([]),G=k(""),v=["So","Mo","Di","Mi","Do","Fr","Sa"],r=k(D()),ee=A(()=>r.value.space_id?x.categories.filter(c=>c.space_id===r.value.space_id):x.categories),se=A(()=>{const c=x.spaces.find(i=>i.id===r.value.space_id);return(c==null?void 0:c.name)||"Space"});we(()=>r.value.space_id,(c,i)=>{if(c!==i&&!x.task){const w=ee.value[0];r.value.category_id=(w==null?void 0:w.id)||null}});function D(){var c,i;return{title:"",description:"",space_id:x.defaultSpaceId||((c=x.spaces[0])==null?void 0:c.id)||null,category_id:((i=x.categories[0])==null?void 0:i.id)||null,priority:"medium",effort:"medium",assigned_to:[],recurrence_type:"no_date",interval_days:1,interval_exclude_weekends:!1,schedule_pattern:null,has_specific_time:!1,time_of_day:"09:00",grace_period_minutes:120,next_due_date:C()}}function C(){return new Date().toISOString().split("T")[0]}function T(c){const i=new Date(c);return`${["So","Mo","Di","Mi","Do","Fr","Sa"][i.getDay()]}, ${i.getDate()}.${i.getMonth()+1}.`}function K(c){return x.categories.find(i=>i.id===c)}function H(c){const i=new Date;return i.setHours(0,0,0,0),c.type==="weekly"?le(c.weekdays,i):c.type==="monthly"?S(c.days,i):i.toISOString().split("T")[0]}function le(c,i){const w=[...c].sort((b,X)=>b-X),o=new Date(i);for(let b=0;b<8;b++){const X=o.getDay();if(w.includes(X))return o.toISOString().split("T")[0];o.setDate(o.getDate()+1)}return i.toISOString().split("T")[0]}function S(c,i){const w=[...c].sort((R,L)=>R-L),o=new Date(i),b=o.getDate(),X=w.find(R=>R>=b);if(X){const R=new Date(o.getFullYear(),o.getMonth(),X);if(R.getDate()===X)return R.toISOString().split("T")[0]}o.setMonth(o.getMonth()+1);for(const R of w){const L=new Date(o.getFullYear(),o.getMonth(),R);if(L.getDate()===R)return L.toISOString().split("T")[0]}return i.toISOString().split("T")[0]}function I(){if(r.value.recurrence_type==="no_date")return"Ohne Datum";if(r.value.recurrence_type==="one_time")return r.value.next_due_date?T(r.value.next_due_date):"Einmalig";if(r.value.recurrence_type==="interval"){const c=r.value.interval_days||1;return`Alle ${c} Tag${c>1?"e":""}`}return r.value.recurrence_type==="schedule"?U.value==="weekly"?`Wöchentlich (${B.value.length} Tage)`:`Monatlich (${O.value.length} Tage)`:r.value.recurrence_type==="inactive"?"Inaktiv":"Wiederholung"}we(()=>x.modelValue,c=>{c&&!x.task&&(r.value=D(),z.value=!1,F.value=!1,Y.value=!1,B.value=[],O.value=[])}),we(()=>x.task,c=>{var i,w;if(c){let o=[];if(c.assigned_to&&typeof c.assigned_to=="string"&&c.assigned_to.trim()&&(o=c.assigned_to.split(",").map(Number)),r.value={title:c.title||"",description:c.description||"",space_id:c.space_id||x.defaultSpaceId||((i=x.spaces[0])==null?void 0:i.id)||null,category_id:c.category_id||((w=x.categories[0])==null?void 0:w.id)||null,priority:c.priority||"medium",effort:c.effort||"medium",assigned_to:o,recurrence_type:c.recurrence_type||"one_time",interval_days:c.interval_days||1,interval_exclude_weekends:!!c.interval_exclude_weekends,schedule_pattern:c.schedule_pattern||null,has_specific_time:!!c.has_specific_time,time_of_day:c.time_of_day||"09:00",grace_period_minutes:c.grace_period_minutes||120,next_due_date:c.next_due_date||C()},c.schedule_pattern)try{const b=JSON.parse(c.schedule_pattern);b.type==="weekly"?(U.value="weekly",B.value=b.weekdays||[]):b.type==="monthly"&&(U.value="monthly",O.value=b.days||[]),G.value=b.comment||""}catch(b){console.error("Failed to parse schedule pattern:",b)}c.category_id&&(z.value=!1),c.recurrence_type!=="one_time"&&(F.value=!0),(c.priority!=="medium"||c.effort!=="medium"||c.has_specific_time)&&(Y.value=!0)}},{immediate:!0});function Se(){Ve("update:modelValue",!1),setTimeout(()=>{r.value=D(),z.value=!1,F.value=!1,Y.value=!1,B.value=[],O.value=[]},300)}async function te(){const{valid:c}=await ie.value.validate();if(!c)return;const i={title:r.value.title,description:r.value.description||null,space_id:r.value.space_id,category_id:r.value.category_id||null,priority:r.value.priority,effort:r.value.effort,assigned_to:null,recurrence_type:r.value.recurrence_type,has_specific_time:r.value.has_specific_time?1:0,time_of_day:r.value.has_specific_time?r.value.time_of_day:null,grace_period_minutes:r.value.has_specific_time?r.value.grace_period_minutes:null};if(r.value.recurrence_type==="no_date")i.next_due_date=null;else if(r.value.recurrence_type==="one_time")i.next_due_date=r.value.next_due_date;else if(r.value.recurrence_type==="interval")i.interval_days=r.value.interval_days,i.interval_exclude_weekends=r.value.interval_exclude_weekends?1:0,i.next_due_date=r.value.next_due_date;else if(r.value.recurrence_type==="schedule"){const w={type:U.value,comment:G.value||null};if(U.value==="weekly"){if(B.value.length===0){alert("Bitte mindestens einen Wochentag auswählen");return}w.weekdays=B.value.sort((o,b)=>o-b)}else if(U.value==="monthly"){if(O.value.length===0){alert("Bitte mindestens einen Monatstag auswählen");return}w.days=O.value.sort((o,b)=>o-b)}i.schedule_pattern=JSON.stringify(w),i.next_due_date=H(w)}else r.value.recurrence_type==="inactive"&&(i.next_due_date=null);Ve("save",i),Se()}return(c,i)=>(u(),V(Le,{"model-value":ye.modelValue,"onUpdate:modelValue":i[18]||(i[18]=w=>c.$emit("update:modelValue",w)),scrollable:""},{default:n(()=>[l(j,null,{default:n(()=>[l(be,{class:"pa-4"},{default:n(()=>[l(ul,{ref_key:"formRef",ref:ie,onSubmit:ae(te,["prevent"])},{default:n(()=>{var w;return[l(fe,{modelValue:r.value.title,"onUpdate:modelValue":i[0]||(i[0]=o=>r.value.title=o),label:"Neue Aufgabe",variant:"outlined",autofocus:"",rules:[o=>!!o||"Titel ist erforderlich"],"hide-details":"auto",onKeydown:cl(ae(te,["prevent"]),["enter"])},null,8,["modelValue","rules","onKeydown"]),_("div",zl,[l(h,{variant:"outlined",onClick:i[1]||(i[1]=o=>$.value=!$.value)},{default:n(()=>[l(m,{start:"",icon:"mdi-folder"}),s(" "+d(se.value),1)]),_:1}),l(h,{color:r.value.category_id?(w=K(r.value.category_id))==null?void 0:w.color:"grey",variant:"outlined",onClick:i[2]||(i[2]=o=>z.value=!z.value)},{default:n(()=>{var o,b;return[l(m,{start:"",icon:r.value.category_id?(o=K(r.value.category_id))==null?void 0:o.icon:"mdi-tag"},null,8,["icon"]),s(" "+d(r.value.category_id?(b=K(r.value.category_id))==null?void 0:b.name:"Kategorie"),1)]}),_:1},8,["color"]),l(h,{variant:"outlined",onClick:i[3]||(i[3]=o=>F.value=!F.value)},{default:n(()=>[l(m,{start:"",icon:"mdi-refresh"}),s(" "+d(I()),1)]),_:1}),l(h,{variant:"outlined",onClick:i[4]||(i[4]=o=>Y.value=!Y.value)},{default:n(()=>[l(m,{start:"",icon:"mdi-note-text-outline"}),i[19]||(i[19]=s(" Notizen ",-1))]),_:1})]),l(ne,null,{default:n(()=>[_e(_("div",Fl,[i[20]||(i[20]=_("div",{class:"text-caption mb-2"},"Space",-1)),l(ce,{modelValue:r.value.space_id,"onUpdate:modelValue":i[5]||(i[5]=o=>r.value.space_id=o),column:"",mandatory:""},{default:n(()=>[(u(!0),p(N,null,W(ye.spaces,o=>(u(),V(h,{key:o.id,value:o.id,variant:"outlined",filter:""},{default:n(()=>[l(m,{start:"",icon:"mdi-folder"}),s(" "+d(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])],512),[[ge,$.value]])]),_:1}),l(ne,null,{default:n(()=>[_e(_("div",Tl,[i[21]||(i[21]=_("div",{class:"text-caption mb-2"},"Kategorie",-1)),l(ce,{modelValue:r.value.category_id,"onUpdate:modelValue":i[6]||(i[6]=o=>r.value.category_id=o),column:"",mandatory:""},{default:n(()=>[(u(!0),p(N,null,W(ee.value,o=>(u(),V(h,{key:o.id,value:o.id,color:o.color,variant:"outlined",filter:""},{default:n(()=>[l(m,{start:"",icon:o.icon},null,8,["icon"]),s(" "+d(o.name),1)]),_:2},1032,["value","color"]))),128))]),_:1},8,["modelValue"])],512),[[ge,z.value]])]),_:1}),l(ne,null,{default:n(()=>[_e(_("div",Il,[i[31]||(i[31]=_("div",{class:"text-caption mb-2"},"Wiederholung",-1)),l(ce,{modelValue:r.value.recurrence_type,"onUpdate:modelValue":i[7]||(i[7]=o=>r.value.recurrence_type=o),column:"",mandatory:""},{default:n(()=>[l(h,{value:"no_date",variant:"outlined",filter:""},{default:n(()=>[...i[22]||(i[22]=[s("Ohne Datum",-1)])]),_:1}),l(h,{value:"one_time",variant:"outlined",filter:""},{default:n(()=>[...i[23]||(i[23]=[s("Einmalig",-1)])]),_:1}),l(h,{value:"interval",variant:"outlined",filter:""},{default:n(()=>[...i[24]||(i[24]=[s("Alle X Tage",-1)])]),_:1}),l(h,{value:"schedule",variant:"outlined",filter:""},{default:n(()=>[...i[25]||(i[25]=[s("Zeitplan",-1)])]),_:1}),l(h,{value:"inactive",variant:"outlined",filter:""},{default:n(()=>[...i[26]||(i[26]=[s("Inaktiv",-1)])]),_:1})]),_:1},8,["modelValue"]),r.value.recurrence_type==="one_time"?(u(),V(fe,{key:0,modelValue:r.value.next_due_date,"onUpdate:modelValue":i[8]||(i[8]=o=>r.value.next_due_date=o),label:"Fällig am",type:"date",variant:"outlined","hide-details":"",class:"mt-2"},null,8,["modelValue"])):g("",!0),r.value.recurrence_type==="interval"?(u(),p("div",Ml,[l(fe,{modelValue:r.value.interval_days,"onUpdate:modelValue":i[9]||(i[9]=o=>r.value.interval_days=o),modelModifiers:{number:!0},label:"Alle X Tage",type:"number",min:"1",variant:"outlined","hide-details":""},null,8,["modelValue"]),l(Q,{modelValue:r.value.interval_exclude_weekends,"onUpdate:modelValue":i[10]||(i[10]=o=>r.value.interval_exclude_weekends=o),label:"Wochenenden ausschließen","hide-details":"",density:"compact",class:"mt-2"},null,8,["modelValue"]),l(fe,{modelValue:r.value.next_due_date,"onUpdate:modelValue":i[11]||(i[11]=o=>r.value.next_due_date=o),label:"Erstes Fälligkeitsdatum",type:"date",variant:"outlined","hide-details":"",class:"mt-2"},null,8,["modelValue"])])):g("",!0),r.value.recurrence_type==="schedule"?(u(),p("div",Nl,[l(ce,{modelValue:U.value,"onUpdate:modelValue":i[12]||(i[12]=o=>U.value=o),column:"",mandatory:""},{default:n(()=>[l(h,{value:"weekly",variant:"outlined",filter:""},{default:n(()=>[...i[27]||(i[27]=[s("Wöchentlich",-1)])]),_:1}),l(h,{value:"monthly",variant:"outlined",filter:""},{default:n(()=>[...i[28]||(i[28]=[s("Monatlich",-1)])]),_:1})]),_:1},8,["modelValue"]),U.value==="weekly"?(u(),p("div",Ol,[i[29]||(i[29]=_("div",{class:"text-caption mb-2"},"Wochentage",-1)),l(ce,{modelValue:B.value,"onUpdate:modelValue":i[13]||(i[13]=o=>B.value=o),multiple:"",column:""},{default:n(()=>[(u(),p(N,null,W(v,(o,b)=>l(h,{key:b,value:b,variant:"outlined",filter:""},{default:n(()=>[s(d(o),1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])])):g("",!0),U.value==="monthly"?(u(),p("div",Al,[i[30]||(i[30]=_("div",{class:"text-caption mb-2"},"Monatstage",-1)),l(ce,{modelValue:O.value,"onUpdate:modelValue":i[14]||(i[14]=o=>O.value=o),multiple:"",column:""},{default:n(()=>[(u(),p(N,null,W(31,o=>l(h,{key:o,value:o,variant:"outlined",filter:"",size:"small"},{default:n(()=>[s(d(o)+". ",1)]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"])])):g("",!0)])):g("",!0),["interval","schedule","one_time"].includes(r.value.recurrence_type)?(u(),p("div",Ul,[l(Q,{modelValue:r.value.has_specific_time,"onUpdate:modelValue":i[15]||(i[15]=o=>r.value.has_specific_time=o),label:"Zu einer bestimmten Uhrzeit","hide-details":"",density:"compact"},null,8,["modelValue"]),r.value.has_specific_time?(u(),V(fe,{key:0,modelValue:r.value.time_of_day,"onUpdate:modelValue":i[16]||(i[16]=o=>r.value.time_of_day=o),label:"Uhrzeit",type:"time",variant:"outlined","hide-details":"",class:"mt-2"},null,8,["modelValue"])):g("",!0)])):g("",!0)],512),[[ge,F.value]])]),_:1}),l(ne,null,{default:n(()=>[_e(_("div",El,[l(dl,{modelValue:r.value.description,"onUpdate:modelValue":i[17]||(i[17]=o=>r.value.description=o),label:"Notizen",variant:"outlined",rows:"2","hide-details":""},null,8,["modelValue"])],512),[[ge,Y.value]])]),_:1})]}),_:1},512)]),_:1}),l(ze,{class:"px-4 pb-4"},{default:n(()=>[l(M,{variant:"text",color:"error",onClick:Se},{default:n(()=>[...i[32]||(i[32]=[s("Abbrechen",-1)])]),_:1}),l(q),l(M,{variant:"text",color:"primary",onClick:te},{default:n(()=>[s(d(ye.task?"Speichern":"Erstellen"),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Bl={class:"mb-4"},Wl={class:"d-flex align-center flex-wrap ga-2"},Ll={key:0,class:"mb-6"},Pl={class:"d-flex align-center mb-3"},Kl={class:"d-flex align-center flex-wrap ga-2 mb-1"},Rl={key:0,class:"d-inline-flex align-center text-caption"},Jl={key:1,class:"d-inline-flex align-center text-caption"},Zl={class:"text-error text-caption"},Yl={key:0,class:"d-inline-flex align-center text-caption"},Gl={class:"d-inline-flex align-center text-caption"},Hl={class:"mb-6"},Xl={class:"d-flex align-center mb-3"},jl={class:"d-flex align-center flex-wrap ga-2 mb-1"},ql={key:0,class:"d-inline-flex align-center text-caption"},Ql={key:1,class:"d-inline-flex align-center text-caption"},et={key:0,class:"d-inline-flex align-center text-caption"},lt={class:"d-inline-flex align-center text-caption"},tt={key:1,class:"mb-6"},at={class:"d-flex align-center flex-wrap ga-2 mb-1"},nt={key:0,class:"d-inline-flex align-center text-caption"},it={key:1,class:"d-inline-flex align-center text-caption"},st={class:"d-inline-flex align-center text-caption"},ot={key:0,class:"d-inline-flex align-center text-caption"},rt={class:"d-inline-flex align-center text-caption"},ut={class:"d-flex align-center flex-wrap ga-2 mb-1"},ct={key:0,class:"d-inline-flex align-center text-caption"},dt={key:1,class:"d-inline-flex align-center text-caption"},vt={class:"d-inline-flex align-center text-caption"},mt={key:0,class:"d-inline-flex align-center text-caption"},pt={class:"d-inline-flex align-center text-caption"},ft={class:"d-flex align-center flex-wrap ga-2 mb-1"},_t={key:0,class:"d-inline-flex align-center text-caption"},gt={key:1,class:"d-inline-flex align-center text-caption"},yt={class:"d-inline-flex align-center text-caption"},xt={key:0,class:"d-inline-flex align-center text-caption"},ht={class:"d-inline-flex align-center text-caption"},kt={key:2,class:"mb-6"},bt={class:"d-flex align-center flex-wrap ga-2 mb-1"},wt={key:0,class:"d-inline-flex align-center text-caption"},Vt={key:1,class:"d-inline-flex align-center text-caption"},St={class:"text-h6 flex-grow-1"},Dt={class:"d-flex flex-wrap ga-2 mb-3"},$t={key:0,class:"text-body-2 text-medium-emphasis"},Ct={class:"text-body-2 text-medium-emphasis mb-3"},zt={class:"d-flex flex-wrap ga-2 mb-4"},Ft={class:"d-flex align-center"},Tt={key:0,class:"ml-8 mt-2"},It={key:0,class:"text-caption text-medium-emphasis"},Mt={__name:"DashboardEnhanced",setup(ye){const Fe=_l(),x=Cl(),Ve=pl(),ie=k(!1),$=k([]),z=k([]),F=k(!1),Y=k(!1),U=k(!1),B=k(!1),O=k(!1),G=k(""),v=k(null),r=k(navigator.onLine),ee=k(!1),se=k(!1),D=k(!1),C=k(""),T=k("success"),K=k(2e3),H=k(!1),le=k(null);window.addEventListener("online",()=>{r.value=!0}),window.addEventListener("offline",()=>{r.value=!1});const S=k([]),I=k([]);function Se(){const a=localStorage.getItem("dashboard-space-filter");if(a)try{S.value=JSON.parse(a)}catch{S.value=[]}else S.value=x.spaces.map(e=>e.id)}function te(){localStorage.setItem("dashboard-space-filter",JSON.stringify(S.value))}function c(a){const e=S.value.indexOf(a);e===-1?S.value.push(a):S.value.splice(e,1),te()}we(S,te,{deep:!0});function i(){const a=localStorage.getItem("dashboard-category-filter");if(a)try{I.value=JSON.parse(a)}catch{I.value=[]}else I.value=z.value.map(e=>e.id)}function w(){localStorage.setItem("dashboard-category-filter",JSON.stringify(I.value))}function o(a){const e=I.value.indexOf(a);e===-1?I.value.push(a):I.value.splice(e,1),w()}we(I,w,{deep:!0}),A(()=>S.value.length===0?z.value:z.value.filter(a=>S.value.includes(a.space_id)));function b(a){return z.value.filter(e=>e.space_id===a)}const X=A(()=>{const a=S.value.length===x.spaces.length,e=I.value.length===z.value.length;return!a||!e});function R(){S.value=x.spaces.map(a=>a.id),I.value=z.value.map(a=>a.id),te(),w()}const L=A(()=>{let a=$.value.filter(e=>e.recurrence_type!=="inactive");return S.value.length>0&&(a=a.filter(e=>S.value.includes(e.space_id))),I.value.length>0&&(a=a.filter(e=>!e.category_id||I.value.includes(e.category_id))),a}),Te=A(()=>{let a=$.value.filter(e=>e.recurrence_type==="inactive");return S.value.length>0&&(a=a.filter(e=>S.value.includes(e.space_id))),I.value.length>0&&(a=a.filter(e=>!e.category_id||I.value.includes(e.category_id))),a});function xe(a){return a.sort((e,f)=>!e.has_specific_time&&f.has_specific_time?-1:e.has_specific_time&&!f.has_specific_time?1:e.has_specific_time&&f.has_specific_time?e.time_of_day.localeCompare(f.time_of_day):0)}A(()=>{const a=new Date().toISOString().split("T")[0];return L.value.filter(e=>e.has_specific_time&&e.next_due_date===a).sort((e,f)=>e.time_of_day.localeCompare(f.time_of_day))});const Ie=A(()=>{const a=L.value.filter(e=>e.is_overdue&&!Ke(e));return xe(a)}),Me=A(()=>{const a=new Date().toISOString().split("T")[0],e=L.value.filter(f=>f.recurrence_type==="no_date"&&!f.is_overdue?!0:!f.is_overdue&&f.next_due_date===a&&!Ke(f));return xe(e)}),Ne=A(()=>{const a=new Date,e=new Date(a);e.setDate(e.getDate()+1);const f=e.toISOString().split("T")[0],t=L.value.filter(y=>y.next_due_date===f);return xe(t)}),Oe=A(()=>{const a=new Date,e=new Date(a);e.setDate(e.getDate()+1);const f=new Date(a);f.setDate(f.getDate()+7);const t=e.toISOString().split("T")[0],y=f.toISOString().split("T")[0],P=L.value.filter(E=>E.next_due_date>t&&E.next_due_date<=y);return xe(P)}),Ae=A(()=>{const a=new Date,e=new Date(a);e.setDate(e.getDate()+7);const f=e.toISOString().split("T")[0],t=L.value.filter(y=>y.next_due_date>f);return xe(t)}),Pe=A(()=>{const a=new Date().toISOString().split("T")[0];return L.value.filter(e=>e.next_due_date>a)});function Ke(a){const e=new Date().toISOString().split("T")[0];return a.has_specific_time&&a.next_due_date===e}function Ze(a){return a<=1?"#FFCDD2":a<=2?"#EF9A9A":a<=3?"#E57373":a<=5?"#EF5350":"#D32F2F"}function Ye(a){return a<=2?"#000000":"#FFFFFF"}const De=A(()=>x.spaces.length===0?null:x.spaces[0].id);A(()=>De.value?z.value.filter(a=>a.space_id===De.value):[]);function Ge(){U.value=!0}ml(async()=>{await he(),Se(),i(),Ve.on("dashboard:refresh",he)});async function he(){ie.value=!0;try{await x.fetchSpaces();const a=x.spaces.map(async y=>{try{return(await J.get(`/spaces/${y.id}/tasks`)).tasks.map(E=>({...E,space_id:y.id,space_name:y.personal_name||y.name,space_color:y.personal_color}))}catch(P){return console.error(`Failed to fetch tasks for space ${y.id}:`,P),[]}}),e=x.spaces.map(async y=>{try{return(await J.get(`/spaces/${y.id}/categories`)).categories.map(E=>({...E,space_id:y.id}))}catch{return[]}}),[f,t]=await Promise.all([Promise.all(a),Promise.all(e)]);$.value=f.flat(),z.value=t.flat()}finally{ie.value=!1}}function oe(a){v.value=a,F.value=!0}async function re(a){var e,f;try{const t=$.value.findIndex(E=>E.space_id===a.space_id&&E.id===a.id);t!==-1&&($.value[t]={...$.value[t],completing:!0}),await new Promise(E=>setTimeout(E,500));const y=await J.post(`/spaces/${a.space_id}/tasks/${a.id}/complete`,{});!y.next_due_date||((e=y.task)==null?void 0:e.recurrence_type)==="one_time"||((f=y.task)==null?void 0:f.recurrence_type)==="no_date"?$.value=$.value.filter(E=>!(E.space_id===a.space_id&&E.id===a.id)):y.task&&t!==-1&&($.value[t]={...y.task,space_id:a.space_id,space_name:a.space_name,space_color:a.space_color}),C.value=`Erledigt: ${a.title}`,T.value="success",D.value=!0}catch(t){console.error("Failed to complete task:",t),C.value="Fehler beim Erledigen",T.value="error",D.value=!0}}async function He(){await re(v.value),F.value=!1}async function Xe(){try{const a=await J.post(`/spaces/${v.value.space_id}/tasks/${v.value.id}/skip`,{}),e=$.value.findIndex(f=>f.space_id===v.value.space_id&&f.id===v.value.id);e!==-1&&($.value[e]={...a.task,space_id:v.value.space_id,space_name:v.value.space_name,space_color:v.value.space_color}),F.value=!1,C.value="Aufgabe übersprungen",T.value="success",D.value=!0}catch(a){console.error("Failed to skip task:",a),C.value="Fehler beim Überspringen",T.value="error",D.value=!0}}function je(a){return a&&["interval","schedule"].includes(a.recurrence_type)}function qe(a){return a&&["one_time","interval","schedule"].includes(a.recurrence_type)}function Qe(){G.value="",F.value=!1,O.value=!0}function Re(a){if(!a)return"Kein Datum";const e=new Date(a);return`${["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"][e.getDay()]}, ${e.getDate()}.${e.getMonth()+1}.${e.getFullYear()}`}async function Ue(a){await $e({days:a})}async function el(){const a=new Date;a.setDate(a.getDate()+1),await $e({new_date:a.toISOString().split("T")[0]})}async function ll(){const a=new Date;a.setDate(a.getDate()+7),await $e({new_date:a.toISOString().split("T")[0]})}async function tl(){G.value&&await $e({new_date:G.value})}async function $e(a){try{const e=await J.post(`/spaces/${v.value.space_id}/tasks/${v.value.id}/postpone`,a),f=$.value.findIndex(t=>t.space_id===v.value.space_id&&t.id===v.value.id);f!==-1&&($.value[f]={...e.task,space_id:v.value.space_id,space_name:v.value.space_name,space_color:v.value.space_color}),O.value=!1,C.value=`Verschoben auf ${Re(e.next_due_date)}`,T.value="success",D.value=!0}catch(e){console.error("Failed to postpone task:",e),C.value="Fehler beim Verschieben",T.value="error",D.value=!0}}function al(){F.value=!1,Y.value=!0}async function nl(a){try{const e=v.value.space_id,f=a.space_id;f&&f!==e?(await J.post(`/spaces/${f}/tasks`,a),await J.delete(`/spaces/${e}/tasks/${v.value.id}`)):await J.patch(`/spaces/${e}/tasks/${v.value.id}`,a),await he(),C.value="Aufgabe aktualisiert",T.value="success",D.value=!0}catch(e){console.error("Failed to save task:",e),C.value="Fehler beim Speichern",T.value="error",D.value=!0}}async function il(a){const e=a.space_id||De.value;if(!e){C.value="Kein Space verfügbar",T.value="error",K.value=2e3,H.value=!1,D.value=!0;return}try{const f=await J.post(`/spaces/${e}/tasks`,a);await he(),le.value={id:f.task.id,space_id:e},C.value=`Erstellt: ${a.title}`,T.value="success",K.value=4e3,H.value=!0,D.value=!0}catch(f){console.error("Failed to create task:",f),C.value="Fehler beim Erstellen",T.value="error",K.value=2e3,H.value=!1,D.value=!0}}function Ee(a){if(!a.next_due_date)return"";const e=new Date(a.next_due_date);return`${["So","Mo","Di","Mi","Do","Fr","Sa"][e.getDay()]}, ${e.getDate()}.${e.getMonth()+1}.`}function ue(a){if(a.recurrence_type==="no_date")return"Ohne Datum";if(a.recurrence_type==="one_time")return"Einmalig";if(a.recurrence_type==="interval"){const e=a.interval_days||1;return`Alle ${e} Tag${e>1?"e":""}`}if(a.recurrence_type==="schedule")try{const e=JSON.parse(a.schedule_pattern);if(e.type==="weekly")return"Wöchentlich";if(e.type==="monthly")return"Monatlich"}catch{return"Zeitplan"}return"Wiederholend"}function sl(){F.value=!1,Fe.push("/history")}async function ol(){if(confirm(`Möchten Sie die Aufgabe "${v.value.title}" wirklich löschen?`))try{await J.delete(`/spaces/${v.value.space_id}/tasks/${v.value.id}`),$.value=$.value.filter(a=>!(a.space_id===v.value.space_id&&a.id===v.value.id)),F.value=!1,C.value="Aufgabe gelöscht",T.value="success",K.value=2e3,H.value=!1,D.value=!0}catch(a){console.error("Failed to delete task:",a),C.value="Fehler beim Löschen",T.value="error",K.value=2e3,H.value=!1,D.value=!0}}async function rl(){if(le.value)try{await J.delete(`/spaces/${le.value.space_id}/tasks/${le.value.id}`),await he(),le.value=null,D.value=!1}catch(a){console.error("Failed to undo:",a),C.value="Rückgängig fehlgeschlagen",T.value="error",K.value=2e3,H.value=!1,D.value=!0}}return(a,e)=>(u(),V(fl,{class:"bg-background"},{default:n(()=>{var f;return[l(gl,{fluid:"",class:"pa-4"},{default:n(()=>[ie.value?(u(),V(yl,{key:0},{default:n(()=>[l(xl,{cols:"12",class:"text-center py-8"},{default:n(()=>[l(hl,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):(u(),p(N,{key:1},[_("div",Bl,[_("div",Wl,[(u(!0),p(N,null,W(Z(x).spaces,t=>(u(),V(h,{key:t.id,variant:S.value.includes(t.id)?"flat":"outlined",color:S.value.includes(t.id)?t.personal_color||"primary":"",onClick:y=>c(t.id),size:"small"},{default:n(()=>[l(m,{icon:"mdi-folder",size:"small",class:"mr-1"}),s(" "+d(t.personal_name||t.name),1)]),_:2},1032,["variant","color","onClick"]))),128)),l(q),l(kl,{"model-value":X.value,dot:"",color:"primary","offset-x":"-2","offset-y":"-2"},{default:n(()=>[l(M,{icon:"mdi-filter-variant",size:"small",variant:"text",onClick:e[0]||(e[0]=t=>B.value=!0)})]),_:1},8,["model-value"])])]),Ie.value.length>0?(u(),p("div",Ll,[_("div",Pl,[l(m,{icon:"mdi-alert-circle",color:"error",class:"mr-2"}),e[17]||(e[17]=_("h2",{class:"text-h6 font-weight-bold text-error"},"Überfällig",-1)),l(h,{size:"small",color:"error",class:"ml-2"},{default:n(()=>[s(d(Ie.value.length),1)]),_:1})]),l(j,{elevation:"0"},{default:n(()=>[l(Ce,{class:"pa-0",lines:"two"},{default:n(()=>[(u(!0),p(N,null,W(Ie.value,(t,y)=>(u(),V(de,{key:`${t.space_id}-${t.id}`,onClick:P=>oe(t),class:"px-4 py-3",style:bl({backgroundColor:Ze(t.days_overdue),color:Ye(t.days_overdue)})},{prepend:n(()=>[l(Q,{"model-value":t.completing||!1,onClick:ae(P=>re(t),["stop"]),"hide-details":"",color:"success",density:"compact",class:"mr-4"},null,8,["model-value","onClick"])]),default:n(()=>[_("div",Kl,[Z(x).spaces.length>1?(u(),p("span",Rl,[l(m,{icon:"mdi-folder",size:"small",class:"mr-1",color:t.space_color||"grey"},null,8,["color"]),s(" "+d(t.space_name),1)])):g("",!0),t.category?(u(),p("span",Jl,[l(m,{icon:t.category.icon||"mdi-tag",color:t.category.color,size:"small",class:"mr-1"},null,8,["icon","color"]),s(" "+d(t.category.name),1)])):g("",!0)]),l(ve,{class:"text-body-1 font-weight-medium"},{default:n(()=>[s(d(t.title),1)]),_:2},1024),l(ke,{class:"d-flex align-center flex-wrap ga-2 mt-1"},{default:n(()=>[_("span",Zl,d(t.days_overdue)+"d überfällig",1),t.has_specific_time?(u(),p("span",Yl,[l(m,{icon:"mdi-clock-outline",size:"small",class:"mr-1"}),s(" "+d(t.time_of_day),1)])):g("",!0),_("span",Gl,[l(m,{icon:"mdi-refresh",size:"small",class:"mr-1"}),s(" "+d(ue(t)),1)])]),_:2},1024)]),_:2},1032,["onClick","style"]))),128))]),_:1})]),_:1})])):g("",!0),_("div",Hl,[_("div",Xl,[l(m,{icon:"mdi-calendar-today",color:"warning",class:"mr-2"}),e[18]||(e[18]=_("h2",{class:"text-h6 font-weight-bold"},"Heute",-1)),l(h,{size:"small",color:"warning",class:"ml-2"},{default:n(()=>[s(d(Me.value.length),1)]),_:1})]),Me.value.length>0?(u(),V(j,{key:0,elevation:"0"},{default:n(()=>[l(Ce,{class:"pa-0",lines:"two"},{default:n(()=>[(u(!0),p(N,null,W(Me.value,(t,y)=>(u(),V(de,{key:`${t.space_id}-${t.id}`,onClick:P=>oe(t),class:"px-4 py-3"},{prepend:n(()=>[l(Q,{"model-value":t.completing||!1,onClick:ae(P=>re(t),["stop"]),"hide-details":"",color:"success",density:"compact",class:"mr-4"},null,8,["model-value","onClick"])]),default:n(()=>[_("div",jl,[Z(x).spaces.length>1?(u(),p("span",ql,[l(m,{icon:"mdi-folder",size:"small",class:"mr-1",color:t.space_color||"grey"},null,8,["color"]),s(" "+d(t.space_name),1)])):g("",!0),t.category?(u(),p("span",Ql,[l(m,{icon:t.category.icon||"mdi-tag",color:t.category.color,size:"small",class:"mr-1"},null,8,["icon","color"]),s(" "+d(t.category.name),1)])):g("",!0)]),l(ve,{class:"text-body-1 font-weight-medium"},{default:n(()=>[s(d(t.title),1)]),_:2},1024),l(ke,{class:"d-flex align-center flex-wrap ga-2 mt-1"},{default:n(()=>[t.has_specific_time?(u(),p("span",et,[l(m,{icon:"mdi-clock-outline",size:"small",class:"mr-1"}),s(" "+d(t.time_of_day),1)])):g("",!0),_("span",lt,[l(m,{icon:"mdi-refresh",size:"small",class:"mr-1"}),s(" "+d(ue(t)),1)])]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})):(u(),V(j,{key:1,elevation:"0"},{default:n(()=>[l(be,{class:"text-center py-8"},{default:n(()=>[l(m,{size:"48",color:"grey-lighten-1"},{default:n(()=>[...e[19]||(e[19]=[s("mdi-check-circle-outline",-1)])]),_:1}),e[20]||(e[20]=_("div",{class:"text-body-2 text-medium-emphasis mt-2"}," Keine Aufgaben für heute ",-1))]),_:1})]),_:1}))]),Pe.value.length>0?(u(),p("div",tt,[_("div",{class:"d-flex align-center mb-3 cursor-pointer",onClick:e[1]||(e[1]=t=>ee.value=!ee.value)},[l(m,{icon:"mdi-calendar-clock",class:"mr-2"}),e[21]||(e[21]=_("h2",{class:"text-h6 font-weight-bold"},"Demnächst",-1)),l(h,{size:"small",variant:"outlined",class:"ml-2"},{default:n(()=>[s(d(Pe.value.length),1)]),_:1}),l(q),l(m,{icon:ee.value?"mdi-chevron-up":"mdi-chevron-down"},null,8,["icon"])]),l(ne,null,{default:n(()=>[_e(l(j,{elevation:"0"},{default:n(()=>[l(Ce,{class:"pa-0",lines:"two"},{default:n(()=>[Ne.value.length>0?(u(),p(N,{key:0},[l(Be,{class:"px-4"},{default:n(()=>[e[22]||(e[22]=s(" Morgen ",-1)),l(h,{size:"x-small",class:"ml-2"},{default:n(()=>[s(d(Ne.value.length),1)]),_:1})]),_:1}),(u(!0),p(N,null,W(Ne.value,t=>(u(),V(de,{key:`${t.space_id}-${t.id}`,onClick:y=>oe(t),class:"px-4 py-3"},{prepend:n(()=>[l(Q,{"model-value":!1,onClick:ae(y=>re(t),["stop"]),"hide-details":"",color:"success",density:"compact",class:"mr-4"},null,8,["onClick"])]),default:n(()=>[_("div",at,[Z(x).spaces.length>1?(u(),p("span",nt,[l(m,{icon:"mdi-folder",size:"small",class:"mr-1",color:t.space_color||"grey"},null,8,["color"]),s(" "+d(t.space_name),1)])):g("",!0),t.category?(u(),p("span",it,[l(m,{icon:t.category.icon||"mdi-tag",color:t.category.color,size:"small",class:"mr-1"},null,8,["icon","color"]),s(" "+d(t.category.name),1)])):g("",!0)]),l(ve,{class:"text-body-1 font-weight-medium"},{default:n(()=>[s(d(t.title),1)]),_:2},1024),l(ke,{class:"d-flex align-center flex-wrap ga-2 mt-1"},{default:n(()=>[_("span",st,[l(m,{icon:"mdi-calendar",size:"small",class:"mr-1"}),s(" "+d(Ee(t)),1)]),t.has_specific_time?(u(),p("span",ot,[l(m,{icon:"mdi-clock-outline",size:"small",class:"mr-1"}),s(" "+d(t.time_of_day),1)])):g("",!0),_("span",rt,[l(m,{icon:"mdi-refresh",size:"small",class:"mr-1"}),s(" "+d(ue(t)),1)])]),_:2},1024)]),_:2},1032,["onClick"]))),128))],64)):g("",!0),Oe.value.length>0?(u(),p(N,{key:1},[l(Be,{class:"px-4"},{default:n(()=>[e[23]||(e[23]=s(" Nächste 7 Tage ",-1)),l(h,{size:"x-small",class:"ml-2"},{default:n(()=>[s(d(Oe.value.length),1)]),_:1})]),_:1}),(u(!0),p(N,null,W(Oe.value,t=>(u(),V(de,{key:`${t.space_id}-${t.id}`,onClick:y=>oe(t),class:"px-4 py-3"},{prepend:n(()=>[l(Q,{"model-value":!1,onClick:ae(y=>re(t),["stop"]),"hide-details":"",color:"success",density:"compact",class:"mr-4"},null,8,["onClick"])]),default:n(()=>[_("div",ut,[Z(x).spaces.length>1?(u(),p("span",ct,[l(m,{icon:"mdi-folder",size:"small",class:"mr-1",color:t.space_color||"grey"},null,8,["color"]),s(" "+d(t.space_name),1)])):g("",!0),t.category?(u(),p("span",dt,[l(m,{icon:t.category.icon||"mdi-tag",color:t.category.color,size:"small",class:"mr-1"},null,8,["icon","color"]),s(" "+d(t.category.name),1)])):g("",!0)]),l(ve,{class:"text-body-1 font-weight-medium"},{default:n(()=>[s(d(t.title),1)]),_:2},1024),l(ke,{class:"d-flex align-center flex-wrap ga-2 mt-1"},{default:n(()=>[_("span",vt,[l(m,{icon:"mdi-calendar",size:"small",class:"mr-1"}),s(" "+d(Ee(t)),1)]),t.has_specific_time?(u(),p("span",mt,[l(m,{icon:"mdi-clock-outline",size:"small",class:"mr-1"}),s(" "+d(t.time_of_day),1)])):g("",!0),_("span",pt,[l(m,{icon:"mdi-refresh",size:"small",class:"mr-1"}),s(" "+d(ue(t)),1)])]),_:2},1024)]),_:2},1032,["onClick"]))),128))],64)):g("",!0),Ae.value.length>0?(u(),p(N,{key:2},[l(Be,{class:"px-4"},{default:n(()=>[e[24]||(e[24]=s(" Später ",-1)),l(h,{size:"x-small",class:"ml-2"},{default:n(()=>[s(d(Ae.value.length),1)]),_:1})]),_:1}),(u(!0),p(N,null,W(Ae.value,t=>(u(),V(de,{key:`${t.space_id}-${t.id}`,onClick:y=>oe(t),class:"px-4 py-3"},{prepend:n(()=>[l(Q,{"model-value":!1,onClick:ae(y=>re(t),["stop"]),"hide-details":"",color:"success",density:"compact",class:"mr-4"},null,8,["onClick"])]),default:n(()=>[_("div",ft,[Z(x).spaces.length>1?(u(),p("span",_t,[l(m,{icon:"mdi-folder",size:"small",class:"mr-1",color:t.space_color||"grey"},null,8,["color"]),s(" "+d(t.space_name),1)])):g("",!0),t.category?(u(),p("span",gt,[l(m,{icon:t.category.icon||"mdi-tag",color:t.category.color,size:"small",class:"mr-1"},null,8,["icon","color"]),s(" "+d(t.category.name),1)])):g("",!0)]),l(ve,{class:"text-body-1 font-weight-medium"},{default:n(()=>[s(d(t.title),1)]),_:2},1024),l(ke,{class:"d-flex align-center flex-wrap ga-2 mt-1"},{default:n(()=>[_("span",yt,[l(m,{icon:"mdi-calendar",size:"small",class:"mr-1"}),s(" "+d(Ee(t)),1)]),t.has_specific_time?(u(),p("span",xt,[l(m,{icon:"mdi-clock-outline",size:"small",class:"mr-1"}),s(" "+d(t.time_of_day),1)])):g("",!0),_("span",ht,[l(m,{icon:"mdi-refresh",size:"small",class:"mr-1"}),s(" "+d(ue(t)),1)])]),_:2},1024)]),_:2},1032,["onClick"]))),128))],64)):g("",!0)]),_:1})]),_:1},512),[[ge,ee.value]])]),_:1})])):g("",!0),Te.value.length>0?(u(),p("div",kt,[_("div",{class:"d-flex align-center mb-3 cursor-pointer",onClick:e[2]||(e[2]=t=>se.value=!se.value)},[l(m,{icon:"mdi-pause-circle-outline",class:"mr-2"}),e[25]||(e[25]=_("h2",{class:"text-h6 font-weight-bold"},"Inaktiv",-1)),l(h,{size:"small",variant:"outlined",class:"ml-2"},{default:n(()=>[s(d(Te.value.length),1)]),_:1}),l(q),l(m,{icon:se.value?"mdi-chevron-up":"mdi-chevron-down"},null,8,["icon"])]),l(ne,null,{default:n(()=>[_e(l(j,{elevation:"0"},{default:n(()=>[l(Ce,{class:"pa-0",lines:"two"},{default:n(()=>[(u(!0),p(N,null,W(Te.value,t=>(u(),V(de,{key:`${t.space_id}-${t.id}`,onClick:y=>oe(t),class:"px-4 py-3"},{default:n(()=>[_("div",bt,[Z(x).spaces.length>1?(u(),p("span",wt,[l(m,{icon:"mdi-folder",size:"small",class:"mr-1",color:t.space_color||"grey"},null,8,["color"]),s(" "+d(t.space_name),1)])):g("",!0),t.category?(u(),p("span",Vt,[l(m,{icon:t.category.icon||"mdi-tag",color:t.category.color,size:"small",class:"mr-1"},null,8,["icon","color"]),s(" "+d(t.category.name),1)])):g("",!0)]),l(ve,{class:"text-body-1 font-weight-medium"},{default:n(()=>[s(d(t.title),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},512),[[ge,se.value]])]),_:1})])):g("",!0),e[26]||(e[26]=_("div",{style:{height:"32px"}},null,-1))],64)),l(M,{icon:"mdi-plus",color:"primary",size:"large",position:"fixed",location:"bottom end",class:"mb-16 me-4",onClick:Ge})]),_:1}),l(Le,{modelValue:F.value,"onUpdate:modelValue":e[4]||(e[4]=t=>F.value=t),scrollable:""},{default:n(()=>[v.value?(u(),V(j,{key:0},{default:n(()=>[l(We,{class:"d-flex align-center pa-4"},{default:n(()=>[v.value.category?(u(),V(m,{key:0,color:v.value.category.color,icon:v.value.category.icon,class:"mr-2"},null,8,["color","icon"])):g("",!0),_("span",St,d(v.value.title),1),l(M,{icon:"mdi-close",variant:"text",onClick:e[3]||(e[3]=t=>F.value=!1)})]),_:1}),l(be,{class:"px-4 pb-2"},{default:n(()=>[_("div",Dt,[Z(x).spaces.length>1?(u(),V(h,{key:0,size:"small",variant:"outlined"},{default:n(()=>[l(m,{icon:"mdi-folder",size:"small",class:"mr-1",color:v.value.space_color||"grey"},null,8,["color"]),s(" "+d(v.value.space_name),1)]),_:1})):g("",!0),v.value.category?(u(),V(h,{key:1,size:"small",variant:"outlined",color:v.value.category.color},{default:n(()=>[l(m,{icon:v.value.category.icon,size:"small",class:"mr-1"},null,8,["icon"]),s(" "+d(v.value.category.name),1)]),_:1},8,["color"])):g("",!0),l(h,{size:"small",variant:"outlined"},{default:n(()=>[l(m,{icon:"mdi-refresh",size:"small",class:"mr-1"}),s(" "+d(ue(v.value)),1)]),_:1}),v.value.has_specific_time?(u(),V(h,{key:2,size:"small",variant:"outlined"},{default:n(()=>[l(m,{icon:"mdi-clock-outline",size:"small",class:"mr-1"}),s(" "+d(v.value.time_of_day),1)]),_:1})):g("",!0)]),v.value.description?(u(),p("p",$t,d(v.value.description),1)):g("",!0)]),_:1}),l(wl),l(ze,null,{default:n(()=>[l(q),l(me,{text:"Als erledigt markieren",location:"top"},{activator:n(({props:t})=>[l(M,pe(t,{icon:"mdi-check",color:"success",onClick:He}),null,16)]),_:1}),je(v.value)?(u(),V(me,{key:0,text:"Überspringen",location:"top"},{activator:n(({props:t})=>[l(M,pe(t,{icon:"mdi-debug-step-over",onClick:Xe}),null,16)]),_:1})):g("",!0),qe(v.value)?(u(),V(me,{key:1,text:"Verschieben",location:"top"},{activator:n(({props:t})=>[l(M,pe(t,{icon:"mdi-skip-next",onClick:Qe}),null,16)]),_:1})):g("",!0),l(me,{text:"Statistik",location:"top"},{activator:n(({props:t})=>[l(M,pe(t,{icon:"mdi-chart-timeline-variant",onClick:sl}),null,16)]),_:1}),l(me,{text:"Bearbeiten",location:"top"},{activator:n(({props:t})=>[l(M,pe(t,{icon:"mdi-pencil",onClick:al}),null,16)]),_:1}),l(me,{text:"Archivieren",location:"top"},{activator:n(({props:t})=>[l(M,pe(t,{icon:"mdi-delete",color:"error",onClick:ol}),null,16)]),_:1}),l(q)]),_:1})]),_:1})):g("",!0)]),_:1},8,["modelValue"]),l(Le,{modelValue:O.value,"onUpdate:modelValue":e[11]||(e[11]=t=>O.value=t)},{default:n(()=>[v.value?(u(),V(j,{key:0},{default:n(()=>[l(We,{class:"d-flex align-center"},{default:n(()=>[l(m,{icon:"mdi-calendar-clock",class:"mr-2"}),e[27]||(e[27]=_("span",null,"Verschieben",-1)),l(q),l(M,{icon:"mdi-close",variant:"text",onClick:e[5]||(e[5]=t=>O.value=!1)})]),_:1}),l(be,null,{default:n(()=>[_("div",Ct," Aktuell fällig: "+d(Re(v.value.next_due_date)),1),_("div",zt,[l(h,{onClick:e[6]||(e[6]=t=>Ue(1)),variant:"outlined"},{default:n(()=>[...e[28]||(e[28]=[s("+1 Tag",-1)])]),_:1}),l(h,{onClick:e[7]||(e[7]=t=>Ue(2)),variant:"outlined"},{default:n(()=>[...e[29]||(e[29]=[s("+2 Tage",-1)])]),_:1}),l(h,{onClick:e[8]||(e[8]=t=>Ue(3)),variant:"outlined"},{default:n(()=>[...e[30]||(e[30]=[s("+3 Tage",-1)])]),_:1}),l(h,{onClick:el,variant:"outlined"},{default:n(()=>[...e[31]||(e[31]=[s("Morgen",-1)])]),_:1}),l(h,{onClick:ll,variant:"outlined"},{default:n(()=>[...e[32]||(e[32]=[s("Nächste Woche",-1)])]),_:1})]),l(fe,{modelValue:G.value,"onUpdate:modelValue":e[9]||(e[9]=t=>G.value=t),label:"Anderes Datum",type:"date",variant:"outlined",density:"compact","hide-details":""},null,8,["modelValue"])]),_:1}),l(ze,null,{default:n(()=>[l(M,{variant:"text",onClick:e[10]||(e[10]=t=>O.value=!1)},{default:n(()=>[...e[33]||(e[33]=[s("Abbrechen",-1)])]),_:1}),l(q),l(M,{variant:"text",color:"primary",disabled:!G.value,onClick:tl},{default:n(()=>[...e[34]||(e[34]=[s(" Verschieben ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})):g("",!0)]),_:1},8,["modelValue"]),l(Je,{modelValue:Y.value,"onUpdate:modelValue":e[12]||(e[12]=t=>Y.value=t),task:v.value,categories:z.value,spaces:Z(x).spaces,"default-space-id":(f=v.value)==null?void 0:f.space_id,"space-members":[],onSave:nl},null,8,["modelValue","task","categories","spaces","default-space-id"]),l(Je,{modelValue:U.value,"onUpdate:modelValue":e[13]||(e[13]=t=>U.value=t),categories:z.value,spaces:Z(x).spaces,"default-space-id":De.value,"space-members":[],onSave:il},null,8,["modelValue","categories","spaces","default-space-id"]),l(Vl,{modelValue:D.value,"onUpdate:modelValue":e[14]||(e[14]=t=>D.value=t),timeout:K.value,color:T.value,location:"top"},Sl({default:n(()=>[s(d(C.value)+" ",1)]),_:2},[H.value?{name:"actions",fn:n(()=>[l(M,{icon:"mdi-undo",variant:"text",onClick:rl})]),key:"0"}:void 0]),1032,["modelValue","timeout","color"]),l(Dl,{modelValue:B.value,"onUpdate:modelValue":e[16]||(e[16]=t=>B.value=t),"max-width":"500"},{default:n(()=>[l(j,null,{default:n(()=>[l(We,{class:"d-flex align-center"},{default:n(()=>[l(m,{icon:"mdi-filter-variant",class:"mr-2"}),e[35]||(e[35]=s(" Filter ",-1))]),_:1}),l(be,null,{default:n(()=>[(u(!0),p(N,null,W(Z(x).spaces,t=>(u(),p("div",{key:t.id,class:"mb-4"},[_("div",Ft,[l($l,{"model-value":S.value.includes(t.id),"onUpdate:modelValue":y=>c(t.id),label:t.personal_name||t.name,color:t.personal_color||"primary","hide-details":"",density:"compact"},null,8,["model-value","onUpdate:modelValue","label","color"])]),l(ne,null,{default:n(()=>[S.value.includes(t.id)?(u(),p("div",Tt,[(u(!0),p(N,null,W(b(t.id),y=>(u(),p("div",{key:y.id,class:"d-flex align-center"},[l(Q,{"model-value":I.value.includes(y.id),"onUpdate:modelValue":P=>o(y.id),color:y.color,"hide-details":"",density:"compact"},{label:n(()=>[l(m,{icon:y.icon||"mdi-tag",color:y.color,size:"small",class:"mr-2"},null,8,["icon","color"]),s(" "+d(y.name),1)]),_:2},1032,["model-value","onUpdate:modelValue","color"])]))),128)),b(t.id).length===0?(u(),p("div",It," Keine Kategorien ")):g("",!0)])):g("",!0)]),_:2},1024)]))),128))]),_:1}),l(ze,null,{default:n(()=>[l(M,{variant:"text",onClick:R},{default:n(()=>[...e[36]||(e[36]=[s("Zurücksetzen",-1)])]),_:1}),l(q),l(M,{variant:"text",color:"primary",onClick:e[15]||(e[15]=t=>B.value=!1)},{default:n(()=>[...e[37]||(e[37]=[s("Fertig",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]}),_:1}))}},At=vl(Mt,[["__scopeId","data-v-e62b5b62"]]);export{At as default};
