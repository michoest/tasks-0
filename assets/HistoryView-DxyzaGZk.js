import{_ as R,r as g,y as O,v as P,A as M,x as p,c as k,w as o,B as j,o as n,b as l,V as G,E as s,C as r,d as U,e as J,D as K,F as h,f as B,g as F,s as q,a9 as Q,p as V,h as v,i as N,G as w,S as W,l as C,t as m,J as D,ag as X,m as Y,I as Z,$ as ee}from"./index-CwATBQsK.js";const te={key:0,class:"completion-chart"},se={class:"chart-container"},ae={class:"chart-bar-wrapper"},le={key:0,class:"bar-label"},oe={class:"chart-label"},ne={key:1,class:"text-center py-8"},ie={class:"d-flex justify-space-around text-center"},re={class:"text-h4 font-weight-bold text-success"},de={class:"text-h4 font-weight-bold text-warning"},ue={class:"text-h4 font-weight-bold text-primary"},ce={key:0},me={class:"d-flex align-center mb-2"},pe={class:"font-weight-medium"},ve={class:"timeline-dots"},ge=["title"],fe={class:"d-flex justify-space-between text-caption text-medium-emphasis mt-1"},ye={key:0,class:"text-center py-4"},xe={key:1,class:"text-center py-8"},he={__name:"HistoryView",setup(_e){const _=g(!0),b=g([]),f=g([]),c=g(7),y=g("");O(async()=>{await S()}),P(c,async()=>{await S()});async function S(){_.value=!0;try{const[a,e]=await Promise.all([M.get(`/stats/completions-per-day?days=${c.value}`),M.get(`/stats/task-occurrences?days=${c.value}`)]);b.value=a.stats,f.value=e.tasks}catch(a){console.error("Failed to load stats:",a)}finally{_.value=!1}}const $=p(()=>{const a=new Map;return b.value.forEach(e=>{a.set(e.date,e)}),a}),x=p(()=>{const a=[],e=new Date;for(let t=c.value-1;t>=0;t--){const i=new Date(e);i.setDate(i.getDate()-t);const d=i.toISOString().split("T")[0],u=$.value.get(d);a.push({date:d,label:t===0?"Heute":t===1?"Gestern":`${i.getDate()}.${i.getMonth()+1}`,count:u?u.count:0,completed:u?u.completed:0,skipped:u?u.skipped:0})}return a}),I=p(()=>Math.max(...x.value.map(e=>e.count),1)),T=p(()=>x.value.reduce((a,e)=>a+e.completed,0)),z=p(()=>x.value.reduce((a,e)=>a+e.skipped,0)),H=p(()=>((T.value+z.value)/c.value).toFixed(1)),A=p(()=>{if(!y.value)return f.value;const a=y.value.toLowerCase();return f.value.filter(e=>e.title.toLowerCase().includes(a)||e.category_name&&e.category_name.toLowerCase().includes(a))});function L(a){const e=[],t=new Date,i=new Map;a.completions.forEach(d=>{i.set(d.date,d.skipped?"skipped":"completed")});for(let d=c.value-1;d>=0;d--){const u=new Date(t);u.setDate(u.getDate()-d);const E=u.toISOString().split("T")[0];e.push({date:E,status:i.get(E)||"empty"})}return e}return(a,e)=>(n(),k(j,{class:"bg-background"},{default:o(()=>[l(G,{fluid:"",class:"pa-4"},{default:o(()=>[e[16]||(e[16]=s("h1",{class:"text-h5 font-weight-bold mb-4"},"Verlauf & Statistiken",-1)),_.value?(n(),k(U,{key:0},{default:o(()=>[l(J,{cols:"12",class:"text-center py-8"},{default:o(()=>[l(K,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):(n(),r(h,{key:1},[l(B,{class:"mb-4",elevation:"0"},{default:o(()=>[l(F,{class:"d-flex align-center"},{default:o(()=>[e[5]||(e[5]=s("span",{class:"text-h6"},"Aktivität",-1)),l(q),l(Q,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=t=>c.value=t),density:"compact",mandatory:""},{default:o(()=>[l(V,{value:7,size:"small"},{default:o(()=>[...e[2]||(e[2]=[v("7T",-1)])]),_:1}),l(V,{value:14,size:"small"},{default:o(()=>[...e[3]||(e[3]=[v("14T",-1)])]),_:1}),l(V,{value:30,size:"small"},{default:o(()=>[...e[4]||(e[4]=[v("30T",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(N,null,{default:o(()=>[b.value.length>0?(n(),r("div",te,[s("div",se,[(n(!0),r(h,null,w(x.value,t=>(n(),r("div",{key:t.date,class:"chart-bar-container"},[s("div",ae,[s("div",{class:"chart-bar",style:W({height:`${t.count/I.value*100}%`,backgroundColor:t.count>0?"#4CAF50":"#E0E0E0"})},[t.count>0?(n(),r("span",le,m(t.count),1)):C("",!0)],4)]),s("div",oe,m(t.label),1)]))),128))])])):(n(),r("div",ne,[l(D,{size:"64",color:"grey-lighten-1"},{default:o(()=>[...e[6]||(e[6]=[v("mdi-chart-bar",-1)])]),_:1}),e[7]||(e[7]=s("p",{class:"text-body-1 text-medium-emphasis mt-4"}," Noch keine erledigten Aufgaben ",-1))])),l(X,{class:"my-4"}),s("div",ie,[s("div",null,[s("div",re,m(T.value),1),e[8]||(e[8]=s("div",{class:"text-caption text-medium-emphasis"},"Erledigt",-1))]),s("div",null,[s("div",de,m(z.value),1),e[9]||(e[9]=s("div",{class:"text-caption text-medium-emphasis"},"Übersprungen",-1))]),s("div",null,[s("div",ue,m(H.value),1),e[10]||(e[10]=s("div",{class:"text-caption text-medium-emphasis"},"Ø pro Tag",-1))])])]),_:1})]),_:1}),l(B,{elevation:"0"},{default:o(()=>[l(F,{class:"text-h6"},{default:o(()=>[...e[11]||(e[11]=[v("Aufgaben-Verlauf",-1)])]),_:1}),l(N,null,{default:o(()=>[f.value.length>0?(n(),r("div",ce,[l(Y,{modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>y.value=t),placeholder:"Aufgaben suchen...","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact","hide-details":"",clearable:"",class:"mb-4"},null,8,["modelValue"]),(n(!0),r(h,null,w(A.value,t=>(n(),r("div",{key:t.id,class:"task-timeline mb-4"},[s("div",me,[t.category_icon?(n(),k(D,{key:0,icon:t.category_icon,color:t.category_color,size:"small",class:"mr-2"},null,8,["icon","color"])):C("",!0),s("span",pe,m(t.title),1),l(Z,{size:"x-small",variant:"outlined",class:"ml-2"},{default:o(()=>[v(m(t.completions.length)+"x ",1)]),_:2},1024)]),s("div",ve,[(n(!0),r(h,null,w(L(t),(i,d)=>(n(),r("div",{key:d,class:ee(["timeline-dot",{completed:i.status==="completed",skipped:i.status==="skipped",empty:i.status==="empty"}]),title:i.date},null,10,ge))),128))]),s("div",fe,[s("span",null,m(c.value)+" Tage",1),e[12]||(e[12]=s("span",null,"Heute",-1))])]))),128)),A.value.length===0?(n(),r("div",ye,[...e[13]||(e[13]=[s("p",{class:"text-body-2 text-medium-emphasis"}," Keine Aufgaben gefunden ",-1)])])):C("",!0)])):(n(),r("div",xe,[l(D,{size:"64",color:"grey-lighten-1"},{default:o(()=>[...e[14]||(e[14]=[v("mdi-timeline-clock",-1)])]),_:1}),e[15]||(e[15]=s("p",{class:"text-body-1 text-medium-emphasis mt-4"}," Noch keine wiederkehrenden Aufgaben mit Verlauf ",-1))]))]),_:1})]),_:1})],64))]),_:1})]),_:1}))}},ke=R(he,[["__scopeId","data-v-bd2df93b"]]);export{ke as default};
