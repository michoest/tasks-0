import{_ as ke,ae as _e,r as i,x as xe,v as X,y as we,A as _,c as x,w as t,B as $e,a as Se,o as r,b as l,V as Fe,E as s,C as V,l as U,p,H as ze,t as f,d as Ne,e as Ue,D as De,F as D,f as S,i as I,m as E,a8 as Z,s as Y,M as ee,G as T,N as ae,O as le,h as u,J as K,I as F,P as Ie,af as Ke,ag as Be,a0 as te,ah as oe,a1 as ne,U as Me,g as se,ai as Ee,q as ie,Y as Te,W as Le}from"./index-BKgBkFFC.js";const Pe={class:"d-flex align-center mb-4"},Ae={class:"text-h5 font-weight-bold ml-2"},Oe={key:0,class:"mb-6"},Re={key:1,class:"mb-6"},Ge={class:"d-flex align-center mb-3"},Je={class:"d-flex flex-column mr-2"},We={key:2,class:"mb-6"},Ye={class:"d-flex align-center mb-3"},je={class:"text-body-2"},qe={class:"text-caption text-medium-emphasis"},He={class:"d-flex align-center ga-2"},Qe={class:"mb-6"},Xe={class:"d-flex flex-wrap ga-2 mb-2"},Ze={class:"mb-3"},ea={class:"mb-3"},aa={class:"d-flex flex-wrap ga-2"},la={__name:"SpaceSettingsView",setup(ta){const re=Se(),b=_e().params.id,j=i(!0),C=i(null),g=i([]),A=i([]),w=i(""),L=i(""),$=i(""),h=i(""),z=i(!1),B=i(!1),N=i(null),O=i(null),v=i({name:"",icon:"mdi-tag",color:"blue"}),k=i(""),y=i(""),d=i(!1),c=i(""),m=i("success"),R=xe(()=>{var e;return((e=C.value)==null?void 0:e.role)==="owner"}),q=["mdi-tag","mdi-home","mdi-cart","mdi-food","mdi-car","mdi-wrench","mdi-school","mdi-heart","mdi-leaf","mdi-dumbbell","mdi-book","mdi-briefcase"],G=["red","pink","purple","deep-purple","indigo","blue","cyan","teal","green","light-green","amber","orange","deep-orange","brown","grey"];X(k,e=>{e&&(v.value.icon="mdi-"+e)}),X(y,e=>{e&&(v.value.color=e)}),we(async()=>{await ue(),await J(),j.value=!1});async function ue(){try{const e=await _.get(`/spaces/${b}`);C.value=e.space,A.value=e.members||[],w.value=e.space.name,L.value=e.space.personal_name||"",$.value=e.space.personal_color||"",$.value&&$.value.startsWith("#")&&(h.value=$.value)}catch(e){console.error("Failed to load space:",e)}}function de(e){return e.first_name&&e.last_name?`${e.first_name[0]}${e.last_name[0]}`.toUpperCase():e.first_name?e.first_name.substring(0,2).toUpperCase():e.email.substring(0,2).toUpperCase()}function ce(e){return e.first_name&&e.last_name?`${e.first_name} ${e.last_name}`:e.first_name?e.first_name:e.email.split("@")[0]}function ve(e){if(!e)return"";const a=new Date(e);return`Beigetreten ${a.getDate()}.${a.getMonth()+1}.${a.getFullYear()}`}async function me(){try{await navigator.clipboard.writeText(C.value.invite_code),c.value="Code kopiert",m.value="success",d.value=!0}catch{c.value="Kopieren fehlgeschlagen",m.value="error",d.value=!0}}async function J(){try{const e=await _.get(`/spaces/${b}/categories`);g.value=e.categories}catch(e){console.error("Failed to load categories:",e)}}async function H(){if(!(!w.value.trim()||w.value===C.value.name))try{await _.patch(`/spaces/${b}`,{name:w.value.trim()}),C.value.name=w.value.trim(),c.value="Name gespeichert",m.value="success",d.value=!0}catch(e){console.error("Failed to save space name:",e),c.value="Fehler beim Speichern",m.value="error",d.value=!0}}function pe(){N.value=null,v.value={name:"",icon:"mdi-tag",color:"blue"},k.value="",y.value="",z.value=!0}function fe(e){N.value=e,v.value={name:e.name,icon:e.icon,color:e.color},e.icon&&!q.includes(e.icon)?k.value=e.icon.replace("mdi-",""):k.value="",e.color&&!G.includes(e.color)?y.value=e.color:y.value="",z.value=!0}async function ge(){try{N.value?(await _.patch(`/spaces/${b}/categories/${N.value.id}`,v.value),c.value="Kategorie aktualisiert"):(await _.post(`/spaces/${b}/categories`,v.value),c.value="Kategorie erstellt"),m.value="success",d.value=!0,z.value=!1,await J()}catch(e){console.error("Failed to save category:",e),c.value="Fehler beim Speichern",m.value="error",d.value=!0}}function ye(e){O.value=e,B.value=!0}async function Ve(){try{await _.delete(`/spaces/${b}/categories/${O.value.id}`),c.value="Kategorie gelöscht",m.value="success",d.value=!0,B.value=!1,await J()}catch(e){console.error("Failed to delete category:",e),c.value="Fehler beim Löschen",m.value="error",d.value=!0}}async function be(e){if(e===0)return;const a=[...g.value];[a[e-1],a[e]]=[a[e],a[e-1]],g.value=a,await Q()}async function Ce(e){if(e===g.value.length-1)return;const a=[...g.value];[a[e],a[e+1]]=[a[e+1],a[e]],g.value=a,await Q()}async function Q(){try{const e=g.value.map(a=>a.id);await _.post(`/spaces/${b}/categories/reorder`,{category_ids:e})}catch(e){console.error("Failed to save category order:",e),c.value="Fehler beim Speichern der Reihenfolge",m.value="error",d.value=!0}}function he(e){$.value=e,h.value="",P()}async function P(){try{const e=h.value||$.value||null;await _.patch(`/spaces/${b}/personal-settings`,{personal_name:L.value||null,personal_color:e}),c.value="Einstellungen gespeichert",m.value="success",d.value=!0}catch(e){console.error("Failed to save personal settings:",e),c.value="Fehler beim Speichern",m.value="error",d.value=!0}}return(e,a)=>(r(),x($e,{class:"bg-background"},{default:t(()=>[l(Fe,{fluid:"",class:"pa-4"},{default:t(()=>{var o;return[s("div",Pe,[l(p,{icon:"mdi-arrow-left",variant:"text",onClick:a[0]||(a[0]=n=>ze(re).back())}),s("h1",Ae,f((o=C.value)==null?void 0:o.name),1)]),j.value?(r(),x(Ne,{key:0},{default:t(()=>[l(Ue,{cols:"12",class:"text-center py-8"},{default:t(()=>[l(De,{indeterminate:"",color:"primary"})]),_:1})]),_:1})):C.value?(r(),V(D,{key:1},[R.value?(r(),V("div",Oe,[a[13]||(a[13]=s("h2",{class:"text-h6 font-weight-bold mb-3"},"Space-Einstellungen",-1)),l(S,{elevation:"0"},{default:t(()=>[l(I,null,{default:t(()=>[l(E,{modelValue:w.value,"onUpdate:modelValue":a[1]||(a[1]=n=>w.value=n),label:"Space-Name",variant:"outlined","hide-details":"",onBlur:H,onKeyup:Z(H,["enter"])},null,8,["modelValue"])]),_:1})]),_:1})])):U("",!0),R.value?(r(),V("div",Re,[s("div",Ge,[a[14]||(a[14]=s("h2",{class:"text-h6 font-weight-bold"},"Kategorien",-1)),l(Y),l(p,{icon:"mdi-plus",size:"small",variant:"text",color:"primary",onClick:pe})]),g.value.length>0?(r(),x(S,{key:0,elevation:"0"},{default:t(()=>[l(ee,{class:"pa-0"},{default:t(()=>[(r(!0),V(D,null,T(g.value,(n,M)=>(r(),x(ae,{key:n.id,class:"px-4"},{prepend:t(()=>[s("div",Je,[l(p,{icon:"mdi-chevron-up",size:"x-small",variant:"text",disabled:M===0,onClick:W=>be(M)},null,8,["disabled","onClick"]),l(p,{icon:"mdi-chevron-down",size:"x-small",variant:"text",disabled:M===g.value.length-1,onClick:W=>Ce(M)},null,8,["disabled","onClick"])]),l(K,{icon:n.icon,color:n.color,class:"mr-2"},null,8,["icon","color"])]),append:t(()=>[l(p,{icon:"mdi-pencil",variant:"text",size:"small",onClick:W=>fe(n)},null,8,["onClick"]),l(p,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:W=>ye(n)},null,8,["onClick"])]),default:t(()=>[l(le,null,{default:t(()=>[u(f(n.name),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):(r(),x(S,{key:1,elevation:"0"},{default:t(()=>[l(I,{class:"text-center py-8"},{default:t(()=>[l(K,{size:"48",color:"grey-lighten-1"},{default:t(()=>[...a[15]||(a[15]=[u("mdi-tag-off-outline",-1)])]),_:1}),a[16]||(a[16]=s("div",{class:"text-body-2 text-medium-emphasis mt-2"}," Keine Kategorien ",-1))]),_:1})]),_:1}))])):U("",!0),R.value?(r(),V("div",We,[s("div",Ye,[a[17]||(a[17]=s("h2",{class:"text-h6 font-weight-bold"},"Mitglieder",-1)),l(F,{size:"small",class:"ml-2"},{default:t(()=>[u(f(A.value.length),1)]),_:1})]),l(S,{elevation:"0"},{default:t(()=>[l(ee,{class:"pa-0"},{default:t(()=>[(r(!0),V(D,null,T(A.value,n=>(r(),x(ae,{key:n.id},{prepend:t(()=>[l(Ke,{color:"primary",size:"36"},{default:t(()=>[s("span",je,f(de(n)),1)]),_:2},1024)]),append:t(()=>[s("span",qe,f(ve(n.joined_at)),1)]),default:t(()=>[l(le,null,{default:t(()=>[u(f(ce(n))+" ",1),n.role==="owner"?(r(),x(F,{key:0,size:"x-small",color:"primary",class:"ml-2"},{default:t(()=>[...a[18]||(a[18]=[u(" Besitzer ",-1)])]),_:1})):U("",!0)]),_:2},1024),l(Ie,null,{default:t(()=>[u(f(n.email),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(Be),l(I,null,{default:t(()=>{var n;return[a[19]||(a[19]=s("div",{class:"text-caption text-medium-emphasis mb-2"},"Einladungscode",-1)),s("div",He,[l(E,{"model-value":(n=C.value)==null?void 0:n.invite_code,readonly:"",variant:"outlined",density:"compact","hide-details":"",class:"flex-grow-1"},{"append-inner":t(()=>[l(p,{icon:"mdi-content-copy",size:"small",variant:"text",onClick:me})]),_:1},8,["model-value"])]),a[20]||(a[20]=s("div",{class:"text-caption text-medium-emphasis mt-2"}," Teile diesen Code, damit andere dem Space beitreten können. ",-1))]}),_:1})]),_:1})])):U("",!0),s("div",Qe,[a[22]||(a[22]=s("h2",{class:"text-h6 font-weight-bold mb-3"},"Persönliche Einstellungen",-1)),l(S,{elevation:"0"},{default:t(()=>[l(I,null,{default:t(()=>[l(E,{modelValue:L.value,"onUpdate:modelValue":a[2]||(a[2]=n=>L.value=n),label:"Eigener Name für diesen Space",variant:"outlined",hint:"Nur für dich sichtbar. Leer lassen für Standardname.","persistent-hint":"",class:"mb-4",onBlur:P,onKeyup:Z(P,["enter"])},null,8,["modelValue"]),a[21]||(a[21]=s("div",{class:"text-caption mb-2"},"Space-Farbe (nur für dich)",-1)),s("div",Xe,[(r(),V(D,null,T(G,n=>l(F,{key:n,color:n,variant:$.value===n?"flat":"outlined",size:"small",onClick:M=>he(n)},null,8,["color","variant","onClick"])),64)),l(te,{"close-on-content-click":!1},{activator:t(({props:n})=>[l(F,ne(n,{size:"small",variant:h.value?"flat":"outlined",style:h.value?{backgroundColor:h.value}:{}}),{default:t(()=>[l(K,{icon:"mdi-palette",size:"small"})]),_:1},16,["variant","style"])]),default:t(()=>[l(oe,{modelValue:h.value,"onUpdate:modelValue":[a[3]||(a[3]=n=>h.value=n),P],mode:"hex","hide-inputs":"","show-swatches":""},null,8,["modelValue"])]),_:1})])]),_:1})]),_:1})])],64)):U("",!0)]}),_:1}),l(Me,{modelValue:z.value,"onUpdate:modelValue":a[9]||(a[9]=o=>z.value=o)},{default:t(()=>[l(S,null,{default:t(()=>[l(se,null,{default:t(()=>[u(f(N.value?"Kategorie bearbeiten":"Neue Kategorie"),1)]),_:1}),l(I,null,{default:t(()=>[l(E,{modelValue:v.value.name,"onUpdate:modelValue":a[4]||(a[4]=o=>v.value.name=o),label:"Name",variant:"outlined",class:"mb-3"},null,8,["modelValue"]),s("div",Ze,[a[24]||(a[24]=s("div",{class:"text-caption mb-2"},"Icon",-1)),l(Ee,{modelValue:v.value.icon,"onUpdate:modelValue":a[5]||(a[5]=o=>v.value.icon=o),column:"",mandatory:""},{default:t(()=>[(r(),V(D,null,T(q,o=>l(F,{key:o,value:o,variant:"outlined",filter:""},{default:t(()=>[l(K,{icon:o},null,8,["icon"])]),_:2},1032,["value"])),64))]),_:1},8,["modelValue"]),l(E,{modelValue:k.value,"onUpdate:modelValue":a[6]||(a[6]=o=>k.value=o),label:"Eigenes Icon",variant:"outlined",density:"compact","hide-details":"",class:"mt-2",placeholder:"home, cart, star..."},{"prepend-inner":t(()=>[...a[23]||(a[23]=[s("span",{class:"text-caption text-medium-emphasis"},"mdi-",-1)])]),"append-inner":t(()=>[k.value?(r(),x(K,{key:0,icon:"mdi-"+k.value},null,8,["icon"])):U("",!0)]),_:1},8,["modelValue"])]),s("div",ea,[a[25]||(a[25]=s("div",{class:"text-caption mb-2"},"Farbe",-1)),s("div",aa,[(r(),V(D,null,T(G,o=>l(F,{key:o,color:o,variant:v.value.color===o?"flat":"outlined",size:"small",onClick:n=>{v.value.color=o,y.value=""}},null,8,["color","variant","onClick"])),64)),l(te,{"close-on-content-click":!1},{activator:t(({props:o})=>[l(F,ne(o,{size:"small",variant:y.value?"flat":"outlined",style:y.value?{backgroundColor:y.value}:{}}),{default:t(()=>[l(K,{icon:"mdi-palette",size:"small"})]),_:1},16,["variant","style"])]),default:t(()=>[l(oe,{modelValue:y.value,"onUpdate:modelValue":a[7]||(a[7]=o=>y.value=o),mode:"hex","hide-inputs":"","show-swatches":""},null,8,["modelValue"])]),_:1})])])]),_:1}),l(ie,null,{default:t(()=>[l(p,{variant:"text",color:"error",onClick:a[8]||(a[8]=o=>z.value=!1)},{default:t(()=>[...a[26]||(a[26]=[u("Abbrechen",-1)])]),_:1}),l(Y),l(p,{variant:"text",color:"primary",onClick:ge},{default:t(()=>[u(f(N.value?"Speichern":"Erstellen"),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Te,{modelValue:B.value,"onUpdate:modelValue":a[11]||(a[11]=o=>B.value=o),"max-width":"400"},{default:t(()=>[l(S,null,{default:t(()=>[l(se,{class:"text-h6"},{default:t(()=>[...a[27]||(a[27]=[u("Kategorie löschen?",-1)])]),_:1}),l(I,null,{default:t(()=>{var o;return[u(' Möchten Sie "'+f((o=O.value)==null?void 0:o.name)+'" wirklich löschen? ',1)]}),_:1}),l(ie,null,{default:t(()=>[l(Y),l(p,{variant:"text",onClick:a[10]||(a[10]=o=>B.value=!1)},{default:t(()=>[...a[28]||(a[28]=[u("Abbrechen",-1)])]),_:1}),l(p,{variant:"text",color:"error",onClick:Ve},{default:t(()=>[...a[29]||(a[29]=[u("Löschen",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Le,{modelValue:d.value,"onUpdate:modelValue":a[12]||(a[12]=o=>d.value=o),timeout:2e3,color:m.value,location:"top"},{default:t(()=>[u(f(c.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}},sa=ke(la,[["__scopeId","data-v-d30906f9"]]);export{sa as default};
