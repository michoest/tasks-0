import{_ as G,r as b,x as P,v as Q,c as F,o as d,w as o,b as r,f as X,E as s,m as se,p as z,C as f,l as y,$ as k,J as p,h as c,t as g,K as J,L as I,F as K,G as L,R,a7 as q,U as ee,a8 as _e,a9 as $e,S as we,A as Se}from"./index-DPaTiaMt.js";const De={class:"sheet-header"},he={class:"task-options"},Ce={class:"option-label"},be={class:"option-label"},xe={class:"option-label"},Ve={key:0,class:"option-label"},Me={class:"option-label"},Te={class:"task-sections"},ze={class:"section-content"},Ie={class:"pill-grid"},Fe=["onClick"],Ne={class:"section-content"},Be={class:"pill-grid"},Oe=["onClick"],Ae={class:"section-content"},Ue={class:"pill-grid mb-3"},We={key:0,class:"date-section"},Ee={class:"quick-dates"},He={key:1,class:"interval-section"},Je={class:"interval-row"},Re={class:"mt-2"},qe={key:2,class:"schedule-section"},Ke={class:"schedule-type-row"},Le={key:0,class:"weekday-grid"},Ye=["onClick"],Pe={key:1,class:"monthday-grid"},Qe=["onClick"],je={key:3,class:"time-section"},Ze={class:"progress-section"},Ge={class:"progress-header"},Xe={class:"progress-value"},et=["value"],tt={class:"progress-actions"},lt={class:"notes-section"},st={class:"notes-input-wrapper"},at={class:"sheet-footer"},nt={__name:"TaskDialog",props:{modelValue:Boolean,task:Object,categories:{type:Array,default:()=>[]},spaces:{type:Array,default:()=>[]},defaultSpaceId:Number,initialTitle:{type:String,default:""}},emits:["update:modelValue","save"],setup(u,{emit:h}){const m=u,N=h,E=b(null),_=b(!1),x=b(!1),T=b(!1),S=b(!1),$=b(!1),i=b("weekly"),a=b([]),v=b([]),t=b(V()),B=P(()=>t.value.space_id?m.categories.filter(l=>l.space_id===t.value.space_id):m.categories);function V(){var l;return{title:m.initialTitle||"",description:"",space_id:m.defaultSpaceId||((l=m.spaces[0])==null?void 0:l.id)||null,category_id:null,recurrence_type:"no_date",interval_days:1,interval_exclude_weekends:!1,has_specific_time:!1,time_of_day:"09:00",next_due_date:C(),progress:null,status:"active"}}function C(){return new Date().toISOString().split("T")[0]}function U(l){l==="space"?(_.value=!_.value,x.value=!1,T.value=!1):l==="categories"?(x.value=!x.value,_.value=!1,T.value=!1):l==="recurrence"&&(T.value=!T.value,_.value=!1,x.value=!1)}function O(){S.value=!S.value,S.value&&t.value.progress===null&&(t.value.progress=0)}function H(){t.value.progress=null,S.value=!1}function j(){t.value.status=t.value.status==="active"?"inactive":"active"}function ae(l){t.value.space_id=l,B.value.find(n=>n.id===t.value.category_id)||(t.value.category_id=null)}function ne(){const l=m.spaces.find(e=>e.id===t.value.space_id);return(l==null?void 0:l.personal_name)||(l==null?void 0:l.name)||"Space"}function ie(){const l=m.spaces.find(e=>e.id===t.value.space_id);return(l==null?void 0:l.personal_color)||"primary"}function oe(){if(!t.value.category_id)return"Kategorie";const l=m.categories.find(e=>e.id===t.value.category_id);return(l==null?void 0:l.name)||"Kategorie"}function re(){if(!t.value.category_id)return"grey";const l=m.categories.find(e=>e.id===t.value.category_id);return(l==null?void 0:l.color)||"grey"}function ue(){if(!t.value.category_id)return"mdi-tag";const l=m.categories.find(e=>e.id===t.value.category_id);return(l==null?void 0:l.icon)||"mdi-tag"}function de(){switch(t.value.recurrence_type){case"no_date":return"mdi-infinity";case"one_time":return"mdi-calendar";case"interval":return"mdi-refresh";case"schedule":return"mdi-calendar-clock";default:return"mdi-calendar"}}function ce(){return t.value.recurrence_type==="no_date"?"grey":"primary"}function ve(){switch(t.value.recurrence_type){case"no_date":return"Irgendwann";case"one_time":return t.value.next_due_date?pe(t.value.next_due_date):"Datum wählen";case"interval":return`Alle ${t.value.interval_days}d`;case"schedule":return i.value==="weekly"&&a.value.length>0?`${a.value.length}x/Woche`:i.value==="monthly"&&v.value.length>0?`${v.value.length}x/Monat`:"Zeitplan";default:return"Datum"}}function pe(l){const[e,n,w]=l.split("-").map(Number),A=new Date(e,n-1,w),M=new Date;M.setHours(0,0,0,0);const D=new Date(M);D.setDate(D.getDate()+1);const Y=`${M.getFullYear()}-${String(M.getMonth()+1).padStart(2,"0")}-${String(M.getDate()).padStart(2,"0")}`,W=`${D.getFullYear()}-${String(D.getMonth()+1).padStart(2,"0")}-${String(D.getDate()).padStart(2,"0")}`;return l===Y?"Heute":l===W?"Morgen":`${["So","Mo","Di","Mi","Do","Fr","Sa"][A.getDay()]}, ${A.getDate()}.${A.getMonth()+1}.`}function Z(l){const e=new Date;l==="today"?t.value.next_due_date=e.toISOString().split("T")[0]:l==="tomorrow"?(e.setDate(e.getDate()+1),t.value.next_due_date=e.toISOString().split("T")[0]):l==="nextWeek"&&(e.setDate(e.getDate()+7),t.value.next_due_date=e.toISOString().split("T")[0])}function me(l){const e=a.value.indexOf(l);e===-1?a.value.push(l):a.value.splice(e,1)}function fe(l){const e=v.value.indexOf(l);e===-1?v.value.push(l):v.value.splice(e,1)}Q(()=>m.modelValue,l=>{l&&(m.task?ge(m.task):(t.value=V(),t.value.title=m.initialTitle||"",a.value=[],v.value=[],_.value=!1,x.value=!1,T.value=!1,S.value=!1,$.value=!1))}),Q(()=>m.initialTitle,l=>{m.modelValue&&!m.task&&(t.value.title=l||"")});function ge(l){if(t.value={title:l.title||"",description:l.description||"",space_id:l.space_id||m.defaultSpaceId,category_id:l.category_id||null,recurrence_type:l.recurrence_type||"no_date",interval_days:l.interval_days||1,interval_exclude_weekends:!!l.interval_exclude_weekends,has_specific_time:!!l.has_specific_time,time_of_day:l.time_of_day||"09:00",next_due_date:l.next_due_date||C(),progress:l.progress!==void 0?l.progress:null,status:l.status||"active"},l.schedule_pattern)try{const e=JSON.parse(l.schedule_pattern);i.value=e.type||"weekly",a.value=e.weekdays||[],v.value=e.days||[]}catch(e){console.error("Failed to parse schedule:",e)}$.value=!!l.description,S.value=l.progress!==null&&l.progress!==void 0}function te(){N("update:modelValue",!1)}function ye(l){var n,w;const e=new Date;if(e.setHours(0,0,0,0),l.type==="weekly"&&((n=l.weekdays)!=null&&n.length)){const A=[...l.weekdays].sort((D,Y)=>D-Y),M=new Date(e);for(let D=0;D<8;D++){if(A.includes(M.getDay()))return M.toISOString().split("T")[0];M.setDate(M.getDate()+1)}}if(l.type==="monthly"&&((w=l.days)!=null&&w.length)){const A=[...l.days].sort((W,le)=>W-le),M=e.getDate(),D=A.find(W=>W>=M);if(D){const W=new Date(e.getFullYear(),e.getMonth(),D);if(W.getDate()===D)return W.toISOString().split("T")[0]}return new Date(e.getFullYear(),e.getMonth()+1,A[0]).toISOString().split("T")[0]}return e.toISOString().split("T")[0]}function ke(){if(!t.value.title.trim())return;const l={title:t.value.title.trim(),description:t.value.description||null,space_id:t.value.space_id,category_id:t.value.category_id||null,recurrence_type:t.value.recurrence_type,has_specific_time:t.value.has_specific_time?1:0,time_of_day:t.value.has_specific_time?t.value.time_of_day:null,progress:t.value.progress,status:t.value.status};if(t.value.recurrence_type==="no_date")l.next_due_date=null;else if(t.value.recurrence_type==="one_time")l.next_due_date=t.value.next_due_date;else if(t.value.recurrence_type==="interval")l.interval_days=t.value.interval_days,l.interval_exclude_weekends=t.value.interval_exclude_weekends?1:0,l.next_due_date=t.value.next_due_date;else if(t.value.recurrence_type==="schedule"){const e={type:i.value};if(i.value==="weekly"){if(a.value.length===0){alert("Bitte mindestens einen Wochentag wählen");return}e.weekdays=a.value.sort((n,w)=>n-w)}else{if(v.value.length===0){alert("Bitte mindestens einen Tag wählen");return}e.days=v.value.sort((n,w)=>n-w)}l.schedule_pattern=JSON.stringify(e),l.next_due_date=ye(e)}N("save",l),te()}return(l,e)=>(d(),F(ee,{"model-value":u.modelValue,"onUpdate:modelValue":e[28]||(e[28]=n=>l.$emit("update:modelValue",n)),scrollable:""},{default:o(()=>[r(X,{class:"task-dialog-card"},{default:o(()=>[s("div",De,[r(se,{ref_key:"titleRef",ref:E,modelValue:t.value.title,"onUpdate:modelValue":e[0]||(e[0]=n=>t.value.title=n),placeholder:"Aufgabe...",variant:"plain",density:"comfortable","hide-details":"",autofocus:"",class:"title-input"},null,8,["modelValue"]),r(z,{icon:"mdi-close",variant:"text",size:"small",onClick:te,class:"close-btn"})]),s("div",he,[s("div",{class:k(["option-pill",{"option-active":_.value}]),onClick:e[1]||(e[1]=n=>U("space"))},[r(p,{size:"18",color:ie()},{default:o(()=>[...e[29]||(e[29]=[c("mdi-folder",-1)])]),_:1},8,["color"]),s("span",Ce,g(ne()),1)],2),s("div",{class:k(["option-pill",{"option-active":x.value}]),onClick:e[2]||(e[2]=n=>U("categories"))},[r(p,{size:"18",color:re(),icon:ue()},null,8,["color","icon"]),s("span",be,g(oe()),1)],2),s("div",{class:k(["option-pill",{"option-active":T.value}]),onClick:e[3]||(e[3]=n=>U("recurrence"))},[r(p,{size:"18",color:ce()},{default:o(()=>[c(g(de()),1)]),_:1},8,["color"]),s("span",xe,g(ve()),1)],2),s("div",{class:k(["option-pill",{"option-active":S.value||t.value.progress!==null}]),onClick:O},[r(p,{size:"16",color:t.value.progress!==null?"primary":void 0},{default:o(()=>[...e[30]||(e[30]=[c("mdi-percent",-1)])]),_:1},8,["color"]),t.value.progress!==null?(d(),f("span",Ve,g(Math.round(t.value.progress*100))+"%",1)):y("",!0)],2),s("div",{class:k(["option-pill",{"option-active":$.value}]),onClick:e[4]||(e[4]=n=>$.value=!$.value)},[r(p,{size:"16"},{default:o(()=>[...e[31]||(e[31]=[c("mdi-note-text-outline",-1)])]),_:1})],2),u.task?(d(),f("div",{key:0,class:k(["option-pill",{"option-inactive":t.value.status==="inactive"}]),onClick:j},[r(p,{size:"16",color:t.value.status==="inactive"?"warning":"success"},{default:o(()=>[c(g(t.value.status==="inactive"?"mdi-pause-circle":"mdi-play-circle"),1)]),_:1},8,["color"]),s("span",Me,g(t.value.status==="inactive"?"Inaktiv":"Aktiv"),1)],2)):y("",!0)]),s("div",Te,[r(J,null,{default:o(()=>[I(s("div",ze,[s("div",Ie,[(d(!0),f(K,null,L(u.spaces,n=>(d(),f("div",{key:n.id,class:k(["selectable-pill",{"pill-selected":t.value.space_id===n.id}]),onClick:w=>ae(n.id)},[r(p,{size:"16",color:n.personal_color||"primary"},{default:o(()=>[...e[32]||(e[32]=[c("mdi-folder",-1)])]),_:1},8,["color"]),s("span",null,g(n.personal_name||n.name),1)],10,Fe))),128))])],512),[[R,_.value]])]),_:1}),r(J,null,{default:o(()=>[I(s("div",Ne,[s("div",Be,[s("div",{class:k(["selectable-pill",{"pill-selected":!t.value.category_id}]),onClick:e[5]||(e[5]=n=>t.value.category_id=null)},[r(p,{size:"16",color:"grey"},{default:o(()=>[...e[33]||(e[33]=[c("mdi-tag-off",-1)])]),_:1}),e[34]||(e[34]=s("span",null,"Keine",-1))],2),(d(!0),f(K,null,L(B.value,n=>(d(),f("div",{key:n.id,class:k(["selectable-pill",{"pill-selected":t.value.category_id===n.id}]),onClick:w=>t.value.category_id=n.id},[r(p,{size:"16",color:n.color},{default:o(()=>[c(g(n.icon||"mdi-tag"),1)]),_:2},1032,["color"]),s("span",null,g(n.name),1)],10,Oe))),128))])],512),[[R,x.value]])]),_:1}),r(J,null,{default:o(()=>[I(s("div",Ae,[s("div",Ue,[s("div",{class:k(["selectable-pill",{"pill-selected":t.value.recurrence_type==="no_date"}]),onClick:e[6]||(e[6]=n=>t.value.recurrence_type="no_date")},[r(p,{size:"16"},{default:o(()=>[...e[35]||(e[35]=[c("mdi-infinity",-1)])]),_:1}),e[36]||(e[36]=s("span",null,"Irgendwann",-1))],2),s("div",{class:k(["selectable-pill",{"pill-selected":t.value.recurrence_type==="one_time"}]),onClick:e[7]||(e[7]=n=>t.value.recurrence_type="one_time")},[r(p,{size:"16"},{default:o(()=>[...e[37]||(e[37]=[c("mdi-calendar",-1)])]),_:1}),e[38]||(e[38]=s("span",null,"Einmalig",-1))],2),s("div",{class:k(["selectable-pill",{"pill-selected":t.value.recurrence_type==="interval"}]),onClick:e[8]||(e[8]=n=>t.value.recurrence_type="interval")},[r(p,{size:"16"},{default:o(()=>[...e[39]||(e[39]=[c("mdi-refresh",-1)])]),_:1}),e[40]||(e[40]=s("span",null,"Intervall",-1))],2),s("div",{class:k(["selectable-pill",{"pill-selected":t.value.recurrence_type==="schedule"}]),onClick:e[9]||(e[9]=n=>t.value.recurrence_type="schedule")},[r(p,{size:"16"},{default:o(()=>[...e[41]||(e[41]=[c("mdi-calendar-clock",-1)])]),_:1}),e[42]||(e[42]=s("span",null,"Zeitplan",-1))],2)]),t.value.recurrence_type==="one_time"?(d(),f("div",We,[s("div",Ee,[s("div",{class:"date-chip",onClick:e[10]||(e[10]=n=>Z("today"))},"Heute"),s("div",{class:"date-chip",onClick:e[11]||(e[11]=n=>Z("tomorrow"))},"Morgen"),s("div",{class:"date-chip",onClick:e[12]||(e[12]=n=>Z("nextWeek"))},"Nächste Woche")]),I(s("input",{"onUpdate:modelValue":e[13]||(e[13]=n=>t.value.next_due_date=n),type:"date",class:"date-input"},null,512),[[q,t.value.next_due_date]])])):y("",!0),t.value.recurrence_type==="interval"?(d(),f("div",He,[s("div",Je,[e[44]||(e[44]=s("span",{class:"interval-label"},"Alle",-1)),I(s("input",{"onUpdate:modelValue":e[14]||(e[14]=n=>t.value.interval_days=n),type:"number",min:"1",class:"interval-input"},null,512),[[q,t.value.interval_days,void 0,{number:!0}]]),e[45]||(e[45]=s("span",{class:"interval-label"},"Tage",-1)),s("div",{class:k(["interval-toggle",{"toggle-active":t.value.interval_exclude_weekends}]),onClick:e[15]||(e[15]=n=>t.value.interval_exclude_weekends=!t.value.interval_exclude_weekends)},[r(p,{size:"14"},{default:o(()=>[...e[43]||(e[43]=[c("mdi-briefcase-off",-1)])]),_:1})],2)]),s("div",Re,[e[46]||(e[46]=s("span",{class:"text-caption text-medium-emphasis"},"Start:",-1)),I(s("input",{"onUpdate:modelValue":e[16]||(e[16]=n=>t.value.next_due_date=n),type:"date",class:"date-input ml-2"},null,512),[[q,t.value.next_due_date]])])])):y("",!0),t.value.recurrence_type==="schedule"?(d(),f("div",qe,[s("div",Ke,[s("div",{class:k(["schedule-type-pill",{"type-selected":i.value==="weekly"}]),onClick:e[17]||(e[17]=n=>i.value="weekly")}," Woche ",2),s("div",{class:k(["schedule-type-pill",{"type-selected":i.value==="monthly"}]),onClick:e[18]||(e[18]=n=>i.value="monthly")}," Monat ",2)]),i.value==="weekly"?(d(),f("div",Le,[(d(),f(K,null,L(["Mo","Di","Mi","Do","Fr","Sa","So"],(n,w)=>s("div",{key:w,class:k(["weekday-chip",{"day-selected":a.value.includes(w===6?0:w+1)}]),onClick:A=>me(w===6?0:w+1)},g(n),11,Ye)),64))])):y("",!0),i.value==="monthly"?(d(),f("div",Pe,[(d(),f(K,null,L(31,n=>s("div",{key:n,class:k(["monthday-chip",{"day-selected":v.value.includes(n)}]),onClick:w=>fe(n)},g(n),11,Qe)),64))])):y("",!0)])):y("",!0),["one_time","interval","schedule"].includes(t.value.recurrence_type)?(d(),f("div",je,[s("div",{class:k(["time-toggle",{"toggle-active":t.value.has_specific_time}]),onClick:e[19]||(e[19]=n=>t.value.has_specific_time=!t.value.has_specific_time)},[r(p,{size:"16"},{default:o(()=>[...e[47]||(e[47]=[c("mdi-clock-outline",-1)])]),_:1}),e[48]||(e[48]=s("span",null,"Uhrzeit",-1))],2),t.value.has_specific_time?I((d(),f("input",{key:0,"onUpdate:modelValue":e[20]||(e[20]=n=>t.value.time_of_day=n),type:"time",class:"time-input"},null,512)),[[q,t.value.time_of_day]]):y("",!0)])):y("",!0)],512),[[R,T.value]])]),_:1})]),r(J,null,{default:o(()=>[I(s("div",Ze,[s("div",Ge,[e[49]||(e[49]=s("span",{class:"progress-label"},"Fortschritt",-1)),s("span",Xe,g(t.value.progress!==null?Math.round(t.value.progress*100):0)+"%",1)]),s("input",{type:"range",min:"0",max:"100",value:t.value.progress!==null?Math.round(t.value.progress*100):0,onInput:e[21]||(e[21]=n=>t.value.progress=n.target.value/100),class:"progress-slider"},null,40,et),s("div",tt,[s("div",{class:"progress-preset",onClick:e[22]||(e[22]=n=>t.value.progress=0)},"0%"),s("div",{class:"progress-preset",onClick:e[23]||(e[23]=n=>t.value.progress=.25)},"25%"),s("div",{class:"progress-preset",onClick:e[24]||(e[24]=n=>t.value.progress=.5)},"50%"),s("div",{class:"progress-preset",onClick:e[25]||(e[25]=n=>t.value.progress=.75)},"75%"),s("div",{class:"progress-preset",onClick:e[26]||(e[26]=n=>t.value.progress=1)},"100%"),s("div",{class:"progress-remove",onClick:H},[r(p,{size:"14"},{default:o(()=>[...e[50]||(e[50]=[c("mdi-close",-1)])]),_:1}),e[51]||(e[51]=c(" Entfernen ",-1))])])],512),[[R,S.value]])]),_:1}),r(J,null,{default:o(()=>[I(s("div",lt,[s("div",st,[I(s("textarea",{"onUpdate:modelValue":e[27]||(e[27]=n=>t.value.description=n),placeholder:"Notizen...",class:"notes-input",rows:"3"},null,512),[[q,t.value.description]])])],512),[[R,$.value]])]),_:1}),s("div",at,[r(z,{block:"",color:"primary",size:"large",disabled:!t.value.title.trim(),onClick:ke},{default:o(()=>[c(g(u.task?"Speichern":"Erstellen"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["model-value"]))}},Bt=G(nt,[["__scopeId","data-v-2ccaab31"]]),it={class:"quick-add-content"},ot={class:"quick-add-actions"},rt={__name:"QuickAddSheet",props:{modelValue:{type:Boolean,required:!0},defaultSpaceId:{type:Number,default:null}},emits:["update:modelValue","add-inbox","open-full"],setup(u,{emit:h}){const m=u,N=h,E=b(null),_=b("");Q(()=>m.modelValue,async S=>{var $;S&&(await $e(),($=E.value)==null||$.focus())});function x(){_.value.trim()&&(N("add-inbox",{title:_.value.trim(),space_id:m.defaultSpaceId}),_.value="",N("update:modelValue",!1))}function T(){const S=_.value.trim();_.value="",N("update:modelValue",!1),N("open-full",S)}return(S,$)=>(d(),F(ee,{"model-value":u.modelValue,"onUpdate:modelValue":$[1]||($[1]=i=>S.$emit("update:modelValue",i))},{default:o(()=>[r(X,{class:"quick-add-card"},{default:o(()=>[s("div",it,[r(se,{ref_key:"inputRef",ref:E,modelValue:_.value,"onUpdate:modelValue":$[0]||($[0]=i=>_.value=i),placeholder:"Was liegt dir auf dem Herzen?",variant:"plain",density:"comfortable","hide-details":"",autofocus:"",class:"quick-add-input",onKeydown:_e(x,["enter"])},null,8,["modelValue"]),s("div",ot,[r(z,{variant:"text",color:"medium-emphasis",onClick:T},{default:o(()=>[r(p,{start:""},{default:o(()=>[...$[2]||($[2]=[c("mdi-tag-plus",-1)])]),_:1})]),_:1}),r(z,{variant:"tonal",color:"primary",disabled:!_.value.trim(),onClick:x,icon:"mdi-inbox-arrow-down"},null,8,["disabled"])])])]),_:1})]),_:1},8,["model-value"]))}},Ot=G(rt,[["__scopeId","data-v-36d16d34"]]),ut={class:"sheet-header"},dt={class:"sheet-title-row"},ct={class:"sheet-title"},vt={class:"sheet-meta"},pt={key:0,class:"meta-chip"},mt={key:1,class:"meta-chip"},ft={key:2,class:"meta-chip"},gt={key:3,class:"meta-chip"},yt={key:4,class:"meta-chip"},kt={key:0,class:"sheet-stats"},_t={class:"stats-row"},$t={class:"stats-days"},wt=["title"],St={class:"day-letter"},Dt={key:2,class:"day-dot"},ht={class:"stats-summary"},Ct={key:0,class:"text-caption text-medium-emphasis"},bt={key:0},xt={key:1,class:"sheet-progress"},Vt={class:"progress-header"},Mt={class:"progress-value"},Tt={class:"progress-bar"},zt={key:2,class:"sheet-description"},It={class:"sheet-actions"},Ft={__name:"TaskActionSheet",props:{modelValue:Boolean,task:Object,showSpaceName:{type:Boolean,default:!0},showHistory:{type:Boolean,default:!0}},emits:["update:modelValue","complete","skip","postpone","edit","history","delete"],setup(u){const h=u,m=b(null);Q(()=>{var i;return[h.modelValue,(i=h.task)==null?void 0:i.id]},async([i,a])=>{var v;if(i&&a&&((v=h.task)==null?void 0:v.task_type)==="recurring")try{const t=await Se.get(`/spaces/${h.task.space_id}/tasks/${a}/stats`);m.value=t}catch(t){console.error("Failed to fetch task stats:",t),m.value=null}else m.value=null},{immediate:!0});const N=P(()=>{var t,B;const i=[],a=["So","Mo","Di","Mi","Do","Fr","Sa"],v=new Date;for(let V=6;V>=0;V--){const C=new Date(v);C.setDate(C.getDate()-V);const U=C.toISOString().split("T")[0],O=(B=(t=m.value)==null?void 0:t.stats)==null?void 0:B.find(H=>H.date===U);i.push({date:U,letter:a[C.getDay()],status:O?O.skipped?"skipped":"completed":"none",completedBy:O?`${O.first_name||""} ${O.last_name||""}`.trim():null})}return i});function E(i){return{"stat-completed":i.status==="completed","stat-skipped":i.status==="skipped","stat-none":i.status==="none"}}function _(i){return i.status==="completed"?i.completedBy?`Erledigt von ${i.completedBy}`:"Erledigt":i.status==="skipped"?"Übersprungen":i.date}const x=P(()=>h.task?h.task.task_type==="recurring":!1),T=P(()=>h.task?h.task.recurrence_type==="one_time"&&h.task.next_due_date:!1);function S(i){if(!i)return"";const[a,v,t]=i.split("-").map(Number),B=new Date(a,v-1,t),V=new Date;V.setHours(0,0,0,0);const C=new Date(V);C.setDate(C.getDate()+1);const U=`${V.getFullYear()}-${String(V.getMonth()+1).padStart(2,"0")}-${String(V.getDate()).padStart(2,"0")}`,O=`${C.getFullYear()}-${String(C.getMonth()+1).padStart(2,"0")}-${String(C.getDate()).padStart(2,"0")}`;if(i===U)return"Heute";if(i===O)return"Morgen";const H=["So","Mo","Di","Mi","Do","Fr","Sa"],j=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];return`${H[B.getDay()]}, ${B.getDate()}. ${j[B.getMonth()]}`}function $(i){if(i.recurrence_type==="interval"){const a=i.interval_days||1;return`Alle ${a} Tag${a>1?"e":""}`}if(i.recurrence_type==="schedule")try{const a=JSON.parse(i.schedule_pattern);if(a.type==="weekly")return"Wöchentlich";if(a.type==="monthly")return"Monatlich"}catch{}return"Wiederholend"}return(i,a)=>(d(),F(ee,{"model-value":u.modelValue,"onUpdate:modelValue":a[7]||(a[7]=v=>i.$emit("update:modelValue",v)),scrollable:""},{default:o(()=>[u.task?(d(),F(X,{key:0,class:"action-sheet-card"},{default:o(()=>[s("div",ut,[s("div",dt,[u.task.category?(d(),F(p,{key:0,color:u.task.category.color,icon:u.task.category.icon||"mdi-tag",class:"mr-2"},null,8,["color","icon"])):y("",!0),s("span",ct,g(u.task.title),1)]),r(z,{icon:"mdi-close",variant:"text",size:"small",onClick:a[0]||(a[0]=v=>i.$emit("update:modelValue",!1))})]),s("div",vt,[u.showSpaceName&&u.task.space_name?(d(),f("div",pt,[r(p,{size:"14",color:u.task.space_color||"grey"},{default:o(()=>[...a[8]||(a[8]=[c("mdi-folder",-1)])]),_:1},8,["color"]),s("span",null,g(u.task.space_name),1)])):y("",!0),u.task.category?(d(),f("div",mt,[r(p,{size:"14",color:u.task.category.color,icon:u.task.category.icon||"mdi-tag"},null,8,["color","icon"]),s("span",null,g(u.task.category.name),1)])):y("",!0),u.task.next_due_date?(d(),f("div",ft,[r(p,{size:"14"},{default:o(()=>[...a[9]||(a[9]=[c("mdi-calendar",-1)])]),_:1}),s("span",null,g(S(u.task.next_due_date)),1)])):y("",!0),u.task.has_specific_time?(d(),f("div",gt,[r(p,{size:"14"},{default:o(()=>[...a[10]||(a[10]=[c("mdi-clock-outline",-1)])]),_:1}),s("span",null,g(u.task.time_of_day),1)])):y("",!0),u.task.task_type==="recurring"?(d(),f("div",yt,[r(p,{size:"14"},{default:o(()=>[...a[11]||(a[11]=[c("mdi-refresh",-1)])]),_:1}),s("span",null,g($(u.task)),1)])):y("",!0)]),u.task.task_type==="recurring"?(d(),f("div",kt,[a[14]||(a[14]=s("div",{class:"stats-label"},"Letzte 7 Tage",-1)),s("div",_t,[s("div",$t,[(d(!0),f(K,null,L(N.value,(v,t)=>(d(),f("div",{key:t,class:k(["stat-day",E(v)]),title:_(v)},[s("span",St,g(v.letter),1),v.status==="completed"?(d(),F(p,{key:0,size:"12",color:"success"},{default:o(()=>[...a[12]||(a[12]=[c("mdi-check",-1)])]),_:1})):v.status==="skipped"?(d(),F(p,{key:1,size:"12",color:"warning"},{default:o(()=>[...a[13]||(a[13]=[c("mdi-debug-step-over",-1)])]),_:1})):(d(),f("span",Dt))],10,wt))),128))]),s("div",ht,[m.value?(d(),f("span",Ct,[c(g(m.value.summary.completed)+" erledigt ",1),m.value.summary.skipped?(d(),f("span",bt,", "+g(m.value.summary.skipped)+" übersprungen",1)):y("",!0)])):y("",!0)])])])):y("",!0),u.task.progress!==null&&u.task.progress!==void 0?(d(),f("div",xt,[s("div",Vt,[a[15]||(a[15]=s("span",{class:"progress-label"},"Fortschritt",-1)),s("span",Mt,g(Math.round(u.task.progress*100))+"%",1)]),s("div",Tt,[s("div",{class:"progress-fill",style:we({width:`${u.task.progress*100}%`})},null,4)])])):y("",!0),u.task.description?(d(),f("div",zt,g(u.task.description),1)):y("",!0),s("div",It,[r(z,{variant:"tonal",color:"success",onClick:a[1]||(a[1]=v=>i.$emit("complete"))},{default:o(()=>[r(p,{start:""},{default:o(()=>[...a[16]||(a[16]=[c("mdi-check",-1)])]),_:1}),a[17]||(a[17]=c(" Erledigen ",-1))]),_:1}),x.value?(d(),F(z,{key:0,variant:"tonal",onClick:a[2]||(a[2]=v=>i.$emit("skip"))},{default:o(()=>[r(p,{start:""},{default:o(()=>[...a[18]||(a[18]=[c("mdi-debug-step-over",-1)])]),_:1}),a[19]||(a[19]=c(" Überspringen ",-1))]),_:1})):y("",!0),T.value?(d(),F(z,{key:1,variant:"tonal",onClick:a[3]||(a[3]=v=>i.$emit("postpone"))},{default:o(()=>[r(p,{start:""},{default:o(()=>[...a[20]||(a[20]=[c("mdi-calendar-clock",-1)])]),_:1}),a[21]||(a[21]=c(" Verschieben ",-1))]),_:1})):y("",!0),r(z,{variant:"tonal",onClick:a[4]||(a[4]=v=>i.$emit("edit"))},{default:o(()=>[r(p,{start:""},{default:o(()=>[...a[22]||(a[22]=[c("mdi-pencil",-1)])]),_:1}),a[23]||(a[23]=c(" Bearbeiten ",-1))]),_:1}),u.showHistory?(d(),F(z,{key:2,variant:"tonal",onClick:a[5]||(a[5]=v=>i.$emit("history"))},{default:o(()=>[r(p,{start:""},{default:o(()=>[...a[24]||(a[24]=[c("mdi-chart-timeline-variant",-1)])]),_:1}),a[25]||(a[25]=c(" Verlauf ",-1))]),_:1})):y("",!0),r(z,{variant:"tonal",color:"error",onClick:a[6]||(a[6]=v=>i.$emit("delete"))},{default:o(()=>[r(p,{start:""},{default:o(()=>[...a[26]||(a[26]=[c("mdi-delete",-1)])]),_:1}),a[27]||(a[27]=c(" Löschen ",-1))]),_:1})])]),_:1})):y("",!0)]),_:1},8,["model-value"]))}},At=G(Ft,[["__scopeId","data-v-bc6f07bd"]]);export{Ot as Q,At as T,Bt as a};
