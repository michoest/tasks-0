import{_ as G,r as V,x as P,v as Z,c as O,o as d,w as o,b as r,f as X,E as a,m as se,p as F,C as m,l as y,$,J as p,h as c,t as g,K as H,L as B,F as K,G as L,R as J,a7 as R,U as ee,a8 as $e,S as Se,A as we}from"./index-NUA_boj3.js";const De={class:"sheet-header"},be={class:"task-options"},Ce={class:"option-label"},he={class:"option-label"},xe={class:"option-label"},Ve={key:0,class:"option-label"},Me={class:"option-label"},ze={class:"task-sections"},Te={class:"section-content"},Ie={class:"pill-grid"},Ne=["onClick"],Fe={class:"section-content"},Be={class:"pill-grid"},Oe=["onClick"],Ae={class:"section-content"},Ue={class:"pill-grid mb-3"},We={key:0,class:"date-section"},qe={class:"quick-dates"},Ee={key:1,class:"interval-section"},He={class:"interval-row"},Je={class:"mt-2"},Re={key:2,class:"schedule-section"},Ke={class:"schedule-type-row"},Le={key:0,class:"weekday-grid"},Ye=["onClick"],Pe={key:1,class:"monthday-grid"},Qe=["onClick"],je={key:3,class:"time-section"},Ze={class:"progress-section"},Ge={class:"progress-header"},Xe={class:"progress-value"},et=["value"],tt={class:"progress-actions"},lt={class:"notes-section"},st={class:"notes-input-wrapper"},at={class:"sheet-footer"},nt={__name:"TaskDialog",props:{modelValue:Boolean,task:Object,categories:{type:Array,default:()=>[]},spaces:{type:Array,default:()=>[]},defaultSpaceId:Number,initialTitle:{type:String,default:""},initialCategoryId:{type:Number,default:null}},emits:["update:modelValue","save"],setup(u,{expose:h,emit:M}){const k=u,A=M,U=V(null);h({focusInputNow(){var e,n,_,b,D;(n=(e=U.value)==null?void 0:e.focus)==null||n.call(e);const l=(D=(b=(_=U.value)==null?void 0:_.$el)==null?void 0:b.querySelector)==null?void 0:D.call(b,"input,textarea");l==null||l.focus({preventScroll:!0})}});const S=V(!1),z=V(!1),I=V(!1),w=V(!1),i=V(!1),s=V("weekly"),v=V([]),f=V([]),t=V(x()),T=P(()=>t.value.space_id?k.categories.filter(l=>l.space_id===t.value.space_id):k.categories);function x(){var l;return{title:k.initialTitle||"",description:"",space_id:k.defaultSpaceId||((l=k.spaces[0])==null?void 0:l.id)||null,category_id:null,recurrence_type:"no_date",interval_days:1,interval_exclude_weekends:!1,has_specific_time:!1,time_of_day:"09:00",next_due_date:q(),progress:null,status:"active"}}function q(){return new Date().toISOString().split("T")[0]}function N(l){l==="space"?(S.value=!S.value,z.value=!1,I.value=!1):l==="categories"?(z.value=!z.value,S.value=!1,I.value=!1):l==="recurrence"&&(I.value=!I.value,S.value=!1,z.value=!1)}function E(){w.value=!w.value,w.value&&t.value.progress===null&&(t.value.progress=0)}function Q(){t.value.progress=null,w.value=!1}function ae(){t.value.status=t.value.status==="active"?"inactive":"active"}function ne(l){t.value.space_id=l,T.value.find(n=>n.id===t.value.category_id)||(t.value.category_id=null)}function ie(){const l=k.spaces.find(e=>e.id===t.value.space_id);return(l==null?void 0:l.personal_name)||(l==null?void 0:l.name)||"Space"}function oe(){const l=k.spaces.find(e=>e.id===t.value.space_id);return(l==null?void 0:l.personal_color)||"primary"}function re(){if(!t.value.category_id)return"Kategorie";const l=k.categories.find(e=>e.id===t.value.category_id);return(l==null?void 0:l.name)||"Kategorie"}function ue(){if(!t.value.category_id)return"grey";const l=k.categories.find(e=>e.id===t.value.category_id);return(l==null?void 0:l.color)||"grey"}function de(){if(!t.value.category_id)return"mdi-tag";const l=k.categories.find(e=>e.id===t.value.category_id);return(l==null?void 0:l.icon)||"mdi-tag"}function ce(){switch(t.value.recurrence_type){case"no_date":return"mdi-calendar-question";case"one_time":return"mdi-calendar";case"interval":return"mdi-refresh";case"schedule":return"mdi-calendar-clock";default:return"mdi-calendar"}}function ve(){return t.value.recurrence_type==="no_date"?"grey":"primary"}function pe(){switch(t.value.recurrence_type){case"no_date":return"Irgendwann";case"one_time":return t.value.next_due_date?me(t.value.next_due_date):"Datum wählen";case"interval":return`Alle ${t.value.interval_days}d`;case"schedule":return s.value==="weekly"&&v.value.length>0?`${v.value.length}x/Woche`:s.value==="monthly"&&f.value.length>0?`${f.value.length}x/Monat`:"Zeitplan";default:return"Datum"}}function me(l){const[e,n,_]=l.split("-").map(Number),b=new Date(e,n-1,_),D=new Date;D.setHours(0,0,0,0);const C=new Date(D);C.setDate(C.getDate()+1);const Y=`${D.getFullYear()}-${String(D.getMonth()+1).padStart(2,"0")}-${String(D.getDate()).padStart(2,"0")}`,W=`${C.getFullYear()}-${String(C.getMonth()+1).padStart(2,"0")}-${String(C.getDate()).padStart(2,"0")}`;return l===Y?"Heute":l===W?"Morgen":`${["So","Mo","Di","Mi","Do","Fr","Sa"][b.getDay()]}, ${b.getDate()}.${b.getMonth()+1}.`}function j(l){const e=new Date;l==="today"?t.value.next_due_date=e.toISOString().split("T")[0]:l==="tomorrow"?(e.setDate(e.getDate()+1),t.value.next_due_date=e.toISOString().split("T")[0]):l==="nextWeek"&&(e.setDate(e.getDate()+7),t.value.next_due_date=e.toISOString().split("T")[0])}function fe(l){const e=v.value.indexOf(l);e===-1?v.value.push(l):v.value.splice(e,1)}function ge(l){const e=f.value.indexOf(l);e===-1?f.value.push(l):f.value.splice(e,1)}Z(()=>k.modelValue,l=>{l&&(k.task?ye(k.task):(t.value=x(),t.value.title=k.initialTitle||"",t.value.category_id=k.initialCategoryId||null,v.value=[],f.value=[],S.value=!1,z.value=!1,I.value=!1,w.value=!1,i.value=!1))}),Z(()=>k.initialTitle,l=>{k.modelValue&&!k.task&&(t.value.title=l||"")});function ye(l){if(t.value={title:l.title||"",description:l.description||"",space_id:l.space_id||k.defaultSpaceId,category_id:l.category_id||null,recurrence_type:l.recurrence_type||"no_date",interval_days:l.interval_days||1,interval_exclude_weekends:!!l.interval_exclude_weekends,has_specific_time:!!l.has_specific_time,time_of_day:l.time_of_day||"09:00",next_due_date:l.next_due_date||q(),progress:l.progress!==void 0?l.progress:null,status:l.status||"active"},l.schedule_pattern)try{const e=JSON.parse(l.schedule_pattern);s.value=e.type||"weekly",v.value=e.weekdays||[],f.value=e.days||[]}catch(e){console.error("Failed to parse schedule:",e)}i.value=!!l.description,w.value=l.progress!==null&&l.progress!==void 0}function te(){A("update:modelValue",!1)}function ke(l){var n,_;const e=new Date;if(e.setHours(0,0,0,0),l.type==="weekly"&&((n=l.weekdays)!=null&&n.length)){const b=[...l.weekdays].sort((C,Y)=>C-Y),D=new Date(e);for(let C=0;C<8;C++){if(b.includes(D.getDay()))return D.toISOString().split("T")[0];D.setDate(D.getDate()+1)}}if(l.type==="monthly"&&((_=l.days)!=null&&_.length)){const b=[...l.days].sort((W,le)=>W-le),D=e.getDate(),C=b.find(W=>W>=D);if(C){const W=new Date(e.getFullYear(),e.getMonth(),C);if(W.getDate()===C)return W.toISOString().split("T")[0]}return new Date(e.getFullYear(),e.getMonth()+1,b[0]).toISOString().split("T")[0]}return e.toISOString().split("T")[0]}function _e(){if(!t.value.title.trim())return;const l={title:t.value.title.trim(),description:t.value.description||null,space_id:t.value.space_id,category_id:t.value.category_id||null,recurrence_type:t.value.recurrence_type,has_specific_time:t.value.has_specific_time?1:0,time_of_day:t.value.has_specific_time?t.value.time_of_day:null,progress:t.value.progress,status:t.value.status};if(t.value.recurrence_type==="no_date")l.next_due_date=null;else if(t.value.recurrence_type==="one_time")l.next_due_date=t.value.next_due_date;else if(t.value.recurrence_type==="interval")l.interval_days=t.value.interval_days,l.interval_exclude_weekends=t.value.interval_exclude_weekends?1:0,l.next_due_date=t.value.next_due_date;else if(t.value.recurrence_type==="schedule"){const e={type:s.value};if(s.value==="weekly"){if(v.value.length===0){alert("Bitte mindestens einen Wochentag wählen");return}e.weekdays=v.value.sort((n,_)=>n-_)}else{if(f.value.length===0){alert("Bitte mindestens einen Tag wählen");return}e.days=f.value.sort((n,_)=>n-_)}l.schedule_pattern=JSON.stringify(e),l.next_due_date=ke(e)}A("save",l),te()}return(l,e)=>(d(),O(ee,{eager:"","model-value":u.modelValue,"onUpdate:modelValue":e[28]||(e[28]=n=>l.$emit("update:modelValue",n)),scrollable:""},{default:o(()=>[r(X,{class:"task-dialog-card"},{default:o(()=>[a("div",De,[r(se,{ref_key:"titleRef",ref:U,modelValue:t.value.title,"onUpdate:modelValue":e[0]||(e[0]=n=>t.value.title=n),placeholder:"Aufgabe...",variant:"plain",density:"comfortable","hide-details":"",autofocus:"",class:"title-input"},null,8,["modelValue"]),r(F,{icon:"mdi-close",variant:"text",size:"small",onClick:te,class:"close-btn"})]),a("div",be,[a("div",{class:$(["option-pill",{"option-active":S.value}]),onClick:e[1]||(e[1]=n=>N("space"))},[r(p,{size:"18",color:oe()},{default:o(()=>[...e[29]||(e[29]=[c("mdi-folder",-1)])]),_:1},8,["color"]),a("span",Ce,g(ie()),1)],2),a("div",{class:$(["option-pill",{"option-active":z.value}]),onClick:e[2]||(e[2]=n=>N("categories"))},[r(p,{size:"18",color:ue(),icon:de()},null,8,["color","icon"]),a("span",he,g(re()),1)],2),a("div",{class:$(["option-pill",{"option-active":I.value}]),onClick:e[3]||(e[3]=n=>N("recurrence"))},[r(p,{size:"18",color:ve()},{default:o(()=>[c(g(ce()),1)]),_:1},8,["color"]),a("span",xe,g(pe()),1)],2),a("div",{class:$(["option-pill",{"option-active":w.value||t.value.progress!==null}]),onClick:E},[r(p,{size:"16",color:t.value.progress!==null?"primary":void 0},{default:o(()=>[...e[30]||(e[30]=[c("mdi-percent",-1)])]),_:1},8,["color"]),t.value.progress!==null?(d(),m("span",Ve,g(Math.round(t.value.progress*100))+"%",1)):y("",!0)],2),a("div",{class:$(["option-pill",{"option-active":i.value}]),onClick:e[4]||(e[4]=n=>i.value=!i.value)},[r(p,{size:"16"},{default:o(()=>[...e[31]||(e[31]=[c("mdi-note-text-outline",-1)])]),_:1})],2),u.task?(d(),m("div",{key:0,class:$(["option-pill",{"option-inactive":t.value.status==="inactive"}]),onClick:ae},[r(p,{size:"16",color:t.value.status==="inactive"?"warning":"success"},{default:o(()=>[c(g(t.value.status==="inactive"?"mdi-pause-circle":"mdi-play-circle"),1)]),_:1},8,["color"]),a("span",Me,g(t.value.status==="inactive"?"Inaktiv":"Aktiv"),1)],2)):y("",!0)]),a("div",ze,[r(H,null,{default:o(()=>[B(a("div",Te,[a("div",Ie,[(d(!0),m(K,null,L(u.spaces,n=>(d(),m("div",{key:n.id,class:$(["selectable-pill",{"pill-selected":t.value.space_id===n.id}]),onClick:_=>ne(n.id)},[r(p,{size:"16",color:n.personal_color||"primary"},{default:o(()=>[...e[32]||(e[32]=[c("mdi-folder",-1)])]),_:1},8,["color"]),a("span",null,g(n.personal_name||n.name),1)],10,Ne))),128))])],512),[[J,S.value]])]),_:1}),r(H,null,{default:o(()=>[B(a("div",Fe,[a("div",Be,[a("div",{class:$(["selectable-pill",{"pill-selected":!t.value.category_id}]),onClick:e[5]||(e[5]=n=>t.value.category_id=null)},[r(p,{size:"16",color:"grey"},{default:o(()=>[...e[33]||(e[33]=[c("mdi-tag-off",-1)])]),_:1}),e[34]||(e[34]=a("span",null,"Keine",-1))],2),(d(!0),m(K,null,L(T.value,n=>(d(),m("div",{key:n.id,class:$(["selectable-pill",{"pill-selected":t.value.category_id===n.id}]),onClick:_=>t.value.category_id=n.id},[r(p,{size:"16",color:n.color},{default:o(()=>[c(g(n.icon||"mdi-tag"),1)]),_:2},1032,["color"]),a("span",null,g(n.name),1)],10,Oe))),128))])],512),[[J,z.value]])]),_:1}),r(H,null,{default:o(()=>[B(a("div",Ae,[a("div",Ue,[a("div",{class:$(["selectable-pill",{"pill-selected":t.value.recurrence_type==="no_date"}]),onClick:e[6]||(e[6]=n=>t.value.recurrence_type="no_date")},[r(p,{size:"16"},{default:o(()=>[...e[35]||(e[35]=[c("mdi-calendar-question",-1)])]),_:1}),e[36]||(e[36]=a("span",null,"Irgendwann",-1))],2),a("div",{class:$(["selectable-pill",{"pill-selected":t.value.recurrence_type==="one_time"}]),onClick:e[7]||(e[7]=n=>t.value.recurrence_type="one_time")},[r(p,{size:"16"},{default:o(()=>[...e[37]||(e[37]=[c("mdi-calendar",-1)])]),_:1}),e[38]||(e[38]=a("span",null,"Einmalig",-1))],2),a("div",{class:$(["selectable-pill",{"pill-selected":t.value.recurrence_type==="interval"}]),onClick:e[8]||(e[8]=n=>t.value.recurrence_type="interval")},[r(p,{size:"16"},{default:o(()=>[...e[39]||(e[39]=[c("mdi-refresh",-1)])]),_:1}),e[40]||(e[40]=a("span",null,"Intervall",-1))],2),a("div",{class:$(["selectable-pill",{"pill-selected":t.value.recurrence_type==="schedule"}]),onClick:e[9]||(e[9]=n=>t.value.recurrence_type="schedule")},[r(p,{size:"16"},{default:o(()=>[...e[41]||(e[41]=[c("mdi-calendar-clock",-1)])]),_:1}),e[42]||(e[42]=a("span",null,"Zeitplan",-1))],2)]),t.value.recurrence_type==="one_time"?(d(),m("div",We,[a("div",qe,[a("div",{class:"date-chip",onClick:e[10]||(e[10]=n=>j("today"))},"Heute"),a("div",{class:"date-chip",onClick:e[11]||(e[11]=n=>j("tomorrow"))},"Morgen"),a("div",{class:"date-chip",onClick:e[12]||(e[12]=n=>j("nextWeek"))},"Nächste Woche")]),B(a("input",{"onUpdate:modelValue":e[13]||(e[13]=n=>t.value.next_due_date=n),type:"date",class:"date-input"},null,512),[[R,t.value.next_due_date]])])):y("",!0),t.value.recurrence_type==="interval"?(d(),m("div",Ee,[a("div",He,[e[44]||(e[44]=a("span",{class:"interval-label"},"Alle",-1)),B(a("input",{"onUpdate:modelValue":e[14]||(e[14]=n=>t.value.interval_days=n),type:"number",min:"1",class:"interval-input"},null,512),[[R,t.value.interval_days,void 0,{number:!0}]]),e[45]||(e[45]=a("span",{class:"interval-label"},"Tage",-1)),a("div",{class:$(["interval-toggle",{"toggle-active":t.value.interval_exclude_weekends}]),onClick:e[15]||(e[15]=n=>t.value.interval_exclude_weekends=!t.value.interval_exclude_weekends)},[r(p,{size:"14"},{default:o(()=>[...e[43]||(e[43]=[c("mdi-briefcase-off",-1)])]),_:1})],2)]),a("div",Je,[e[46]||(e[46]=a("span",{class:"text-caption text-medium-emphasis"},"Start:",-1)),B(a("input",{"onUpdate:modelValue":e[16]||(e[16]=n=>t.value.next_due_date=n),type:"date",class:"date-input ml-2"},null,512),[[R,t.value.next_due_date]])])])):y("",!0),t.value.recurrence_type==="schedule"?(d(),m("div",Re,[a("div",Ke,[a("div",{class:$(["schedule-type-pill",{"type-selected":s.value==="weekly"}]),onClick:e[17]||(e[17]=n=>s.value="weekly")}," Woche ",2),a("div",{class:$(["schedule-type-pill",{"type-selected":s.value==="monthly"}]),onClick:e[18]||(e[18]=n=>s.value="monthly")}," Monat ",2)]),s.value==="weekly"?(d(),m("div",Le,[(d(),m(K,null,L(["Mo","Di","Mi","Do","Fr","Sa","So"],(n,_)=>a("div",{key:_,class:$(["weekday-chip",{"day-selected":v.value.includes(_===6?0:_+1)}]),onClick:b=>fe(_===6?0:_+1)},g(n),11,Ye)),64))])):y("",!0),s.value==="monthly"?(d(),m("div",Pe,[(d(),m(K,null,L(31,n=>a("div",{key:n,class:$(["monthday-chip",{"day-selected":f.value.includes(n)}]),onClick:_=>ge(n)},g(n),11,Qe)),64))])):y("",!0)])):y("",!0),["one_time","interval","schedule"].includes(t.value.recurrence_type)?(d(),m("div",je,[a("div",{class:$(["time-toggle",{"toggle-active":t.value.has_specific_time}]),onClick:e[19]||(e[19]=n=>t.value.has_specific_time=!t.value.has_specific_time)},[r(p,{size:"16"},{default:o(()=>[...e[47]||(e[47]=[c("mdi-clock-outline",-1)])]),_:1}),e[48]||(e[48]=a("span",null,"Uhrzeit",-1))],2),t.value.has_specific_time?B((d(),m("input",{key:0,"onUpdate:modelValue":e[20]||(e[20]=n=>t.value.time_of_day=n),type:"time",class:"time-input"},null,512)),[[R,t.value.time_of_day]]):y("",!0)])):y("",!0)],512),[[J,I.value]])]),_:1})]),r(H,null,{default:o(()=>[B(a("div",Ze,[a("div",Ge,[e[49]||(e[49]=a("span",{class:"progress-label"},"Fortschritt",-1)),a("span",Xe,g(t.value.progress!==null?Math.round(t.value.progress*100):0)+"%",1)]),a("input",{type:"range",min:"0",max:"100",value:t.value.progress!==null?Math.round(t.value.progress*100):0,onInput:e[21]||(e[21]=n=>t.value.progress=n.target.value/100),class:"progress-slider"},null,40,et),a("div",tt,[a("div",{class:"progress-preset",onClick:e[22]||(e[22]=n=>t.value.progress=0)},"0%"),a("div",{class:"progress-preset",onClick:e[23]||(e[23]=n=>t.value.progress=.25)},"25%"),a("div",{class:"progress-preset",onClick:e[24]||(e[24]=n=>t.value.progress=.5)},"50%"),a("div",{class:"progress-preset",onClick:e[25]||(e[25]=n=>t.value.progress=.75)},"75%"),a("div",{class:"progress-preset",onClick:e[26]||(e[26]=n=>t.value.progress=1)},"100%"),a("div",{class:"progress-remove",onClick:Q},[r(p,{size:"14"},{default:o(()=>[...e[50]||(e[50]=[c("mdi-close",-1)])]),_:1}),e[51]||(e[51]=c(" Entfernen ",-1))])])],512),[[J,w.value]])]),_:1}),r(H,null,{default:o(()=>[B(a("div",lt,[a("div",st,[B(a("textarea",{"onUpdate:modelValue":e[27]||(e[27]=n=>t.value.description=n),placeholder:"Notizen...",class:"notes-input",rows:"3"},null,512),[[R,t.value.description]])])],512),[[J,i.value]])]),_:1}),a("div",at,[r(F,{block:"",color:"primary",size:"large",disabled:!t.value.title.trim(),onClick:_e},{default:o(()=>[c(g(u.task?"Speichern":"Erstellen"),1)]),_:1},8,["disabled"])])]),_:1})]),_:1},8,["model-value"]))}},Bt=G(nt,[["__scopeId","data-v-07393e53"]]),it={class:"quick-add-content"},ot={class:"quick-add-actions"},rt={__name:"QuickAddSheet",props:{modelValue:{type:Boolean,required:!0},defaultSpaceId:{type:Number,default:null}},emits:["update:modelValue","add-inbox","open-full"],setup(u,{expose:h,emit:M}){const k=u,A=M,U=V(null),S=V("");h({focusInputNow(){var i,s,v,f,t;(s=(i=U.value)==null?void 0:i.focus)==null||s.call(i);const w=(t=(f=(v=U.value)==null?void 0:v.$el)==null?void 0:f.querySelector)==null?void 0:t.call(f,"input,textarea");w==null||w.focus({preventScroll:!0})}});function z(){S.value.trim()&&(A("add-inbox",{title:S.value.trim(),space_id:k.defaultSpaceId}),S.value="",A("update:modelValue",!1))}function I(){const w=S.value.trim();S.value="",A("update:modelValue",!1),A("open-full",w)}return(w,i)=>(d(),O(ee,{eager:"","model-value":u.modelValue,"onUpdate:modelValue":i[1]||(i[1]=s=>w.$emit("update:modelValue",s))},{default:o(()=>[r(X,{class:"quick-add-card"},{default:o(()=>[a("div",it,[r(se,{ref_key:"inputRef",ref:U,modelValue:S.value,"onUpdate:modelValue":i[0]||(i[0]=s=>S.value=s),placeholder:"Was liegt dir auf dem Herzen?",variant:"plain",density:"comfortable","hide-details":"",autofocus:"",class:"quick-add-input",onKeydown:$e(z,["enter"])},null,8,["modelValue"]),a("div",ot,[r(F,{variant:"text",color:"medium-emphasis",onClick:I},{default:o(()=>[r(p,{start:""},{default:o(()=>[...i[2]||(i[2]=[c("mdi-tag-plus",-1)])]),_:1})]),_:1}),r(F,{variant:"tonal",color:"primary",disabled:!S.value.trim(),onClick:z,icon:"mdi-inbox-arrow-down"},null,8,["disabled"])])])]),_:1})]),_:1},8,["model-value"]))}},Ot=G(rt,[["__scopeId","data-v-9209b5bb"]]),ut={class:"sheet-header"},dt={class:"sheet-title-row"},ct={class:"sheet-title"},vt={class:"sheet-meta"},pt={key:0,class:"meta-chip"},mt={key:1,class:"meta-chip"},ft={key:2,class:"meta-chip"},gt={key:3,class:"meta-chip"},yt={key:4,class:"meta-chip"},kt={key:0,class:"sheet-stats"},_t={class:"stats-row"},$t={class:"stats-days"},St=["title"],wt={class:"day-letter"},Dt={key:2,class:"day-dot"},bt={class:"stats-summary"},Ct={key:0,class:"text-caption text-medium-emphasis"},ht={key:0},xt={key:1,class:"sheet-progress"},Vt={class:"progress-header"},Mt={class:"progress-value"},zt={class:"progress-bar"},Tt={key:2,class:"sheet-description"},It={class:"sheet-actions"},Nt={__name:"TaskActionSheet",props:{modelValue:Boolean,task:Object,showSpaceName:{type:Boolean,default:!0},showHistory:{type:Boolean,default:!0}},emits:["update:modelValue","complete","skip","postpone","edit","history","delete"],setup(u){const h=u,M=V(null);Z(()=>{var i;return[h.modelValue,(i=h.task)==null?void 0:i.id]},async([i,s])=>{var v;if(i&&s&&((v=h.task)==null?void 0:v.task_type)==="recurring")try{const f=await we.get(`/spaces/${h.task.space_id}/tasks/${s}/stats`);M.value=f}catch(f){console.error("Failed to fetch task stats:",f),M.value=null}else M.value=null},{immediate:!0});const k=P(()=>{var f,t;const i=[],s=["So","Mo","Di","Mi","Do","Fr","Sa"],v=new Date;for(let T=6;T>=0;T--){const x=new Date(v);x.setDate(x.getDate()-T);const q=x.toISOString().split("T")[0],N=(t=(f=M.value)==null?void 0:f.stats)==null?void 0:t.find(E=>E.date===q);i.push({date:q,letter:s[x.getDay()],status:N?N.skipped?"skipped":"completed":"none",completedBy:N?`${N.first_name||""} ${N.last_name||""}`.trim():null})}return i});function A(i){return{"stat-completed":i.status==="completed","stat-skipped":i.status==="skipped","stat-none":i.status==="none"}}function U(i){return i.status==="completed"?i.completedBy?`Erledigt von ${i.completedBy}`:"Erledigt":i.status==="skipped"?"Übersprungen":i.date}const S=P(()=>h.task?h.task.task_type==="recurring":!1),z=P(()=>h.task?h.task.recurrence_type==="one_time"&&h.task.next_due_date:!1);function I(i){if(!i)return"";const[s,v,f]=i.split("-").map(Number),t=new Date(s,v-1,f),T=new Date;T.setHours(0,0,0,0);const x=new Date(T);x.setDate(x.getDate()+1);const q=`${T.getFullYear()}-${String(T.getMonth()+1).padStart(2,"0")}-${String(T.getDate()).padStart(2,"0")}`,N=`${x.getFullYear()}-${String(x.getMonth()+1).padStart(2,"0")}-${String(x.getDate()).padStart(2,"0")}`;if(i===q)return"Heute";if(i===N)return"Morgen";const E=["So","Mo","Di","Mi","Do","Fr","Sa"],Q=["Jan","Feb","Mär","Apr","Mai","Jun","Jul","Aug","Sep","Okt","Nov","Dez"];return`${E[t.getDay()]}, ${t.getDate()}. ${Q[t.getMonth()]}`}function w(i){if(i.recurrence_type==="interval"){const s=i.interval_days||1;return`Alle ${s} Tag${s>1?"e":""}`}if(i.recurrence_type==="schedule")try{const s=JSON.parse(i.schedule_pattern);if(s.type==="weekly")return"Wöchentlich";if(s.type==="monthly")return"Monatlich"}catch{}return"Wiederholend"}return(i,s)=>(d(),O(ee,{"model-value":u.modelValue,"onUpdate:modelValue":s[7]||(s[7]=v=>i.$emit("update:modelValue",v)),scrollable:""},{default:o(()=>[u.task?(d(),O(X,{key:0,class:"action-sheet-card"},{default:o(()=>[a("div",ut,[a("div",dt,[u.task.category?(d(),O(p,{key:0,color:u.task.category.color,icon:u.task.category.icon||"mdi-tag",class:"mr-2"},null,8,["color","icon"])):y("",!0),a("span",ct,g(u.task.title),1)]),r(F,{icon:"mdi-close",variant:"text",size:"small",onClick:s[0]||(s[0]=v=>i.$emit("update:modelValue",!1))})]),a("div",vt,[u.showSpaceName&&u.task.space_name?(d(),m("div",pt,[r(p,{size:"14",color:u.task.space_color||"grey"},{default:o(()=>[...s[8]||(s[8]=[c("mdi-folder",-1)])]),_:1},8,["color"]),a("span",null,g(u.task.space_name),1)])):y("",!0),u.task.category?(d(),m("div",mt,[r(p,{size:"14",color:u.task.category.color,icon:u.task.category.icon||"mdi-tag"},null,8,["color","icon"]),a("span",null,g(u.task.category.name),1)])):y("",!0),u.task.next_due_date?(d(),m("div",ft,[r(p,{size:"14"},{default:o(()=>[...s[9]||(s[9]=[c("mdi-calendar",-1)])]),_:1}),a("span",null,g(I(u.task.next_due_date)),1)])):y("",!0),u.task.has_specific_time?(d(),m("div",gt,[r(p,{size:"14"},{default:o(()=>[...s[10]||(s[10]=[c("mdi-clock-outline",-1)])]),_:1}),a("span",null,g(u.task.time_of_day),1)])):y("",!0),u.task.task_type==="recurring"?(d(),m("div",yt,[r(p,{size:"14"},{default:o(()=>[...s[11]||(s[11]=[c("mdi-refresh",-1)])]),_:1}),a("span",null,g(w(u.task)),1)])):y("",!0)]),u.task.task_type==="recurring"?(d(),m("div",kt,[s[14]||(s[14]=a("div",{class:"stats-label"},"Letzte 7 Tage",-1)),a("div",_t,[a("div",$t,[(d(!0),m(K,null,L(k.value,(v,f)=>(d(),m("div",{key:f,class:$(["stat-day",A(v)]),title:U(v)},[a("span",wt,g(v.letter),1),v.status==="completed"?(d(),O(p,{key:0,size:"12",color:"success"},{default:o(()=>[...s[12]||(s[12]=[c("mdi-check",-1)])]),_:1})):v.status==="skipped"?(d(),O(p,{key:1,size:"12",color:"warning"},{default:o(()=>[...s[13]||(s[13]=[c("mdi-debug-step-over",-1)])]),_:1})):(d(),m("span",Dt))],10,St))),128))]),a("div",bt,[M.value?(d(),m("span",Ct,[c(g(M.value.summary.completed)+" erledigt ",1),M.value.summary.skipped?(d(),m("span",ht,", "+g(M.value.summary.skipped)+" übersprungen",1)):y("",!0)])):y("",!0)])])])):y("",!0),u.task.progress!==null&&u.task.progress!==void 0?(d(),m("div",xt,[a("div",Vt,[s[15]||(s[15]=a("span",{class:"progress-label"},"Fortschritt",-1)),a("span",Mt,g(Math.round(u.task.progress*100))+"%",1)]),a("div",zt,[a("div",{class:"progress-fill",style:Se({width:`${u.task.progress*100}%`})},null,4)])])):y("",!0),u.task.description?(d(),m("div",Tt,g(u.task.description),1)):y("",!0),a("div",It,[r(F,{variant:"tonal",color:"success",onClick:s[1]||(s[1]=v=>i.$emit("complete"))},{default:o(()=>[r(p,{start:""},{default:o(()=>[...s[16]||(s[16]=[c("mdi-check",-1)])]),_:1}),s[17]||(s[17]=c(" Erledigen ",-1))]),_:1}),S.value?(d(),O(F,{key:0,variant:"tonal",onClick:s[2]||(s[2]=v=>i.$emit("skip"))},{default:o(()=>[r(p,{start:""},{default:o(()=>[...s[18]||(s[18]=[c("mdi-debug-step-over",-1)])]),_:1}),s[19]||(s[19]=c(" Überspringen ",-1))]),_:1})):y("",!0),z.value?(d(),O(F,{key:1,variant:"tonal",onClick:s[3]||(s[3]=v=>i.$emit("postpone"))},{default:o(()=>[r(p,{start:""},{default:o(()=>[...s[20]||(s[20]=[c("mdi-calendar-clock",-1)])]),_:1}),s[21]||(s[21]=c(" Verschieben ",-1))]),_:1})):y("",!0),r(F,{variant:"tonal",onClick:s[4]||(s[4]=v=>i.$emit("edit"))},{default:o(()=>[r(p,{start:""},{default:o(()=>[...s[22]||(s[22]=[c("mdi-pencil",-1)])]),_:1}),s[23]||(s[23]=c(" Bearbeiten ",-1))]),_:1}),u.showHistory?(d(),O(F,{key:2,variant:"tonal",onClick:s[5]||(s[5]=v=>i.$emit("history"))},{default:o(()=>[r(p,{start:""},{default:o(()=>[...s[24]||(s[24]=[c("mdi-chart-timeline-variant",-1)])]),_:1}),s[25]||(s[25]=c(" Verlauf ",-1))]),_:1})):y("",!0),r(F,{variant:"tonal",color:"error",onClick:s[6]||(s[6]=v=>i.$emit("delete"))},{default:o(()=>[r(p,{start:""},{default:o(()=>[...s[26]||(s[26]=[c("mdi-delete",-1)])]),_:1}),s[27]||(s[27]=c(" Löschen ",-1))]),_:1})])]),_:1})):y("",!0)]),_:1},8,["model-value"]))}},At=G(Nt,[["__scopeId","data-v-bc6f07bd"]]);export{Ot as Q,At as T,Bt as a};
