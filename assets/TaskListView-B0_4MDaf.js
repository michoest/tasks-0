import{_ as ee,C as c,o,F as N,G as B,$ as K,E as p,l as S,c as V,w as u,h as f,J as $,k as q,t as x,S as ie,b as r,r as i,x as E,v as ce,y as de,B as ve,A as C,V as pe,a0 as fe,M as me,H as O,N as ke,O as ge,a1 as ye,a2 as _e,a3 as J,a4 as Z,D as we,a5 as he,a6 as j,p as Se,W as Ve}from"./index-NUA_boj3.js";import{u as $e}from"./spaces-C77L9DlZ.js";import{Q as xe,a as Te,T as Ce}from"./TaskActionSheet-CHasQZsg.js";const be={key:0,class:"task-list"},Ie=["onClick"],De=["onClick"],Fe={class:"task-content"},Ae={class:"task-title"},Me={key:0,class:"task-progress"},ze={class:"task-progress-bar"},Le={class:"task-progress-text"},Ne={key:1,class:"task-subtitle"},Be={key:0},Re={key:1,class:"mx-1"},Ue={key:2,class:"task-desc"},Pe={key:0,class:"task-category"},Ee={key:1,class:"empty-state"},qe={__name:"TaskListContent",props:{tasks:{type:Array,default:()=>[]},showCategory:{type:Boolean,default:!0}},emits:["task-click","task-complete"],setup(A){function y(n){const l=new Date,s=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`;return n===s}function F(n){if(!n)return"";const[l,s,b]=n.split("-").map(Number),_=new Date(l,s-1,b),d=new Date;d.setHours(0,0,0,0);const v=new Date(d);v.setDate(v.getDate()+1);const w=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`,I=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}-${String(v.getDate()).padStart(2,"0")}`;return n===w?"Heute":n===I?"Morgen":`${["So","Mo","Di","Mi","Do","Fr","Sa"][_.getDay()]}, ${_.getDate()}.${_.getMonth()+1}.`}function T(n,l){return n?n.length>l?n.substring(0,l)+"...":n:""}return(n,l)=>A.tasks.length>0?(o(),c("div",be,[(o(!0),c(N,null,B(A.tasks,s=>(o(),c("div",{key:s.id,class:K(["task-item",{"task-overdue":s.is_overdue,"task-completed":s.status==="completed"}]),onClick:b=>n.$emit("task-click",s)},[p("div",{class:"task-checkbox",onClick:q(b=>n.$emit("task-complete",s),["stop"])},[s.completing?(o(),V($,{key:0,color:"success"},{default:u(()=>[...l[0]||(l[0]=[f("mdi-check-circle",-1)])]),_:1})):(o(),V($,{key:1,color:"grey-lighten-1"},{default:u(()=>[...l[1]||(l[1]=[f("mdi-circle-outline",-1)])]),_:1}))],8,De),p("div",Fe,[p("div",Ae,x(s.title),1),s.progress!==null&&s.progress!==void 0?(o(),c("div",Me,[p("div",ze,[p("div",{class:"task-progress-fill",style:ie({width:`${s.progress*100}%`})},null,4)]),p("span",Le,x(Math.round(s.progress*100))+"%",1)])):S("",!0),s.next_due_date||s.description?(o(),c("div",Ne,[s.next_due_date?(o(),c("span",{key:0,class:K(["task-date",{"date-overdue":s.is_overdue,"date-today":y(s.next_due_date)}])},[f(x(F(s.next_due_date))+" ",1),s.has_specific_time?(o(),c("span",Be,", "+x(s.time_of_day),1)):S("",!0)],2)):S("",!0),s.next_due_date&&s.description?(o(),c("span",Re,"·")):S("",!0),s.description?(o(),c("span",Ue,x(T(s.description,40)),1)):S("",!0)])):S("",!0)]),s.category&&A.showCategory?(o(),c("div",Pe,[r($,{color:s.category.color,icon:s.category.icon||"mdi-tag",size:"16"},null,8,["color","icon"])])):S("",!0)],10,Ie))),128))])):(o(),c("div",Ee,[r($,{size:"64",color:"grey-lighten-2"},{default:u(()=>[...l[2]||(l[2]=[f("mdi-checkbox-marked-circle-outline",-1)])]),_:1}),l[3]||(l[3]=p("div",{class:"empty-title"},"Keine Aufgaben",-1)),l[4]||(l[4]=p("div",{class:"empty-subtitle"},"Keine Aufgaben in dieser Liste",-1))]))}},X=ee(qe,[["__scopeId","data-v-0c1be04f"]]),He={class:"list-header"},Qe={class:"header-row"},We={key:0,class:"text-center py-8"},Ye={__name:"TaskListView",setup(A){const y=$e(),F=i(!1),T=i([]),n=i([]),l=i(null),s=i(0),b=i(!1),_=i(!1),d=i(!1),v=i(null),w=i(null),I=i(""),H=i(null),M=i(null),m=i(!1),k=i(""),h=i("success"),R=E(()=>y.spaces.find(t=>t.id===l.value)),te=E(()=>{if(s.value===0)return null;const t=n.value[s.value-1];return(t==null?void 0:t.id)||null}),Q=E(()=>T.value.filter(t=>t.status==="active").sort((t,e)=>{if(t.is_overdue&&!e.is_overdue)return-1;if(!t.is_overdue&&e.is_overdue)return 1;if(t.next_due_date&&!e.next_due_date)return-1;if(!t.next_due_date&&e.next_due_date)return 1;if(t.next_due_date&&e.next_due_date){const a=t.next_due_date.localeCompare(e.next_due_date);if(a!==0)return a}return t.title.localeCompare(e.title)}));function U(t){return t===null?Q.value:Q.value.filter(e=>e.category_id===t)}function z(t){return U(t).length}function ae(t){l.value=t,s.value=0,localStorage.setItem("tasklist-space",t),localStorage.removeItem("tasklist-category"),D()}ce(s,t=>{if(t===0)localStorage.removeItem("tasklist-category");else{const e=n.value[t-1];e&&localStorage.setItem("tasklist-category",e.id)}});async function D(){if(l.value){F.value=!0;try{const[t,e]=await Promise.all([C.get(`/spaces/${l.value}/tasks`),C.get(`/spaces/${l.value}/categories`)]);T.value=t.tasks,n.value=e.categories}catch(t){console.error("Failed to load data:",t)}finally{F.value=!1}}}function W(){var t,e;I.value="",w.value=null,_.value=!0,(e=(t=M.value)==null?void 0:t.focusInputNow)==null||e.call(t)}function se(t){var e,a;I.value=t||"",w.value=null,_.value=!0,(a=(e=M.value)==null?void 0:e.focusInputNow)==null||a.call(e)}async function le(t){try{await C.post(`/spaces/${l.value}/tasks`,{title:t.title,task_type:"inbox"}),await D(),k.value="Zur Inbox hinzugefügt",h.value="success",m.value=!0}catch(e){console.error("Failed to add to inbox:",e),k.value="Fehler",h.value="error",m.value=!0}}async function oe(t){try{w.value?(await C.patch(`/spaces/${l.value}/tasks/${w.value.id}`,t),k.value="Aufgabe aktualisiert"):(await C.post(`/spaces/${l.value}/tasks`,t),k.value="Aufgabe erstellt"),await D(),h.value="success",m.value=!0}catch(e){console.error("Failed to save task:",e),k.value="Fehler beim Speichern",h.value="error",m.value=!0}}function Y(t){v.value=t,d.value=!0}async function P(t){try{const e=T.value.findIndex(a=>a.id===t.id);e!==-1&&(T.value[e]={...T.value[e],completing:!0}),await new Promise(a=>setTimeout(a,300)),await C.post(`/spaces/${l.value}/tasks/${t.id}/complete`,{}),await D(),k.value="Erledigt",h.value="success",m.value=!0}catch(e){console.error("Failed to complete task:",e),k.value="Fehler",h.value="error",m.value=!0}}async function ne(){await P(v.value),d.value=!1}function re(){var t,e;w.value=v.value,I.value="",d.value=!1,_.value=!0,(e=(t=M.value)==null?void 0:t.focusInputNow)==null||e.call(t)}async function ue(){if(confirm(`"${v.value.title}" löschen?`))try{await C.delete(`/spaces/${l.value}/tasks/${v.value.id}`),await D(),d.value=!1,k.value="Gelöscht",h.value="success",m.value=!0}catch(t){console.error("Failed to delete task:",t),k.value="Fehler beim Löschen",h.value="error",m.value=!0}}return de(async()=>{await y.fetchSpaces();const t=localStorage.getItem("tasklist-space"),e=localStorage.getItem("tasklist-category");if(t&&y.spaces.find(a=>a.id===parseInt(t))?l.value=parseInt(t):y.spaces.length>0&&(l.value=y.spaces[0].id),await D(),e){const a=parseInt(e),g=n.value.findIndex(L=>L.id===a);g!==-1&&(s.value=g+1)}}),(t,e)=>(o(),V(ve,{class:"bg-background"},{default:u(()=>[r(pe,{fluid:"",class:"pa-0"},{default:u(()=>[p("div",He,[p("div",Qe,[r(fe,null,{activator:u(({props:a})=>{var g,L,G;return[p("div",ye({class:"selector-chip"},a),[r($,{size:"18",color:((g=R.value)==null?void 0:g.personal_color)||"primary"},{default:u(()=>[...e[6]||(e[6]=[f("mdi-folder",-1)])]),_:1},8,["color"]),p("span",null,x(((L=R.value)==null?void 0:L.personal_name)||((G=R.value)==null?void 0:G.name)||"Space"),1),r($,{size:"16"},{default:u(()=>[...e[7]||(e[7]=[f("mdi-chevron-down",-1)])]),_:1})],16)]}),default:u(()=>[r(me,{density:"compact"},{default:u(()=>[(o(!0),c(N,null,B(O(y).spaces,a=>(o(),V(ke,{key:a.id,active:l.value===a.id,onClick:g=>ae(a.id)},{prepend:u(()=>[r($,{color:a.personal_color||"primary",size:"small"},{default:u(()=>[...e[8]||(e[8]=[f("mdi-folder",-1)])]),_:1},8,["color"])]),default:u(()=>[r(ge,null,{default:u(()=>[f(x(a.personal_name||a.name),1)]),_:2},1024)]),_:2},1032,["active","onClick"]))),128))]),_:1})]),_:1})]),r(_e,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),density:"default",class:"category-tabs"},{default:u(()=>[r(J,{value:0,class:"category-tab"},{default:u(()=>[r($,{size:"16",class:"mr-1"},{default:u(()=>[...e[9]||(e[9]=[f("mdi-tag-multiple",-1)])]),_:1}),e[10]||(e[10]=f(" Alle ",-1)),z(null)>0?(o(),V(Z,{key:0,content:z(null),color:"grey",inline:"",class:"ml-1"},null,8,["content"])):S("",!0)]),_:1}),(o(!0),c(N,null,B(n.value,(a,g)=>(o(),V(J,{key:a.id,value:g+1,class:"category-tab"},{default:u(()=>[r($,{size:"16",color:a.color,icon:a.icon||"mdi-tag",class:"mr-1"},null,8,["color","icon"]),f(" "+x(a.name)+" ",1),z(a.id)>0?(o(),V(Z,{key:0,content:z(a.id),color:a.color,inline:"",class:"ml-1"},null,8,["content","color"])):S("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),F.value?(o(),c("div",We,[r(we,{indeterminate:"",color:"primary"})])):(o(),V(he,{key:1,modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value=a),class:"task-window"},{default:u(()=>[r(j,{value:0},{default:u(()=>[r(X,{tasks:U(null),"show-category":!0,onTaskClick:Y,onTaskComplete:P},null,8,["tasks"])]),_:1}),(o(!0),c(N,null,B(n.value,(a,g)=>(o(),V(j,{key:a.id,value:g+1},{default:u(()=>[r(X,{tasks:U(a.id),"show-category":!1,onTaskClick:Y,onTaskComplete:P},null,8,["tasks"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])),r(Se,{icon:"mdi-plus",color:"primary",size:"large",position:"fixed",location:"bottom end",class:"mb-16 me-4",onPointerdown:q(W,["prevent"]),onTouchstart:q(W,["prevent"])})]),_:1}),r(xe,{ref_key:"quickAddRef",ref:H,modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=a=>b.value=a),"default-space-id":l.value,onAddInbox:le,onOpenFull:se},null,8,["modelValue","default-space-id"]),r(Te,{ref_key:"taskDialogRef",ref:M,modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=a=>_.value=a),task:w.value,categories:n.value,spaces:O(y).spaces,"default-space-id":l.value,"initial-title":I.value,"initial-category-id":w.value?null:te.value,onSave:oe},null,8,["modelValue","task","categories","spaces","default-space-id","initial-title","initial-category-id"]),r(Ce,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value=a),task:v.value,"show-space-name":!1,"show-history":!1,onComplete:ne,onEdit:re,onDelete:ue},null,8,["modelValue","task"]),r(Ve,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=a=>m.value=a),timeout:2e3,color:h.value,location:"top"},{default:u(()=>[f(x(k.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}},Je=ee(Ye,[["__scopeId","data-v-737fad0e"]]);export{Je as default};
