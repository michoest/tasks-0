import{_ as ee,C as c,o,F as L,G as N,$ as G,E as p,l as w,c as h,w as r,h as f,J as S,k as q,t as V,S as ie,b as n,r as u,x as K,v as ue,y as ce,B as de,A as b,V as ve,a0 as pe,M as fe,H as O,N as me,O as ke,a1 as ge,a2 as _e,a3 as J,a4 as Z,D as ye,a5 as we,a6 as j,p as he,W as Se}from"./index-BKgBkFFC.js";import{u as Ve}from"./spaces-B2Er4Xgv.js";import{Q as $e,a as xe,T as Te}from"./TaskActionSheet-CahJmNDI.js";const Ce={key:0,class:"task-list"},be=["onClick"],Ie=["onClick"],De={class:"task-content"},Fe={class:"task-title"},Ae={key:0,class:"task-progress"},Me={class:"task-progress-bar"},ze={class:"task-progress-text"},Le={key:1,class:"task-subtitle"},Ne={key:0},Be={key:1,class:"mx-1"},Re={key:2,class:"task-desc"},Ue={key:0,class:"task-category"},Pe={key:1,class:"empty-state"},Ee={__name:"TaskListContent",props:{tasks:{type:Array,default:()=>[]},showCategory:{type:Boolean,default:!0}},emits:["task-click","task-complete"],setup(A){function _(i){const l=new Date,s=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`;return i===s}function D(i){if(!i)return"";const[l,s,T]=i.split("-").map(Number),$=new Date(l,s-1,T),d=new Date;d.setHours(0,0,0,0);const v=new Date(d);v.setDate(v.getDate()+1);const C=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`,F=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}-${String(v.getDate()).padStart(2,"0")}`;return i===C?"Heute":i===F?"Morgen":`${["So","Mo","Di","Mi","Do","Fr","Sa"][$.getDay()]}, ${$.getDate()}.${$.getMonth()+1}.`}function x(i,l){return i?i.length>l?i.substring(0,l)+"...":i:""}return(i,l)=>A.tasks.length>0?(o(),c("div",Ce,[(o(!0),c(L,null,N(A.tasks,s=>(o(),c("div",{key:s.id,class:G(["task-item",{"task-overdue":s.is_overdue,"task-completed":s.status==="completed"}]),onClick:T=>i.$emit("task-click",s)},[p("div",{class:"task-checkbox",onClick:q(T=>i.$emit("task-complete",s),["stop"])},[s.completing?(o(),h(S,{key:0,color:"success"},{default:r(()=>[...l[0]||(l[0]=[f("mdi-check-circle",-1)])]),_:1})):(o(),h(S,{key:1,color:"grey-lighten-1"},{default:r(()=>[...l[1]||(l[1]=[f("mdi-circle-outline",-1)])]),_:1}))],8,Ie),p("div",De,[p("div",Fe,V(s.title),1),s.progress!==null&&s.progress!==void 0?(o(),c("div",Ae,[p("div",Me,[p("div",{class:"task-progress-fill",style:ie({width:`${s.progress*100}%`})},null,4)]),p("span",ze,V(Math.round(s.progress*100))+"%",1)])):w("",!0),s.next_due_date||s.description?(o(),c("div",Le,[s.next_due_date?(o(),c("span",{key:0,class:G(["task-date",{"date-overdue":s.is_overdue,"date-today":_(s.next_due_date)}])},[f(V(D(s.next_due_date))+" ",1),s.has_specific_time?(o(),c("span",Ne,", "+V(s.time_of_day),1)):w("",!0)],2)):w("",!0),s.next_due_date&&s.description?(o(),c("span",Be,"·")):w("",!0),s.description?(o(),c("span",Re,V(x(s.description,40)),1)):w("",!0)])):w("",!0)]),s.category&&A.showCategory?(o(),c("div",Ue,[n(S,{color:s.category.color,icon:s.category.icon||"mdi-tag",size:"16"},null,8,["color","icon"])])):w("",!0)],10,be))),128))])):(o(),c("div",Pe,[n(S,{size:"64",color:"grey-lighten-2"},{default:r(()=>[...l[2]||(l[2]=[f("mdi-checkbox-marked-circle-outline",-1)])]),_:1}),l[3]||(l[3]=p("div",{class:"empty-title"},"Keine Aufgaben",-1)),l[4]||(l[4]=p("div",{class:"empty-subtitle"},"Keine Aufgaben in dieser Liste",-1))]))}},X=ee(Ee,[["__scopeId","data-v-fa4f4756"]]),qe={class:"list-header"},He={class:"header-row"},Qe={key:0,class:"text-center py-8"},We={__name:"TaskListView",setup(A){const _=Ve(),D=u(!1),x=u([]),i=u([]),l=u(null),s=u(0),T=u(!1),$=u(!1),d=u(!1),v=u(null),C=u(null),F=u(""),B=u(null),R=u(null),m=u(!1),k=u(""),y=u("success"),U=K(()=>_.spaces.find(t=>t.id===l.value)),H=K(()=>x.value.filter(t=>t.status==="active").sort((t,e)=>{if(t.is_overdue&&!e.is_overdue)return-1;if(!t.is_overdue&&e.is_overdue)return 1;if(t.next_due_date&&!e.next_due_date)return-1;if(!t.next_due_date&&e.next_due_date)return 1;if(t.next_due_date&&e.next_due_date){const a=t.next_due_date.localeCompare(e.next_due_date);if(a!==0)return a}return t.title.localeCompare(e.title)}));function P(t){return t===null?H.value:H.value.filter(e=>e.category_id===t)}function M(t){return P(t).length}function te(t){l.value=t,s.value=0,localStorage.setItem("tasklist-space",t),localStorage.removeItem("tasklist-category"),I()}ue(s,t=>{if(t===0)localStorage.removeItem("tasklist-category");else{const e=i.value[t-1];e&&localStorage.setItem("tasklist-category",e.id)}});async function I(){if(l.value){D.value=!0;try{const[t,e]=await Promise.all([b.get(`/spaces/${l.value}/tasks`),b.get(`/spaces/${l.value}/categories`)]);x.value=t.tasks,i.value=e.categories}catch(t){console.error("Failed to load data:",t)}finally{D.value=!1}}}function Q(){var t,e;T.value=!0,(e=(t=B.value)==null?void 0:t.focusInputNow)==null||e.call(t)}function ae(t){var e,a;F.value=t||"",C.value=null,$.value=!0,(a=(e=R.value)==null?void 0:e.focusInputNow)==null||a.call(e)}async function se(t){try{await b.post(`/spaces/${l.value}/tasks`,{title:t.title,task_type:"inbox"}),await I(),k.value="Zur Inbox hinzugefügt",y.value="success",m.value=!0}catch(e){console.error("Failed to add to inbox:",e),k.value="Fehler",y.value="error",m.value=!0}}async function le(t){try{C.value?(await b.patch(`/spaces/${l.value}/tasks/${C.value.id}`,t),k.value="Aufgabe aktualisiert"):(await b.post(`/spaces/${l.value}/tasks`,t),k.value="Aufgabe erstellt"),await I(),y.value="success",m.value=!0}catch(e){console.error("Failed to save task:",e),k.value="Fehler beim Speichern",y.value="error",m.value=!0}}function W(t){v.value=t,d.value=!0}async function E(t){try{const e=x.value.findIndex(a=>a.id===t.id);e!==-1&&(x.value[e]={...x.value[e],completing:!0}),await new Promise(a=>setTimeout(a,300)),await b.post(`/spaces/${l.value}/tasks/${t.id}/complete`,{}),await I(),k.value="Erledigt",y.value="success",m.value=!0}catch(e){console.error("Failed to complete task:",e),k.value="Fehler",y.value="error",m.value=!0}}async function oe(){await E(v.value),d.value=!1}function ne(){var t,e;C.value=v.value,F.value="",d.value=!1,$.value=!0,(e=(t=R.value)==null?void 0:t.focusInputNow)==null||e.call(t)}async function re(){if(confirm(`"${v.value.title}" löschen?`))try{await b.delete(`/spaces/${l.value}/tasks/${v.value.id}`),await I(),d.value=!1,k.value="Gelöscht",y.value="success",m.value=!0}catch(t){console.error("Failed to delete task:",t),k.value="Fehler beim Löschen",y.value="error",m.value=!0}}return ce(async()=>{await _.fetchSpaces();const t=localStorage.getItem("tasklist-space"),e=localStorage.getItem("tasklist-category");if(t&&_.spaces.find(a=>a.id===parseInt(t))?l.value=parseInt(t):_.spaces.length>0&&(l.value=_.spaces[0].id),await I(),e){const a=parseInt(e),g=i.value.findIndex(z=>z.id===a);g!==-1&&(s.value=g+1)}}),(t,e)=>(o(),h(de,{class:"bg-background"},{default:r(()=>[n(ve,{fluid:"",class:"pa-0"},{default:r(()=>[p("div",qe,[p("div",He,[n(pe,null,{activator:r(({props:a})=>{var g,z,Y;return[p("div",ge({class:"selector-chip"},a),[n(S,{size:"18",color:((g=U.value)==null?void 0:g.personal_color)||"primary"},{default:r(()=>[...e[6]||(e[6]=[f("mdi-folder",-1)])]),_:1},8,["color"]),p("span",null,V(((z=U.value)==null?void 0:z.personal_name)||((Y=U.value)==null?void 0:Y.name)||"Space"),1),n(S,{size:"16"},{default:r(()=>[...e[7]||(e[7]=[f("mdi-chevron-down",-1)])]),_:1})],16)]}),default:r(()=>[n(fe,{density:"compact"},{default:r(()=>[(o(!0),c(L,null,N(O(_).spaces,a=>(o(),h(me,{key:a.id,active:l.value===a.id,onClick:g=>te(a.id)},{prepend:r(()=>[n(S,{color:a.personal_color||"primary",size:"small"},{default:r(()=>[...e[8]||(e[8]=[f("mdi-folder",-1)])]),_:1},8,["color"])]),default:r(()=>[n(ke,null,{default:r(()=>[f(V(a.personal_name||a.name),1)]),_:2},1024)]),_:2},1032,["active","onClick"]))),128))]),_:1})]),_:1})]),n(_e,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),density:"default",class:"category-tabs"},{default:r(()=>[n(J,{value:0,class:"category-tab"},{default:r(()=>[n(S,{size:"16",class:"mr-1"},{default:r(()=>[...e[9]||(e[9]=[f("mdi-tag-multiple",-1)])]),_:1}),e[10]||(e[10]=f(" Alle ",-1)),M(null)>0?(o(),h(Z,{key:0,content:M(null),color:"grey",inline:"",class:"ml-1"},null,8,["content"])):w("",!0)]),_:1}),(o(!0),c(L,null,N(i.value,(a,g)=>(o(),h(J,{key:a.id,value:g+1,class:"category-tab"},{default:r(()=>[n(S,{size:"16",color:a.color,icon:a.icon||"mdi-tag",class:"mr-1"},null,8,["color","icon"]),f(" "+V(a.name)+" ",1),M(a.id)>0?(o(),h(Z,{key:0,content:M(a.id),color:a.color,inline:"",class:"ml-1"},null,8,["content","color"])):w("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),D.value?(o(),c("div",Qe,[n(ye,{indeterminate:"",color:"primary"})])):(o(),h(we,{key:1,modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value=a),class:"task-window"},{default:r(()=>[n(j,{value:0},{default:r(()=>[n(X,{tasks:P(null),"show-category":!0,onTaskClick:W,onTaskComplete:E},null,8,["tasks"])]),_:1}),(o(!0),c(L,null,N(i.value,(a,g)=>(o(),h(j,{key:a.id,value:g+1},{default:r(()=>[n(X,{tasks:P(a.id),"show-category":!1,onTaskClick:W,onTaskComplete:E},null,8,["tasks"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])),n(he,{icon:"mdi-plus",color:"primary",size:"large",position:"fixed",location:"bottom end",class:"mb-16 me-4",onPointerdown:q(Q,["prevent"]),onTouchstart:q(Q,["prevent"])})]),_:1}),n($e,{ref_key:"quickAddRef",ref:B,modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=a=>T.value=a),"default-space-id":l.value,onAddInbox:se,onOpenFull:ae},null,8,["modelValue","default-space-id"]),n(xe,{ref_key:"taskDialogRef",ref:R,modelValue:$.value,"onUpdate:modelValue":e[3]||(e[3]=a=>$.value=a),task:C.value,categories:i.value,spaces:O(_).spaces,"default-space-id":l.value,"initial-title":F.value,onSave:le},null,8,["modelValue","task","categories","spaces","default-space-id","initial-title"]),n(Te,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value=a),task:v.value,"show-space-name":!1,"show-history":!1,onComplete:oe,onEdit:ne,onDelete:re},null,8,["modelValue","task"]),n(Se,{modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=a=>m.value=a),timeout:2e3,color:y.value,location:"top"},{default:r(()=>[f(V(k.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}},Oe=ee(We,[["__scopeId","data-v-e9967b27"]]);export{Oe as default};
