import{u as oe}from"./spaces-Bq9USoTJ.js";import{_ as J,C as u,o,F as L,G as B,$ as W,E as p,l as S,c as h,w as r,h as m,J as w,k as ne,t as V,S as re,b as n,r as c,x as Y,v as ie,y as ue,B as ce,A as b,V as de,a0 as ve,M as pe,H as G,N as me,O as fe,a1 as ke,a2 as ge,a3 as K,a4 as O,D as _e,a5 as ye,a6 as R,p as Se,W as he}from"./index-DPaTiaMt.js";import{Q as we,a as Ve,T as $e}from"./TaskActionSheet-522X_tmO.js";const xe={key:0,class:"task-list"},Te=["onClick"],Ce=["onClick"],be={class:"task-content"},De={class:"task-title"},Ie={key:0,class:"task-progress"},Fe={class:"task-progress-bar"},Me={class:"task-progress-text"},Ae={key:1,class:"task-subtitle"},ze={key:0},Le={key:1,class:"mx-1"},Be={key:2,class:"task-desc"},Ne={key:0,class:"task-category"},Ue={key:1,class:"empty-state"},Ee={__name:"TaskListContent",props:{tasks:{type:Array,default:()=>[]},showCategory:{type:Boolean,default:!0}},emits:["task-click","task-complete"],setup(M){function _(i){const l=new Date,s=`${l.getFullYear()}-${String(l.getMonth()+1).padStart(2,"0")}-${String(l.getDate()).padStart(2,"0")}`;return i===s}function I(i){if(!i)return"";const[l,s,T]=i.split("-").map(Number),$=new Date(l,s-1,T),d=new Date;d.setHours(0,0,0,0);const v=new Date(d);v.setDate(v.getDate()+1);const C=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`,F=`${v.getFullYear()}-${String(v.getMonth()+1).padStart(2,"0")}-${String(v.getDate()).padStart(2,"0")}`;return i===C?"Heute":i===F?"Morgen":`${["So","Mo","Di","Mi","Do","Fr","Sa"][$.getDay()]}, ${$.getDate()}.${$.getMonth()+1}.`}function x(i,l){return i?i.length>l?i.substring(0,l)+"...":i:""}return(i,l)=>M.tasks.length>0?(o(),u("div",xe,[(o(!0),u(L,null,B(M.tasks,s=>(o(),u("div",{key:s.id,class:W(["task-item",{"task-overdue":s.is_overdue,"task-completed":s.status==="completed"}]),onClick:T=>i.$emit("task-click",s)},[p("div",{class:"task-checkbox",onClick:ne(T=>i.$emit("task-complete",s),["stop"])},[s.completing?(o(),h(w,{key:0,color:"success"},{default:r(()=>[...l[0]||(l[0]=[m("mdi-check-circle",-1)])]),_:1})):(o(),h(w,{key:1,color:"grey-lighten-1"},{default:r(()=>[...l[1]||(l[1]=[m("mdi-circle-outline",-1)])]),_:1}))],8,Ce),p("div",be,[p("div",De,V(s.title),1),s.progress!==null&&s.progress!==void 0?(o(),u("div",Ie,[p("div",Fe,[p("div",{class:"task-progress-fill",style:re({width:`${s.progress*100}%`})},null,4)]),p("span",Me,V(Math.round(s.progress*100))+"%",1)])):S("",!0),s.next_due_date||s.description?(o(),u("div",Ae,[s.next_due_date?(o(),u("span",{key:0,class:W(["task-date",{"date-overdue":s.is_overdue,"date-today":_(s.next_due_date)}])},[m(V(I(s.next_due_date))+" ",1),s.has_specific_time?(o(),u("span",ze,", "+V(s.time_of_day),1)):S("",!0)],2)):S("",!0),s.next_due_date&&s.description?(o(),u("span",Le,"·")):S("",!0),s.description?(o(),u("span",Be,V(x(s.description,40)),1)):S("",!0)])):S("",!0)]),s.category&&M.showCategory?(o(),u("div",Ne,[n(w,{color:s.category.color,icon:s.category.icon||"mdi-tag",size:"16"},null,8,["color","icon"])])):S("",!0)],10,Te))),128))])):(o(),u("div",Ue,[n(w,{size:"64",color:"grey-lighten-2"},{default:r(()=>[...l[2]||(l[2]=[m("mdi-checkbox-marked-circle-outline",-1)])]),_:1}),l[3]||(l[3]=p("div",{class:"empty-title"},"Keine Aufgaben",-1)),l[4]||(l[4]=p("div",{class:"empty-subtitle"},"Keine Aufgaben in dieser Liste",-1))]))}},q=J(Ee,[["__scopeId","data-v-fa4f4756"]]),Pe={class:"list-header"},He={class:"header-row"},Qe={key:0,class:"text-center py-8"},We={__name:"TaskListView",setup(M){const _=oe(),I=c(!1),x=c([]),i=c([]),l=c(null),s=c(0),T=c(!1),$=c(!1),d=c(!1),v=c(null),C=c(null),F=c(""),f=c(!1),k=c(""),y=c("success"),N=Y(()=>_.spaces.find(t=>t.id===l.value)),P=Y(()=>x.value.filter(t=>t.status==="active").sort((t,e)=>{if(t.is_overdue&&!e.is_overdue)return-1;if(!t.is_overdue&&e.is_overdue)return 1;if(t.next_due_date&&!e.next_due_date)return-1;if(!t.next_due_date&&e.next_due_date)return 1;if(t.next_due_date&&e.next_due_date){const a=t.next_due_date.localeCompare(e.next_due_date);if(a!==0)return a}return t.title.localeCompare(e.title)}));function U(t){return t===null?P.value:P.value.filter(e=>e.category_id===t)}function A(t){return U(t).length}function Z(t){l.value=t,s.value=0,localStorage.setItem("tasklist-space",t),localStorage.removeItem("tasklist-category"),D()}ie(s,t=>{if(t===0)localStorage.removeItem("tasklist-category");else{const e=i.value[t-1];e&&localStorage.setItem("tasklist-category",e.id)}});async function D(){if(l.value){I.value=!0;try{const[t,e]=await Promise.all([b.get(`/spaces/${l.value}/tasks`),b.get(`/spaces/${l.value}/categories`)]);x.value=t.tasks,i.value=e.categories}catch(t){console.error("Failed to load data:",t)}finally{I.value=!1}}}function j(){T.value=!0}function X(t){F.value=t||"",C.value=null,$.value=!0}async function ee(t){try{await b.post(`/spaces/${l.value}/tasks`,{title:t.title,task_type:"inbox"}),await D(),k.value="Zur Inbox hinzugefügt",y.value="success",f.value=!0}catch(e){console.error("Failed to add to inbox:",e),k.value="Fehler",y.value="error",f.value=!0}}async function te(t){try{C.value?(await b.patch(`/spaces/${l.value}/tasks/${C.value.id}`,t),k.value="Aufgabe aktualisiert"):(await b.post(`/spaces/${l.value}/tasks`,t),k.value="Aufgabe erstellt"),await D(),y.value="success",f.value=!0}catch(e){console.error("Failed to save task:",e),k.value="Fehler beim Speichern",y.value="error",f.value=!0}}function H(t){v.value=t,d.value=!0}async function E(t){try{const e=x.value.findIndex(a=>a.id===t.id);e!==-1&&(x.value[e]={...x.value[e],completing:!0}),await new Promise(a=>setTimeout(a,300)),await b.post(`/spaces/${l.value}/tasks/${t.id}/complete`,{}),await D(),k.value="Erledigt",y.value="success",f.value=!0}catch(e){console.error("Failed to complete task:",e),k.value="Fehler",y.value="error",f.value=!0}}async function ae(){await E(v.value),d.value=!1}function se(){C.value=v.value,F.value="",d.value=!1,$.value=!0}async function le(){if(confirm(`"${v.value.title}" löschen?`))try{await b.delete(`/spaces/${l.value}/tasks/${v.value.id}`),await D(),d.value=!1,k.value="Gelöscht",y.value="success",f.value=!0}catch(t){console.error("Failed to delete task:",t),k.value="Fehler beim Löschen",y.value="error",f.value=!0}}return ue(async()=>{await _.fetchSpaces();const t=localStorage.getItem("tasklist-space"),e=localStorage.getItem("tasklist-category");if(t&&_.spaces.find(a=>a.id===parseInt(t))?l.value=parseInt(t):_.spaces.length>0&&(l.value=_.spaces[0].id),await D(),e){const a=parseInt(e),g=i.value.findIndex(z=>z.id===a);g!==-1&&(s.value=g+1)}}),(t,e)=>(o(),h(ce,{class:"bg-background"},{default:r(()=>[n(de,{fluid:"",class:"pa-0"},{default:r(()=>[p("div",Pe,[p("div",He,[n(ve,null,{activator:r(({props:a})=>{var g,z,Q;return[p("div",ke({class:"selector-chip"},a),[n(w,{size:"18",color:((g=N.value)==null?void 0:g.personal_color)||"primary"},{default:r(()=>[...e[6]||(e[6]=[m("mdi-folder",-1)])]),_:1},8,["color"]),p("span",null,V(((z=N.value)==null?void 0:z.personal_name)||((Q=N.value)==null?void 0:Q.name)||"Space"),1),n(w,{size:"16"},{default:r(()=>[...e[7]||(e[7]=[m("mdi-chevron-down",-1)])]),_:1})],16)]}),default:r(()=>[n(pe,{density:"compact"},{default:r(()=>[(o(!0),u(L,null,B(G(_).spaces,a=>(o(),h(me,{key:a.id,active:l.value===a.id,onClick:g=>Z(a.id)},{prepend:r(()=>[n(w,{color:a.personal_color||"primary",size:"small"},{default:r(()=>[...e[8]||(e[8]=[m("mdi-folder",-1)])]),_:1},8,["color"])]),default:r(()=>[n(fe,null,{default:r(()=>[m(V(a.personal_name||a.name),1)]),_:2},1024)]),_:2},1032,["active","onClick"]))),128))]),_:1})]),_:1})]),n(ge,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),density:"default",class:"category-tabs"},{default:r(()=>[n(K,{value:0,class:"category-tab"},{default:r(()=>[n(w,{size:"16",class:"mr-1"},{default:r(()=>[...e[9]||(e[9]=[m("mdi-tag-multiple",-1)])]),_:1}),e[10]||(e[10]=m(" Alle ",-1)),A(null)>0?(o(),h(O,{key:0,content:A(null),color:"grey",inline:"",class:"ml-1"},null,8,["content"])):S("",!0)]),_:1}),(o(!0),u(L,null,B(i.value,(a,g)=>(o(),h(K,{key:a.id,value:g+1,class:"category-tab"},{default:r(()=>[n(w,{size:"16",color:a.color,icon:a.icon||"mdi-tag",class:"mr-1"},null,8,["color","icon"]),m(" "+V(a.name)+" ",1),A(a.id)>0?(o(),h(O,{key:0,content:A(a.id),color:a.color,inline:"",class:"ml-1"},null,8,["content","color"])):S("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),I.value?(o(),u("div",Qe,[n(_e,{indeterminate:"",color:"primary"})])):(o(),h(ye,{key:1,modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value=a),class:"task-window"},{default:r(()=>[n(R,{value:0},{default:r(()=>[n(q,{tasks:U(null),"show-category":!0,onTaskClick:H,onTaskComplete:E},null,8,["tasks"])]),_:1}),(o(!0),u(L,null,B(i.value,(a,g)=>(o(),h(R,{key:a.id,value:g+1},{default:r(()=>[n(q,{tasks:U(a.id),"show-category":!1,onTaskClick:H,onTaskComplete:E},null,8,["tasks"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])),n(Se,{icon:"mdi-plus",color:"primary",size:"large",position:"fixed",location:"bottom end",class:"mb-16 me-4",onClick:j})]),_:1}),n(we,{modelValue:T.value,"onUpdate:modelValue":e[2]||(e[2]=a=>T.value=a),"default-space-id":l.value,onAddInbox:ee,onOpenFull:X},null,8,["modelValue","default-space-id"]),n(Ve,{modelValue:$.value,"onUpdate:modelValue":e[3]||(e[3]=a=>$.value=a),task:C.value,categories:i.value,spaces:G(_).spaces,"default-space-id":l.value,"initial-title":F.value,onSave:te},null,8,["modelValue","task","categories","spaces","default-space-id","initial-title"]),n($e,{modelValue:d.value,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value=a),task:v.value,"show-space-name":!1,"show-history":!1,onComplete:ae,onEdit:se,onDelete:le},null,8,["modelValue","task"]),n(he,{modelValue:f.value,"onUpdate:modelValue":e[5]||(e[5]=a=>f.value=a),timeout:2e3,color:y.value,location:"top"},{default:r(()=>[m(V(k.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}},Oe=J(We,[["__scopeId","data-v-3d91187e"]]);export{Oe as default};
