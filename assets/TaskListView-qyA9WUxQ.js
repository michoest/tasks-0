import{u as oe}from"./spaces-DBzeKANc.js";import{_ as X,C as u,o,F as L,G as M,a0 as Q,E as d,l as y,c as w,w as i,h as v,J as V,k as ne,t as h,T as ie,b as n,r as c,x as G,v as re,y as ue,B as ce,A as C,V as de,a1 as ve,N as pe,H,O as me,P as fe,a2 as ke,a3 as ge,a4 as R,K as W,D as _e,a5 as ye,a6 as q,p as we,X as Ve}from"./index-YNptfV--.js";import{Q as he,a as Te,T as xe}from"./TaskActionSheet-Yv6_h5OD.js";const Se={key:0,class:"task-list"},Ce=["onClick"],be=["onClick"],Ie={class:"task-content"},$e={class:"task-title"},De={key:0,class:"task-progress"},Fe={class:"task-progress-bar"},Ae={class:"task-progress-text"},ze={key:1,class:"task-subtitle"},Le={key:0},Me={key:1,class:"mx-1"},Be={key:2,class:"task-desc"},Ue={key:0,class:"task-category"},Ne={key:1,class:"empty-state"},Oe={__name:"TaskListContent",props:{tasks:{type:Array,default:()=>[]},showCategory:{type:Boolean,default:!0}},emits:["task-click","task-complete"],setup(F){function k(r){return r===new Date().toISOString().split("T")[0]}function $(r){if(!r)return"";const l=new Date(r),s=new Date,g=new Date(s);g.setDate(g.getDate()+1);const b=s.toISOString().split("T")[0],T=g.toISOString().split("T")[0];return r===b?"Heute":r===T?"Morgen":`${["So","Mo","Di","Mi","Do","Fr","Sa"][l.getDay()]}, ${l.getDate()}.${l.getMonth()+1}.`}function x(r,l){return r?r.length>l?r.substring(0,l)+"...":r:""}return(r,l)=>F.tasks.length>0?(o(),u("div",Se,[(o(!0),u(L,null,M(F.tasks,s=>(o(),u("div",{key:s.id,class:Q(["task-item",{"task-overdue":s.is_overdue,"task-completed":s.status==="completed"}]),onClick:g=>r.$emit("task-click",s)},[d("div",{class:"task-checkbox",onClick:ne(g=>r.$emit("task-complete",s),["stop"])},[s.completing?(o(),w(V,{key:0,color:"success"},{default:i(()=>[...l[0]||(l[0]=[v("mdi-check-circle",-1)])]),_:1})):(o(),w(V,{key:1,color:"grey-lighten-1"},{default:i(()=>[...l[1]||(l[1]=[v("mdi-circle-outline",-1)])]),_:1}))],8,be),d("div",Ie,[d("div",$e,h(s.title),1),s.progress!==null&&s.progress!==void 0?(o(),u("div",De,[d("div",Fe,[d("div",{class:"task-progress-fill",style:ie({width:`${s.progress*100}%`})},null,4)]),d("span",Ae,h(Math.round(s.progress*100))+"%",1)])):y("",!0),s.next_due_date||s.description?(o(),u("div",ze,[s.next_due_date?(o(),u("span",{key:0,class:Q(["task-date",{"date-overdue":s.is_overdue,"date-today":k(s.next_due_date)}])},[v(h($(s.next_due_date))+" ",1),s.has_specific_time?(o(),u("span",Le,", "+h(s.time_of_day),1)):y("",!0)],2)):y("",!0),s.next_due_date&&s.description?(o(),u("span",Me,"·")):y("",!0),s.description?(o(),u("span",Be,h(x(s.description,40)),1)):y("",!0)])):y("",!0)]),s.category&&F.showCategory?(o(),u("div",Ue,[n(V,{color:s.category.color,icon:s.category.icon||"mdi-tag",size:"16"},null,8,["color","icon"])])):y("",!0)],10,Ce))),128))])):(o(),u("div",Ne,[n(V,{size:"64",color:"grey-lighten-2"},{default:i(()=>[...l[2]||(l[2]=[v("mdi-checkbox-marked-circle-outline",-1)])]),_:1}),l[3]||(l[3]=d("div",{class:"empty-title"},"Keine Aufgaben",-1)),l[4]||(l[4]=d("div",{class:"empty-subtitle"},"Keine Aufgaben in dieser Liste",-1))]))}},J=X(Oe,[["__scopeId","data-v-82056ea7"]]),Pe={class:"list-header"},Ee={class:"header-row"},Ke={key:0,class:"text-center py-8"},Qe={__name:"TaskListView",setup(F){const k=oe(),$=c(!1),x=c([]),r=c([]),l=c(null),s=c(0),g=c(!1),b=c(!1),T=c(!1),S=c(null),D=c(null),B=c(""),p=c(!1),m=c(""),_=c("success"),U=G(()=>k.spaces.find(t=>t.id===l.value)),P=G(()=>x.value.filter(t=>t.status==="active").sort((t,e)=>{if(t.is_overdue&&!e.is_overdue)return-1;if(!t.is_overdue&&e.is_overdue)return 1;if(t.next_due_date&&!e.next_due_date)return-1;if(!t.next_due_date&&e.next_due_date)return 1;if(t.next_due_date&&e.next_due_date){const a=t.next_due_date.localeCompare(e.next_due_date);if(a!==0)return a}return t.title.localeCompare(e.title)}));function N(t){return t===null?P.value:P.value.filter(e=>e.category_id===t)}function A(t){return N(t).length}function Z(t){l.value=t,s.value=0,localStorage.setItem("tasklist-space",t),localStorage.removeItem("tasklist-category"),I()}re(s,t=>{if(t===0)localStorage.removeItem("tasklist-category");else{const e=r.value[t-1];e&&localStorage.setItem("tasklist-category",e.id)}});async function I(){if(l.value){$.value=!0;try{const[t,e]=await Promise.all([C.get(`/spaces/${l.value}/tasks`),C.get(`/spaces/${l.value}/categories`)]);x.value=t.tasks,r.value=e.categories}catch(t){console.error("Failed to load data:",t)}finally{$.value=!1}}}function j(){g.value=!0}function Y(t){B.value=t||"",D.value=null,b.value=!0}async function ee(t){try{await C.post(`/spaces/${l.value}/tasks`,{title:t.title,task_type:"inbox"}),await I(),m.value="Zur Inbox hinzugefügt",_.value="success",p.value=!0}catch(e){console.error("Failed to add to inbox:",e),m.value="Fehler",_.value="error",p.value=!0}}async function te(t){try{D.value?(await C.patch(`/spaces/${l.value}/tasks/${D.value.id}`,t),m.value="Aufgabe aktualisiert"):(await C.post(`/spaces/${l.value}/tasks`,t),m.value="Aufgabe erstellt"),await I(),_.value="success",p.value=!0}catch(e){console.error("Failed to save task:",e),m.value="Fehler beim Speichern",_.value="error",p.value=!0}}function E(t){S.value=t,T.value=!0}async function O(t){try{const e=x.value.findIndex(a=>a.id===t.id);e!==-1&&(x.value[e]={...x.value[e],completing:!0}),await new Promise(a=>setTimeout(a,300)),await C.post(`/spaces/${l.value}/tasks/${t.id}/complete`,{}),await I(),m.value="Erledigt",_.value="success",p.value=!0}catch(e){console.error("Failed to complete task:",e),m.value="Fehler",_.value="error",p.value=!0}}async function ae(){await O(S.value),T.value=!1}function se(){D.value=S.value,B.value="",T.value=!1,b.value=!0}async function le(){if(confirm(`"${S.value.title}" löschen?`))try{await C.delete(`/spaces/${l.value}/tasks/${S.value.id}`),await I(),T.value=!1,m.value="Gelöscht",_.value="success",p.value=!0}catch(t){console.error("Failed to delete task:",t),m.value="Fehler beim Löschen",_.value="error",p.value=!0}}return ue(async()=>{await k.fetchSpaces();const t=localStorage.getItem("tasklist-space"),e=localStorage.getItem("tasklist-category");if(t&&k.spaces.find(a=>a.id===parseInt(t))?l.value=parseInt(t):k.spaces.length>0&&(l.value=k.spaces[0].id),await I(),e){const a=parseInt(e),f=r.value.findIndex(z=>z.id===a);f!==-1&&(s.value=f+1)}}),(t,e)=>(o(),w(ce,{class:"bg-background"},{default:i(()=>[n(de,{fluid:"",class:"pa-0"},{default:i(()=>[d("div",Pe,[d("div",Ee,[n(ve,null,{activator:i(({props:a})=>{var f,z,K;return[d("div",ke({class:"selector-chip"},a),[n(V,{size:"18",color:((f=U.value)==null?void 0:f.personal_color)||"primary"},{default:i(()=>[...e[6]||(e[6]=[v("mdi-folder",-1)])]),_:1},8,["color"]),d("span",null,h(((z=U.value)==null?void 0:z.personal_name)||((K=U.value)==null?void 0:K.name)||"Space"),1),n(V,{size:"16"},{default:i(()=>[...e[7]||(e[7]=[v("mdi-chevron-down",-1)])]),_:1})],16)]}),default:i(()=>[n(pe,{density:"compact"},{default:i(()=>[(o(!0),u(L,null,M(H(k).spaces,a=>(o(),w(me,{key:a.id,active:l.value===a.id,onClick:f=>Z(a.id)},{prepend:i(()=>[n(V,{color:a.personal_color||"primary",size:"small"},{default:i(()=>[...e[8]||(e[8]=[v("mdi-folder",-1)])]),_:1},8,["color"])]),default:i(()=>[n(fe,null,{default:i(()=>[v(h(a.personal_name||a.name),1)]),_:2},1024)]),_:2},1032,["active","onClick"]))),128))]),_:1})]),_:1})]),n(ge,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),density:"default",class:"category-tabs"},{default:i(()=>[n(R,{value:0,class:"category-tab"},{default:i(()=>[n(V,{size:"16",class:"mr-1"},{default:i(()=>[...e[9]||(e[9]=[v("mdi-tag-multiple",-1)])]),_:1}),e[10]||(e[10]=v(" Alle ",-1)),A(null)>0?(o(),w(W,{key:0,content:A(null),color:"grey",inline:"",class:"ml-1"},null,8,["content"])):y("",!0)]),_:1}),(o(!0),u(L,null,M(r.value,(a,f)=>(o(),w(R,{key:a.id,value:f+1,class:"category-tab"},{default:i(()=>[n(V,{size:"16",color:a.color,icon:a.icon||"mdi-tag",class:"mr-1"},null,8,["color","icon"]),v(" "+h(a.name)+" ",1),A(a.id)>0?(o(),w(W,{key:0,content:A(a.id),color:a.color,inline:"",class:"ml-1"},null,8,["content","color"])):y("",!0)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),$.value?(o(),u("div",Ke,[n(_e,{indeterminate:"",color:"primary"})])):(o(),w(ye,{key:1,modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value=a),class:"task-window"},{default:i(()=>[n(q,{value:0},{default:i(()=>[n(J,{tasks:N(null),"show-category":!0,onTaskClick:E,onTaskComplete:O},null,8,["tasks"])]),_:1}),(o(!0),u(L,null,M(r.value,(a,f)=>(o(),w(q,{key:a.id,value:f+1},{default:i(()=>[n(J,{tasks:N(a.id),"show-category":!1,onTaskClick:E,onTaskComplete:O},null,8,["tasks"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])),n(we,{icon:"mdi-plus",color:"primary",size:"large",position:"fixed",location:"bottom end",class:"mb-16 me-4",onClick:j})]),_:1}),n(he,{modelValue:g.value,"onUpdate:modelValue":e[2]||(e[2]=a=>g.value=a),"default-space-id":l.value,onAddInbox:ee,onOpenFull:Y},null,8,["modelValue","default-space-id"]),n(Te,{modelValue:b.value,"onUpdate:modelValue":e[3]||(e[3]=a=>b.value=a),task:D.value,categories:r.value,spaces:H(k).spaces,"default-space-id":l.value,"initial-title":B.value,onSave:te},null,8,["modelValue","task","categories","spaces","default-space-id","initial-title"]),n(xe,{modelValue:T.value,"onUpdate:modelValue":e[4]||(e[4]=a=>T.value=a),task:S.value,"show-space-name":!1,"show-history":!1,onComplete:ae,onEdit:se,onDelete:le},null,8,["modelValue","task"]),n(Ve,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=a=>p.value=a),timeout:2e3,color:_.value,location:"top"},{default:i(()=>[v(h(m.value),1)]),_:1},8,["modelValue","color"])]),_:1}))}},We=X(Qe,[["__scopeId","data-v-3d91187e"]]);export{We as default};
